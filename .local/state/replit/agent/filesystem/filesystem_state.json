{"file_contents":{"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverAnchor = PopoverPrimitive.Anchor\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }\n","path":null,"size_bytes":1342,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\n      \"p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2859,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":768,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7406,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-primary/10\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":266,"size_tokens":null},"client/src/components/ui/kbd.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Kbd({ className, ...props }: React.ComponentProps<\"kbd\">) {\n  return (\n    <kbd\n      data-slot=\"kbd\"\n      className={cn(\n        \"bg-muted text-muted-foreground pointer-events-none inline-flex h-5 w-fit min-w-5 select-none items-center justify-center gap-1 rounded-sm px-1 font-sans text-xs font-medium\",\n        \"[&_svg:not([class*='size-'])]:size-3\",\n        \"[[data-slot=tooltip-content]_&]:bg-background/20 [[data-slot=tooltip-content]_&]:text-background dark:[[data-slot=tooltip-content]_&]:bg-background/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction KbdGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <kbd\n      data-slot=\"kbd-group\"\n      className={cn(\"inline-flex items-center gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Kbd, KbdGroup }\n","path":null,"size_bytes":862,"size_tokens":null},"client/src/components/ui/input-group.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Textarea } from \"@/components/ui/textarea\"\n\nfunction InputGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"input-group\"\n      role=\"group\"\n      className={cn(\n        \"group/input-group border-input dark:bg-input/30 shadow-xs relative flex w-full items-center rounded-md border outline-none transition-[color,box-shadow]\",\n        \"h-9 has-[>textarea]:h-auto\",\n\n        // Variants based on alignment.\n        \"has-[>[data-align=inline-start]]:[&>input]:pl-2\",\n        \"has-[>[data-align=inline-end]]:[&>input]:pr-2\",\n        \"has-[>[data-align=block-start]]:h-auto has-[>[data-align=block-start]]:flex-col has-[>[data-align=block-start]]:[&>input]:pb-3\",\n        \"has-[>[data-align=block-end]]:h-auto has-[>[data-align=block-end]]:flex-col has-[>[data-align=block-end]]:[&>input]:pt-3\",\n\n        // Focus state.\n        \"has-[[data-slot=input-group-control]:focus-visible]:ring-ring has-[[data-slot=input-group-control]:focus-visible]:ring-1\",\n\n        // Error state.\n        \"has-[[data-slot][aria-invalid=true]]:ring-destructive/20 has-[[data-slot][aria-invalid=true]]:border-destructive dark:has-[[data-slot][aria-invalid=true]]:ring-destructive/40\",\n\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupAddonVariants = cva(\n  \"text-muted-foreground flex h-auto cursor-text select-none items-center justify-center gap-2 py-1.5 text-sm font-medium group-data-[disabled=true]/input-group:opacity-50 [&>kbd]:rounded-[calc(var(--radius)-5px)] [&>svg:not([class*='size-'])]:size-4\",\n  {\n    variants: {\n      align: {\n        \"inline-start\":\n          \"order-first pl-3 has-[>button]:ml-[-0.45rem] has-[>kbd]:ml-[-0.35rem]\",\n        \"inline-end\":\n          \"order-last pr-3 has-[>button]:mr-[-0.4rem] has-[>kbd]:mr-[-0.35rem]\",\n        \"block-start\":\n          \"[.border-b]:pb-3 order-first w-full justify-start px-3 pt-3 group-has-[>input]/input-group:pt-2.5\",\n        \"block-end\":\n          \"[.border-t]:pt-3 order-last w-full justify-start px-3 pb-3 group-has-[>input]/input-group:pb-2.5\",\n      },\n    },\n    defaultVariants: {\n      align: \"inline-start\",\n    },\n  }\n)\n\nfunction InputGroupAddon({\n  className,\n  align = \"inline-start\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof inputGroupAddonVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"input-group-addon\"\n      data-align={align}\n      className={cn(inputGroupAddonVariants({ align }), className)}\n      onClick={(e) => {\n        if ((e.target as HTMLElement).closest(\"button\")) {\n          return\n        }\n        e.currentTarget.parentElement?.querySelector(\"input\")?.focus()\n      }}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupButtonVariants = cva(\n  \"flex items-center gap-2 text-sm shadow-none\",\n  {\n    variants: {\n      size: {\n        xs: \"h-6 gap-1 rounded-[calc(var(--radius)-5px)] px-2 has-[>svg]:px-2 [&>svg:not([class*='size-'])]:size-3.5\",\n        sm: \"h-8 gap-1.5 rounded-md px-2.5 has-[>svg]:px-2.5\",\n        \"icon-xs\":\n          \"size-6 rounded-[calc(var(--radius)-5px)] p-0 has-[>svg]:p-0\",\n        \"icon-sm\": \"size-8 p-0 has-[>svg]:p-0\",\n      },\n    },\n    defaultVariants: {\n      size: \"xs\",\n    },\n  }\n)\n\nfunction InputGroupButton({\n  className,\n  type = \"button\",\n  variant = \"ghost\",\n  size = \"xs\",\n  ...props\n}: Omit<React.ComponentProps<typeof Button>, \"size\"> &\n  VariantProps<typeof inputGroupButtonVariants>) {\n  return (\n    <Button\n      type={type}\n      data-size={size}\n      variant={variant}\n      className={cn(inputGroupButtonVariants({ size }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupText({ className, ...props }: React.ComponentProps<\"span\">) {\n  return (\n    <span\n      className={cn(\n        \"text-muted-foreground flex items-center gap-2 text-sm [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupInput({\n  className,\n  ...props\n}: React.ComponentProps<\"input\">) {\n  return (\n    <Input\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 rounded-none border-0 bg-transparent shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupTextarea({\n  className,\n  ...props\n}: React.ComponentProps<\"textarea\">) {\n  return (\n    <Textarea\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 resize-none rounded-none border-0 bg-transparent py-3 shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  InputGroup,\n  InputGroupAddon,\n  InputGroupButton,\n  InputGroupText,\n  InputGroupInput,\n  InputGroupTextarea,\n}\n","path":null,"size_bytes":4971,"size_tokens":null},"server/posterpos.ts":{"content":"import { log } from \"./index\";\n\nexport interface PosterPOSProduct {\n  product_id: number;\n  product_name: string;\n  menu_category_name?: string;\n  workshop_name?: string;\n  price?: { [key: string]: string };\n  out?: number;\n}\n\nexport interface PosterPOSTransactionProduct {\n  product_id: number;\n  modification_id?: number;\n  product_price: number;\n  num: string;\n  payed_sum: number;\n  product_cost?: number;\n  product_profit?: number;\n  modifications?: Array<{\n    dish_modification_id: string;\n    modification_id?: string;\n    num?: string;\n  }>;\n}\n\nexport interface PosterPOSTransaction {\n  transaction_id: string;\n  date_start: string;\n  date_close: string;\n  status: string;\n  guests_count: string;\n  discount: string;\n  pay_type: string;\n  payed_cash: string;\n  payed_card: string;\n  payed_sum: string;\n  sum: string;\n  spot_id: string;\n  table_id: string;\n  name: string;\n  user_id: string;\n  client_id: string;\n  total_profit: string;\n  table_name: string;\n  date_close_date: string;\n  products?: PosterPOSTransactionProduct[];\n}\n\nexport interface PosterPOSIngredient {\n  ingredient_id: number;\n  ingredient_name: string;\n  ingredient_unit: string;\n}\n\nexport interface PosterPOSStorage {\n  ingredient_id: number;\n  ingredient_name: string;\n  ingredient_left: string;\n  ingredient_unit: string;\n}\n\nexport class PosterPOSClient {\n  private baseUrl: string;\n  private token: string;\n\n  constructor(baseUrl: string, token: string) {\n    // Poster API format: https://{account}.joinposter.com/api/{method}?token={token}\n    this.baseUrl = baseUrl.replace(/\\/$/, '').replace(/\\/api$/, '');\n    this.token = token;\n  }\n\n  private async request(method: string, params?: Record<string, string>): Promise<any> {\n    // Poster API uses method names like \"menu.getProducts\" with token as query param\n    const queryParams = new URLSearchParams({ token: this.token });\n    if (params) {\n      Object.entries(params).forEach(([key, value]) => {\n        queryParams.append(key, value);\n      });\n    }\n    \n    const url = `${this.baseUrl}/api/${method}?${queryParams.toString()}`;\n    \n    log(`PosterPOS request: ${method}`, 'posterpos');\n    \n    try {\n      const response = await fetch(url, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      if (!response.ok) {\n        const text = await response.text();\n        log(`PosterPOS error response: ${text}`, 'posterpos');\n        throw new Error(`PosterPOS API error: ${response.status} ${response.statusText}`);\n      }\n\n      const data = await response.json();\n      \n      if (data.error) {\n        throw new Error(`PosterPOS API error: ${data.error}`);\n      }\n\n      return data;\n    } catch (error) {\n      log(`PosterPOS request failed: ${error}`, 'posterpos');\n      throw error;\n    }\n  }\n\n  async getProducts(): Promise<PosterPOSProduct[]> {\n    const response = await this.request('menu.getProducts');\n    return response.response || [];\n  }\n\n  async getIngredients(): Promise<PosterPOSIngredient[]> {\n    const response = await this.request('menu.getIngredients');\n    return response.response || [];\n  }\n\n  async getStorages(): Promise<PosterPOSStorage[]> {\n    const response = await this.request('storage.getStorages');\n    return response.response || [];\n  }\n\n  async getStockLevels(): Promise<{ product_id: number; product_name: string; stock_count: number; unit_name: string }[]> {\n    // Get ingredients with their stock levels\n    try {\n      const ingredients = await this.request('menu.getIngredients');\n      \n      if (!ingredients.response) {\n        // Fallback: try to get products instead\n        const products = await this.getProducts();\n        return products.map(p => ({\n          product_id: p.product_id,\n          product_name: p.product_name,\n          stock_count: p.out || 0,\n          unit_name: 'units',\n        }));\n      }\n\n      return (ingredients.response || []).map((ing: any) => ({\n        product_id: ing.ingredient_id,\n        product_name: ing.ingredient_name,\n        stock_count: parseFloat(ing.ingredient_left || '0'),\n        unit_name: ing.ingredient_unit || 'units',\n      }));\n    } catch (error) {\n      log(`Failed to get stock levels: ${error}`, 'posterpos');\n      // Try products as fallback\n      const products = await this.getProducts();\n      return products.map(p => ({\n        product_id: p.product_id,\n        product_name: p.product_name,\n        stock_count: 0,\n        unit_name: 'units',\n      }));\n    }\n  }\n\n  async getTransactions(options?: {\n    dateFrom?: string;\n    dateTo?: string;\n    afterDateClose?: number;\n    status?: number;\n    includeProducts?: boolean;\n  }): Promise<PosterPOSTransaction[]> {\n    try {\n      const params: Record<string, string> = {\n        include_products: 'true',\n        include_modifications: '1',\n        status: '2',\n      };\n      \n      if (options?.dateFrom) params.dateFrom = options.dateFrom;\n      if (options?.dateTo) params.dateTo = options.dateTo;\n      if (options?.afterDateClose) params.after_date_close = options.afterDateClose.toString();\n      if (options?.status !== undefined) params.status = options.status.toString();\n      if (options?.includeProducts !== undefined) params.include_products = options.includeProducts ? 'true' : 'false';\n      \n      const response = await this.request('dash.getTransactions', params);\n      return response.response || [];\n    } catch (error) {\n      log(`Failed to get transactions: ${error}`, 'posterpos');\n      return [];\n    }\n  }\n\n  async getTodaysTransactions(): Promise<PosterPOSTransaction[]> {\n    const today = new Date().toISOString().split('T')[0].replace(/-/g, '');\n    return this.getTransactions({ dateFrom: today, dateTo: today });\n  }\n\n  async getRecentTransactions(days: number = 7): Promise<PosterPOSTransaction[]> {\n    const to = new Date();\n    const from = new Date();\n    from.setDate(from.getDate() - days);\n    \n    const dateFrom = from.toISOString().split('T')[0].replace(/-/g, '');\n    const dateTo = to.toISOString().split('T')[0].replace(/-/g, '');\n    \n    return this.getTransactions({ dateFrom, dateTo });\n  }\n\n  async getTransactionsSince(afterTimestamp: number): Promise<PosterPOSTransaction[]> {\n    return this.getTransactions({ afterDateClose: afterTimestamp });\n  }\n\n  async getSalesReport(): Promise<any> {\n    const response = await this.request('dash.getAnalytics');\n    return response.response || {};\n  }\n\n  async getIngredientMovements(dateFrom?: string, dateTo?: string, type?: number): Promise<IngredientMovement[]> {\n    try {\n      const params: Record<string, string> = {};\n      if (dateFrom) params.date_from = dateFrom;\n      if (dateTo) params.date_to = dateTo;\n      if (type) params.type = type.toString();\n      \n      const response = await this.request('storage.getReportMovement', params);\n      return response.response || [];\n    } catch (error) {\n      log(`Failed to get ingredient movements: ${error}`, 'posterpos');\n      return [];\n    }\n  }\n\n  async getTodaysIngredientMovements(): Promise<IngredientMovement[]> {\n    const today = new Date().toISOString().split('T')[0].replace(/-/g, '');\n    return this.getIngredientMovements(today, today);\n  }\n\n  async getIngredientMovementsForRange(days: number = 7): Promise<IngredientMovement[]> {\n    const to = new Date();\n    const from = new Date();\n    from.setDate(from.getDate() - days);\n    \n    const dateFrom = from.toISOString().split('T')[0].replace(/-/g, '');\n    const dateTo = to.toISOString().split('T')[0].replace(/-/g, '');\n    \n    return this.getIngredientMovements(dateFrom, dateTo);\n  }\n\n  async getTransactionProducts(transactionId: string): Promise<TransactionProductDetail[]> {\n    try {\n      const response = await this.request('dash.getTransactionProducts', { transaction_id: transactionId });\n      return response.response || [];\n    } catch (error) {\n      log(`Failed to get transaction products for ${transactionId}: ${error}`, 'posterpos');\n      return [];\n    }\n  }\n\n  async getProductWithRecipe(productId: string): Promise<ProductWithRecipe | null> {\n    try {\n      const response = await this.request('menu.getProduct', { product_id: productId });\n      if (!response.response) return null;\n      \n      const product = response.response;\n      \n      const result: ProductWithRecipe = {\n        product_id: product.product_id,\n        product_name: product.product_name,\n        type: product.type,\n        ingredients: product.ingredients?.map((ing: any) => ({\n          structure_id: ing.structure_id,\n          ingredient_id: ing.ingredient_id,\n          ingredient_name: ing.ingredient_name,\n          structure_brutto: parseFloat(ing.structure_brutto) || 0,\n          structure_netto: parseFloat(ing.structure_netto) || 0,\n          structure_unit: ing.structure_unit || ing.ingredient_unit,\n          ingredient_unit: ing.ingredient_unit,\n        })) || [],\n      };\n      \n      // Parse group modifications (ingredient choices)\n      if (product.group_modifications && Array.isArray(product.group_modifications)) {\n        result.group_modifications = product.group_modifications.map((group: any) => ({\n          dish_modification_group_id: group.dish_modification_group_id,\n          name: group.name,\n          modifications: (group.modifications || []).map((mod: any) => ({\n            dish_modification_id: mod.dish_modification_id,\n            name: mod.name,\n            ingredient_id: mod.ingredient_id,\n            product_id: mod.product_id || mod.dish_id,\n            type: mod.type,\n            brutto: parseFloat(mod.brutto) || 0,\n            netto: parseFloat(mod.netto) || 0,\n            ingredient_name: mod.name,\n            ingredient_unit: mod.ingredient_unit || '',\n          })),\n        }));\n      }\n      \n      return result;\n    } catch (error) {\n      log(`Failed to get product recipe for ${productId}: ${error}`, 'posterpos');\n      return null;\n    }\n  }\n\n  async getAllProductsWithRecipes(): Promise<ProductWithRecipe[]> {\n    try {\n      const products = await this.getProducts();\n      const recipesMap: ProductWithRecipe[] = [];\n      \n      for (const product of products) {\n        const productWithRecipe = await this.getProductWithRecipe(product.product_id.toString());\n        if (productWithRecipe && productWithRecipe.ingredients && productWithRecipe.ingredients.length > 0) {\n          recipesMap.push(productWithRecipe);\n        }\n      }\n      \n      log(`Fetched recipes for ${recipesMap.length} products with ingredients`, 'posterpos');\n      return recipesMap;\n    } catch (error) {\n      log(`Failed to get all product recipes: ${error}`, 'posterpos');\n      return [];\n    }\n  }\n}\n\nexport interface IngredientMovement {\n  ingredient_id: string;\n  ingredient_name: string;\n  cost_start: number;\n  cost_end: number;\n  start: number;\n  income: number;\n  write_offs: number;\n  end: number;\n}\n\nexport interface ProductRecipeIngredient {\n  structure_id: string;\n  ingredient_id: string;\n  ingredient_name: string;\n  structure_brutto: number;\n  structure_netto: number;\n  structure_unit: string;\n  ingredient_unit: string;\n}\n\nexport interface ProductModification {\n  dish_modification_id: string;\n  name: string;\n  ingredient_id?: string;\n  product_id?: string;\n  type: string;\n  brutto: number;\n  netto: number;\n  ingredient_name?: string;\n  ingredient_unit?: string;\n}\n\nexport interface ProductModificationGroup {\n  dish_modification_group_id: string;\n  name: string;\n  modifications: ProductModification[];\n}\n\nexport interface ProductWithRecipe {\n  product_id: string;\n  product_name: string;\n  type: string;\n  ingredients?: ProductRecipeIngredient[];\n  group_modifications?: ProductModificationGroup[];\n}\n\nexport interface TransactionProductDetail {\n  product_id: string;\n  product_name: string;\n  modification_id: string;\n  modificator_name: string | null;\n  modificator_barcode: string | null;\n  modificator_product_code: string | null;\n  num: string;\n  time: string;\n  workshop: string;\n  barcode: string;\n  product_code: string;\n  tax_id: string;\n  nodiscount: string;\n  payed_sum: string;\n  product_sum: string;\n  discount: string;\n  category_id: string;\n}\n\n// Singleton instance\nlet posterPOSClient: PosterPOSClient | null = null;\n\nexport function initPosterPOSClient(baseUrl: string, token: string): PosterPOSClient {\n  posterPOSClient = new PosterPOSClient(baseUrl, token);\n  log('PosterPOS client initialized', 'posterpos');\n  return posterPOSClient;\n}\n\nexport function getPosterPOSClient(): PosterPOSClient {\n  if (!posterPOSClient) {\n    throw new Error('PosterPOS client not initialized. Call initPosterPOSClient first.');\n  }\n  return posterPOSClient;\n}\n\nexport function isPosterPOSInitialized(): boolean {\n  return posterPOSClient !== null;\n}\n","path":null,"size_bytes":12745,"size_tokens":null},"client/src/pages/Settings.tsx":{"content":"import { MobileShell } from \"@/components/layout/MobileShell\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { ArrowLeft, CheckCircle2, AlertCircle, Loader2, XCircle } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nexport default function Settings() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: configStatus } = useQuery<{ posterpos: boolean; telegram: boolean }>({\n    queryKey: [\"/api/config/status\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/config/status\");\n      if (!res.ok) throw new Error(\"Failed to fetch status\");\n      return res.json();\n    },\n  });\n\n  const syncInventory = useMutation({\n    mutationFn: async () => {\n      const res = await fetch(\"/api/posterpos/sync/inventory\", { method: \"POST\" });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.message || \"Failed to sync inventory\");\n      }\n      return res.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"Sync Complete\",\n        description: data.message,\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/inventory\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Sync Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const syncSales = useMutation({\n    mutationFn: async () => {\n      const res = await fetch(\"/api/posterpos/sync/sales\", { method: \"POST\" });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.message || \"Failed to sync sales\");\n      }\n      return res.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"Sync Complete\",\n        description: data.message,\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/sales\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Sync Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  return (\n    <MobileShell className=\"pb-8\">\n      <header className=\"sticky top-0 z-10 bg-background/80 backdrop-blur-md px-4 py-4 border-b flex items-center gap-3\">\n        <Link href=\"/\" className=\"p-2 -ml-2 rounded-full hover:bg-secondary\">\n          <ArrowLeft className=\"h-5 w-5\" />\n        </Link>\n        <h1 className=\"text-xl font-bold tracking-tight\">Settings</h1>\n      </header>\n\n      <main className=\"p-4 space-y-6\">\n        {/* PosterPOS Configuration */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              PosterPOS Connection\n              {configStatus?.posterpos ? (\n                <CheckCircle2 className=\"h-5 w-5 text-green-500\" />\n              ) : (\n                <XCircle className=\"h-5 w-5 text-red-500\" />\n              )}\n            </CardTitle>\n            <CardDescription>\n              {configStatus?.posterpos \n                ? \"Connected and ready to sync\" \n                : \"Configure via environment variables\"}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {!configStatus?.posterpos ? (\n              <div className=\"p-4 bg-yellow-50 rounded-lg space-y-2 text-sm\">\n                <p className=\"font-medium text-yellow-800\">Setup Required</p>\n                <p className=\"text-yellow-700\">Add these secrets to your Replit environment:</p>\n                <ul className=\"text-yellow-600 list-disc pl-4 space-y-1\">\n                  <li><code className=\"bg-yellow-100 px-1 rounded\">POSTERPOS_API_ENDPOINT</code></li>\n                  <li><code className=\"bg-yellow-100 px-1 rounded\">POSTERPOS_API_TOKEN</code></li>\n                </ul>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                <Button \n                  variant=\"outline\" \n                  className=\"w-full justify-start\"\n                  onClick={() => syncInventory.mutate()}\n                  disabled={syncInventory.isPending}\n                >\n                  {syncInventory.isPending ? (\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  ) : (\n                    <CheckCircle2 className=\"mr-2 h-4 w-4 text-green-500\" />\n                  )}\n                  Sync Inventory from PosterPOS\n                </Button>\n                <Button \n                  variant=\"outline\" \n                  className=\"w-full justify-start\"\n                  onClick={() => syncSales.mutate()}\n                  disabled={syncSales.isPending}\n                >\n                  {syncSales.isPending ? (\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  ) : (\n                    <CheckCircle2 className=\"mr-2 h-4 w-4 text-green-500\" />\n                  )}\n                  Sync Today's Sales\n                </Button>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Telegram Bot */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              Telegram Bot\n              {configStatus?.telegram ? (\n                <CheckCircle2 className=\"h-5 w-5 text-green-500\" />\n              ) : (\n                <XCircle className=\"h-5 w-5 text-red-500\" />\n              )}\n            </CardTitle>\n            <CardDescription>\n              {configStatus?.telegram \n                ? \"Bot is running and ready\" \n                : \"Configure via environment variables\"}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {!configStatus?.telegram ? (\n              <div className=\"p-4 bg-yellow-50 rounded-lg space-y-2 text-sm\">\n                <p className=\"font-medium text-yellow-800\">Setup Required</p>\n                <ol className=\"text-yellow-700 list-decimal pl-4 space-y-1\">\n                  <li>Message <strong>@BotFather</strong> on Telegram</li>\n                  <li>Send <code className=\"bg-yellow-100 px-1 rounded\">/newbot</code> and follow prompts</li>\n                  <li>Add <code className=\"bg-yellow-100 px-1 rounded\">TELEGRAM_BOT_TOKEN</code> to secrets</li>\n                </ol>\n              </div>\n            ) : (\n              <div className=\"p-4 bg-green-50 rounded-lg space-y-2\">\n                <p className=\"text-sm font-medium text-green-800\">How to connect:</p>\n                <ol className=\"text-sm text-green-700 space-y-1 list-decimal pl-4\">\n                  <li>Open your bot in Telegram</li>\n                  <li>Send <code className=\"bg-green-100 px-1 py-0.5 rounded\">/start</code> to register</li>\n                  <li>You'll receive real-time notifications</li>\n                </ol>\n                <div className=\"pt-2 border-t border-green-200 mt-3\">\n                  <p className=\"text-xs text-green-600\">Available commands: /report /stock /alerts /requests</p>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Help */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">How It Works</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3 text-sm text-muted-foreground\">\n            <div className=\"flex gap-2\">\n              <div className=\"text-lg\">1</div>\n              <p><strong>Connect PosterPOS</strong> - Sync inventory and sales data from your kiosk</p>\n            </div>\n            <div className=\"flex gap-2\">\n              <div className=\"text-lg\">2</div>\n              <p><strong>Set up Telegram Bot</strong> - Get real-time alerts on sales and low stock</p>\n            </div>\n            <div className=\"flex gap-2\">\n              <div className=\"text-lg\">3</div>\n              <p><strong>Manage from anywhere</strong> - View analytics, approve orders, track inventory</p>\n            </div>\n          </CardContent>\n        </Card>\n      </main>\n    </MobileShell>\n  );\n}\n","path":null,"size_bytes":8226,"size_tokens":null},"replit.md":{"content":"# PosterPOS Mini Apps\n\n## Overview\n\nPosterPOS Mini Apps is a Telegram-based ecosystem for managing restaurant/retail operations across three distinct roles: Owner, Store Manager, and Shop/POS operations. The application integrates with the PosterPOS API for sales and inventory synchronization, and uses Telegram for notifications and communications.\n\nThe system is built as a full-stack TypeScript application with a React frontend (using Vite) and Express backend, featuring a PostgreSQL database for data persistence. It supports real-time inventory tracking, sales recording, dispatch logging, and reorder management across multiple user interfaces optimized for mobile devices.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Application Structure\n\n**Monorepo Organization**: The codebase uses a monorepo structure with three primary directories:\n- `client/` - React-based frontend with TypeScript and Vite\n- `server/` - Express.js backend with TypeScript\n- `shared/` - Shared schemas and types used by both client and server\n\n**Rationale**: This architecture enables type safety across the full stack while maintaining clear separation of concerns. The shared directory eliminates duplication and ensures consistency between frontend and backend data models.\n\n### Frontend Architecture\n\n**Framework Choice**: React with TypeScript, built using Vite for development and production builds.\n\n**UI Framework**: shadcn/ui component library built on Radix UI primitives with Tailwind CSS v4 for styling. The components follow the \"new-york\" style variant.\n\n**Rationale**: shadcn/ui provides accessible, customizable components without the bundle size overhead of full UI libraries. Tailwind CSS offers utility-first styling with excellent mobile optimization, crucial for the Telegram Mini App use case.\n\n**State Management**: TanStack Query (React Query) v5 for server state management with custom query functions.\n\n**Routing**: Wouter for client-side routing - a lightweight alternative to React Router suitable for smaller applications.\n\n**Mobile-First Design**: The application uses a `MobileShell` component wrapper that constrains content to mobile dimensions (`sm:max-w-md`) and provides theme switching between three color schemes (owner/store/shop).\n\n**Rationale**: Telegram Mini Apps are primarily mobile experiences, so the mobile-first constraint ensures optimal UX. The theme system provides visual distinction between different user roles.\n\n### Backend Architecture\n\n**Server Framework**: Express.js with TypeScript, using ES modules (`\"type\": \"module\"` in package.json).\n\n**API Design**: RESTful API structure with route handlers in `server/routes.ts`. No authentication middleware is currently implemented (relies on Telegram's built-in auth).\n\n**Development vs Production**: \n- Development mode uses Vite middleware for hot module replacement\n- Production builds bundle the server with esbuild, selectively bundling dependencies from an allowlist to reduce cold start times\n\n**Rationale**: This dual-mode approach provides excellent developer experience while optimizing production performance. The selective bundling strategy reduces filesystem operations which can slow cold starts in serverless environments.\n\n### Data Layer\n\n**ORM**: Drizzle ORM v0.39.3 configured for PostgreSQL with the schema defined in `shared/schema.ts`.\n\n**Database**: PostgreSQL with connection pooling via `pg` library.\n\n**Schema Design**: Six primary tables:\n- `users` - User authentication (currently minimal)\n- `inventoryItems` - Product inventory with PosterPOS integration\n- `salesRecords` - Sales transactions synced from PosterPOS\n- `despatchLogs` - Manual dispatch/transfer records\n- `reorderRequests` - Reorder/purchase requests\n- `telegramChats` - Telegram bot chat registrations with role assignments\n\n**Storage Abstraction**: The `server/storage.ts` file provides an `IStorage` interface abstracting database operations. This allows for easier testing and potential database swapping.\n\n**Rationale**: Drizzle provides type-safe database queries with excellent TypeScript integration while remaining lightweight. The schema uses UUIDs for primary keys and maintains referential integrity through foreign keys.\n\n### Build System\n\n**Development**: \n- Client: Vite dev server on port 5000\n- Server: tsx watch mode for TypeScript execution\n\n**Production Build**: Custom build script (`script/build.ts`) that:\n1. Builds the client with Vite  outputs to `dist/public`\n2. Bundles the server with esbuild  outputs to `dist/index.cjs`\n\n**Rationale**: This approach produces a single deployable artifact with the server serving the static client files, simplifying deployment to platforms like Replit.\n\n## External Dependencies\n\n### PosterPOS Integration\n\n**Purpose**: Third-party POS system integration for inventory and sales synchronization.\n\n**Implementation**: Custom client in `server/posterpos.ts` that communicates via REST API with bearer token authentication.\n\n**Key Features**:\n- Fetch product catalog\n- Retrieve transaction history\n- Get stock levels\n- Manual sync endpoints for inventory and sales data\n- Real-time ingredient usage tracking from transactions\n\n**Ingredient Usage Tracking**:\nThe system calculates ingredient consumption by combining:\n1. **Base Recipe Ingredients**: From `menu.getProduct` API - static ingredients for each dish\n2. **Selected Modifiers**: From `dash.getTransactionProducts` API - the `modificator_name` field contains comma-separated modifier names selected by customers\n3. **Modifier Recipes**: From `group_modifications` in product recipes - each modifier has `ingredient_id` and `brutto` amount\n\n**Key API Endpoints Used**:\n- `dash.getTransactions` - Get transaction list with product IDs\n- `dash.getTransactionProducts` - Get detailed product info WITH `modificator_name` for selected modifiers\n- `menu.getProduct` - Get product recipes and available modifiers\n\n**Important API Notes**:\n- `dash.getTransactions` only returns `modification_id` (combined ID), NOT individual modifier details\n- `dash.getTransactionProducts` returns `modificator_name` (e.g., \"Oranges, Apples, Ginger\") - the key to modifier tracking\n- Use date format `Ymd` (e.g., 20251207) for date parameters\n- Amounts are in cents/smallest currency unit - divide by 100 for display\n\n**Configuration**: Requires environment variables:\n- `POSTERPOS_API_ENDPOINT` - API base URL\n- `POSTERPOS_API_TOKEN` - Authentication token\n\n**Rationale**: PosterPOS serves as the source of truth for sales and product data. The integration allows the application to maintain a local cache while periodically syncing with the external system.\n\n### Telegram Bot Integration\n\n**Purpose**: Notifications and role-based chat management for alerts about inventory, sales, and reorders.\n\n**Implementation**: `node-telegram-bot-api` library with custom service wrapper in `server/telegram.ts`.\n\n**Supported Modes**:\n- Polling mode for development\n- Webhook mode for production (requires `TELEGRAM_WEBHOOK_URL`)\n\n**Features**:\n- Chat registration with role assignment (owner/store/shop)\n- Command handling (`/start`, `/status`, etc.)\n- Notification delivery to registered chats\n\n**Configuration**: Requires environment variables:\n- `TELEGRAM_BOT_TOKEN` - Bot authentication token\n- `TELEGRAM_WEBHOOK_URL` - (Optional) Webhook endpoint for production\n\n**Rationale**: Telegram provides a free, ubiquitous messaging platform perfect for operations notifications. The bot approach allows push notifications without building a native mobile app.\n\n### UI Component Libraries\n\n**Primary Dependencies**:\n- `@radix-ui/*` - Unstyled, accessible component primitives (17+ packages)\n- `@tanstack/react-query` - Server state management\n- `lucide-react` - Icon library\n- `react-hook-form` + `@hookform/resolvers` - Form handling with Zod validation\n\n**Styling**:\n- `tailwindcss` - Utility-first CSS framework\n- `class-variance-authority` - Variant-based component styling\n- `tailwind-merge` + `clsx` - Conditional class merging\n\n**Rationale**: This stack provides maximum flexibility and customization while maintaining accessibility standards. The combination is well-suited for design systems that need to be highly tailored.\n\n### Database & Session Management\n\n**Database**: \n- `drizzle-orm` - Type-safe ORM\n- `drizzle-kit` - Migration tooling\n- `pg` - PostgreSQL client with connection pooling\n\n**Session Storage**: `connect-pg-simple` for PostgreSQL-backed Express sessions (though sessions aren't currently used extensively).\n\n**Rationale**: PostgreSQL provides ACID guarantees crucial for inventory and financial data. Drizzle's TypeScript-first approach ensures compile-time safety for database operations.\n\n### Development Tools\n\n**Replit-Specific Plugins**:\n- `@replit/vite-plugin-runtime-error-modal` - Enhanced error overlay\n- `@replit/vite-plugin-cartographer` - Project navigation\n- `@replit/vite-plugin-dev-banner` - Development environment indicator\n\n**Build Tools**:\n- `vite` - Frontend build tool and dev server\n- `esbuild` - Server bundler for production\n- `tsx` - TypeScript execution for development\n\n**Rationale**: The Replit plugins enhance the development experience specifically for the Replit platform, while the build tools provide optimal performance for both development and production.","path":null,"size_bytes":9355,"size_tokens":null},"server/telegram.ts":{"content":"import TelegramBot from 'node-telegram-bot-api';\nimport { storage } from './storage';\nimport { log } from './index';\n\nexport class TelegramBotService {\n  private bot: TelegramBot;\n  private webhookUrl?: string;\n\n  constructor(token: string, webhookUrl?: string) {\n    this.webhookUrl = webhookUrl;\n    \n    if (webhookUrl) {\n      this.bot = new TelegramBot(token);\n      this.setupWebhook();\n    } else {\n      this.bot = new TelegramBot(token, { polling: true });\n    }\n\n    this.setupCommands();\n    log('Telegram bot initialized', 'telegram');\n  }\n\n  private async setupWebhook() {\n    if (!this.webhookUrl) return;\n    \n    try {\n      await this.bot.setWebHook(`${this.webhookUrl}/api/telegram/webhook`);\n      log(`Webhook set to ${this.webhookUrl}/api/telegram/webhook`, 'telegram');\n    } catch (error) {\n      log(`Failed to set webhook: ${error}`, 'telegram');\n    }\n  }\n\n  private setupCommands() {\n    this.bot.onText(/\\/start/, async (msg) => {\n      const chatId = msg.chat.id.toString();\n      \n      try {\n        const chat = await storage.getTelegramChatByChatId(chatId);\n\n        if (!chat) {\n          await storage.createTelegramChat({\n            chatId,\n            chatType: msg.chat.type,\n            role: 'owner',\n            isActive: true,\n          });\n        }\n        \n        // Send welcome with channel setup options\n        const keyboard: any = {\n          inline_keyboard: [\n            [{ text: ' Sales Channel', callback_data: 'setup_sales' }],\n            [{ text: ' Inventory Channel', callback_data: 'setup_inventory' }],\n            [{ text: ' All Notifications', callback_data: 'setup_owner' }],\n          ]\n        };\n        \n        await this.bot.sendMessage(chatId, \n          ' *Welcome to Juicee Manager!*\\n\\n' +\n          '*Choose what notifications this chat should receive:*\\n\\n' +\n          ' *Sales Channel* - Real-time receipt alerts\\n' +\n          ' *Inventory Channel* - Stock usage & low stock\\n' +\n          ' *All Notifications* - Everything\\n\\n' +\n          '_Tip: Add me to a group/channel and run /start to set it up_',\n          { \n            parse_mode: 'Markdown',\n            reply_markup: keyboard\n          }\n        );\n      } catch (error) {\n        log(`Error in /start command: ${error}`, 'telegram');\n        await this.bot.sendMessage(chatId, 'An error occurred. Please try again later.');\n      }\n    });\n\n    // Handle callback queries from inline buttons\n    this.bot.on('callback_query', async (query) => {\n      if (!query.message || !query.data) return;\n      \n      const chatId = query.message.chat.id.toString();\n      \n      try {\n        // Handle channel setup\n        if (query.data.startsWith('setup_')) {\n          const role = query.data.replace('setup_', '');\n          await this.setupChannel(chatId, query.message.chat.type, role);\n          await this.bot.answerCallbackQuery(query.id, { text: 'Channel configured!' });\n          return;\n        }\n\n        switch (query.data) {\n          case 'report':\n            await this.handleReport(chatId);\n            break;\n          case 'stock':\n            await this.handleStock(chatId);\n            break;\n          case 'alerts':\n            await this.handleAlerts(chatId);\n            break;\n          case 'requests':\n            await this.handleRequests(chatId);\n            break;\n        }\n        await this.bot.answerCallbackQuery(query.id);\n      } catch (error) {\n        log(`Error handling callback: ${error}`, 'telegram');\n        await this.bot.answerCallbackQuery(query.id, { text: 'Error occurred' });\n      }\n    });\n\n    // Command to show main menu\n    this.bot.onText(/\\/menu/, async (msg) => {\n      const chatId = msg.chat.id.toString();\n      \n      const webAppUrl = process.env.REPL_SLUG \n        ? `https://${process.env.REPL_SLUG}.${process.env.REPL_OWNER?.toLowerCase()}.repl.co`\n        : process.env.WEBAPP_URL || '';\n        \n      const keyboard: any = {\n        inline_keyboard: []\n      };\n      \n      if (webAppUrl) {\n        keyboard.inline_keyboard.push([\n          { text: ' Open Mini App', web_app: { url: webAppUrl } }\n        ]);\n      }\n      \n      keyboard.inline_keyboard.push([\n        { text: ' Sales Report', callback_data: 'report' },\n        { text: ' Stock Levels', callback_data: 'stock' }\n      ]);\n      keyboard.inline_keyboard.push([\n        { text: ' Low Stock', callback_data: 'alerts' },\n        { text: ' Requests', callback_data: 'requests' }\n      ]);\n      \n      await this.bot.sendMessage(chatId, '*Quick Actions:*', {\n        parse_mode: 'Markdown',\n        reply_markup: keyboard\n      });\n    });\n\n    this.bot.onText(/\\/report/, (msg) => this.handleReport(msg.chat.id.toString()));\n    this.bot.onText(/\\/stock/, (msg) => this.handleStock(msg.chat.id.toString()));\n    this.bot.onText(/\\/alerts/, (msg) => this.handleAlerts(msg.chat.id.toString()));\n    this.bot.onText(/\\/requests/, (msg) => this.handleRequests(msg.chat.id.toString()));\n    \n    this.bot.onText(/\\/help/, async (msg) => {\n      const chatId = msg.chat.id.toString();\n      await this.bot.sendMessage(chatId,\n        '*Available Commands:*\\n\\n' +\n        ' /report - Today\\'s sales summary\\n' +\n        ' /stock - Inventory levels\\n' +\n        ' /alerts - Low stock warnings\\n' +\n        ' /requests - Reorder requests\\n' +\n        ' /menu - Quick actions menu\\n' +\n        ' /status - Channel settings\\n' +\n        '/help - Show this message',\n        { parse_mode: 'Markdown' }\n      );\n    });\n    \n    // Channel status command\n    this.bot.onText(/\\/status/, async (msg) => {\n      const chatId = msg.chat.id.toString();\n      const chat = await storage.getTelegramChatByChatId(chatId);\n      \n      if (!chat) {\n        await this.bot.sendMessage(chatId, 'This chat is not registered. Use /start to set it up.');\n        return;\n      }\n      \n      const roleLabels: Record<string, string> = {\n        sales: ' Sales Channel',\n        inventory: ' Inventory Channel',\n        owner: ' All Notifications',\n        store: ' Store Manager',\n        shop: ' Shop/POS',\n      };\n      \n      await this.bot.sendMessage(chatId, \n        `*Channel Status*\\n\\n` +\n        `Type: ${roleLabels[chat.role] || chat.role}\\n` +\n        `Active: ${chat.isActive ? ' Yes' : ' No'}\\n\\n` +\n        `Use /start to change notification type.`,\n        { parse_mode: 'Markdown' }\n      );\n    });\n  }\n\n  private async setupChannel(chatId: string, chatType: string, role: string) {\n    try {\n      const existing = await storage.getTelegramChatByChatId(chatId);\n      \n      if (existing) {\n        await storage.updateTelegramChat(existing.id, { role, isActive: true });\n      } else {\n        await storage.createTelegramChat({\n          chatId,\n          chatType,\n          role,\n          isActive: true,\n        });\n      }\n      \n      const roleLabels: Record<string, string> = {\n        sales: ' Sales receipts',\n        inventory: ' Inventory & stock alerts',\n        owner: ' All notifications',\n      };\n      \n      await this.bot.sendMessage(chatId, \n        ` *Channel configured!*\\n\\n` +\n        `This chat will now receive: ${roleLabels[role] || role}\\n\\n` +\n        `Use /menu for quick actions or /status to check settings.`,\n        { parse_mode: 'Markdown' }\n      );\n      \n      log(`Channel ${chatId} configured for ${role} notifications`, 'telegram');\n    } catch (error) {\n      log(`Error setting up channel: ${error}`, 'telegram');\n      throw error;\n    }\n  }\n\n  private async handleReport(chatId: string) {\n    try {\n      const sales = await storage.getTodaysSales();\n      const recentSales = await storage.getAllSalesRecords(10);\n\n      let message = ` *Today's Sales Report*\\n\\n`;\n      message += ` Total: KES ${sales.total.toFixed(2)}\\n`;\n      message += ` Transactions: ${sales.count}\\n\\n`;\n\n      if (recentSales.length > 0) {\n        message += `*Recent Sales:*\\n`;\n        recentSales.slice(0, 5).forEach(sale => {\n          const time = new Date(sale.timestamp).toLocaleTimeString('en-US', { \n            hour: '2-digit', \n            minute: '2-digit' \n          });\n          message += ` ${sale.itemName} x${sale.quantity} - KES ${sale.amount} (${time})\\n`;\n        });\n      }\n\n      await this.bot.sendMessage(chatId, message, { parse_mode: 'Markdown' });\n    } catch (error) {\n      log(`Error in report: ${error}`, 'telegram');\n      await this.bot.sendMessage(chatId, 'Failed to fetch sales report.');\n    }\n  }\n\n  private async handleStock(chatId: string) {\n    try {\n      const inventory = await storage.getAllInventoryItems();\n      \n      let message = ` *Inventory Status*\\n\\n`;\n      \n      if (inventory.length === 0) {\n        message += 'No inventory items tracked yet.';\n      } else {\n        const sorted = [...inventory].sort((a, b) => Number(a.currentStock) - Number(b.currentStock));\n        sorted.slice(0, 15).forEach(item => {\n          const stock = Number(item.currentStock);\n          const min = Number(item.minStock);\n          const status = stock <= min ? '' : stock <= min * 1.5 ? '' : '';\n          message += `${status} ${item.name}: ${stock} ${item.unit}\\n`;\n        });\n        if (inventory.length > 15) {\n          message += `\\n_...and ${inventory.length - 15} more items_`;\n        }\n      }\n\n      await this.bot.sendMessage(chatId, message, { parse_mode: 'Markdown' });\n    } catch (error) {\n      log(`Error in stock: ${error}`, 'telegram');\n      await this.bot.sendMessage(chatId, 'Failed to fetch inventory.');\n    }\n  }\n\n  private async handleAlerts(chatId: string) {\n    try {\n      const lowStock = await storage.getLowStockItems();\n\n      let message = ` *Low Stock Alerts*\\n\\n`;\n      \n      if (lowStock.length === 0) {\n        message += ' All items are well stocked!';\n      } else {\n        lowStock.forEach(item => {\n          message += ` ${item.name}: ${item.currentStock} ${item.unit} (min: ${item.minStock})\\n`;\n        });\n      }\n\n      await this.bot.sendMessage(chatId, message, { parse_mode: 'Markdown' });\n    } catch (error) {\n      log(`Error in alerts: ${error}`, 'telegram');\n      await this.bot.sendMessage(chatId, 'Failed to fetch alerts.');\n    }\n  }\n\n  private async handleRequests(chatId: string) {\n    try {\n      const requests = await storage.getPendingReorderRequests();\n\n      let message = ` *Pending Reorder Requests*\\n\\n`;\n      \n      if (requests.length === 0) {\n        message += 'No pending requests.';\n      } else {\n        requests.forEach(req => {\n          message += ` ${req.itemName} (${req.quantity} ${req.unit})\\n`;\n          message += `  By: ${req.requester}`;\n          if (req.estimatedCost) {\n            message += ` | KES ${req.estimatedCost}`;\n          }\n          message += `\\n\\n`;\n        });\n      }\n\n      await this.bot.sendMessage(chatId, message, { parse_mode: 'Markdown' });\n    } catch (error) {\n      log(`Error in requests: ${error}`, 'telegram');\n      await this.bot.sendMessage(chatId, 'Failed to fetch requests.');\n    }\n  }\n\n  async sendNotification(message: string, targetRoles?: string | string[]) {\n    try {\n      const chats = await storage.getAllTelegramChats();\n      const roles = targetRoles \n        ? (Array.isArray(targetRoles) ? targetRoles : [targetRoles])\n        : null;\n      \n      for (const chat of chats) {\n        if (!chat.isActive) continue;\n        \n        // owner role receives all notifications\n        const shouldReceive = !roles || \n          roles.includes(chat.role) || \n          chat.role === 'owner';\n        \n        if (shouldReceive) {\n          try {\n            await this.bot.sendMessage(chat.chatId, message, { parse_mode: 'Markdown' });\n          } catch (error) {\n            log(`Failed to send message to ${chat.chatId}: ${error}`, 'telegram');\n          }\n        }\n      }\n    } catch (error) {\n      log(`Failed to get chats for notification: ${error}`, 'telegram');\n    }\n  }\n\n  async sendSaleNotification(itemName: string, quantity: string, amount: string) {\n    const message = ` *New Receipt!*\\n${itemName} x${quantity}\\nAmount: KES ${amount}`;\n    await this.sendNotification(message, 'sales');\n  }\n\n  async sendReceiptNotification(total: number, items: string[]) {\n    const itemsList = items.slice(0, 3).join(', ') + (items.length > 3 ? ` +${items.length - 3} more` : '');\n    const time = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });\n    const message = ` *New Receipt!*\\nAmount: KES ${total.toFixed(2)}\\nItems: ${itemsList}\\nTime: ${time}`;\n    await this.sendNotification(message, 'sales');\n  }\n\n  async sendLowStockAlert(itemName: string, currentStock: string, minStock: string) {\n    const message = ` *Low Stock Alert!*\\n${itemName}\\nCurrent: ${currentStock}\\nMinimum: ${minStock}`;\n    await this.sendNotification(message, 'inventory');\n  }\n\n  async sendInventoryUpdate(action: string, details?: string) {\n    const message = ` *Inventory Update*\\n${action}${details ? `\\n${details}` : ''}`;\n    await this.sendNotification(message, 'inventory');\n  }\n\n  async sendReorderRequestNotification(itemName: string, requester: string) {\n    const message = ` *New Reorder Request*\\n${itemName}\\nRequested by: ${requester}`;\n    await this.sendNotification(message, 'owner');\n  }\n\n  getBot(): TelegramBot {\n    return this.bot;\n  }\n\n  async processWebhookUpdate(update: any) {\n    await this.bot.processUpdate(update);\n  }\n}\n\nlet telegramService: TelegramBotService | null = null;\n\nexport function initTelegramBot(token: string, webhookUrl?: string): TelegramBotService {\n  telegramService = new TelegramBotService(token, webhookUrl);\n  return telegramService;\n}\n\nexport function getTelegramBot(): TelegramBotService {\n  if (!telegramService) {\n    throw new Error('Telegram bot not initialized');\n  }\n  return telegramService;\n}\n\nexport function isTelegramBotInitialized(): boolean {\n  return telegramService !== null;\n}\n","path":null,"size_bytes":14048,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport Home from \"@/pages/Home\";\nimport Settings from \"@/pages/Settings\";\nimport OwnerDashboard from \"@/pages/owner/Dashboard\";\nimport OwnerRequests from \"@/pages/owner/Requests\";\nimport OwnerAnalytics from \"@/pages/owner/Analytics\";\nimport OwnerSales from \"@/pages/owner/Sales\";\nimport OwnerUsage from \"@/pages/owner/Usage\";\nimport StoreInventory from \"@/pages/store/Inventory\";\nimport StoreDespatch from \"@/pages/store/Despatch\";\nimport StoreReorder from \"@/pages/store/Reorder\";\nimport StoreUsage from \"@/pages/store/Usage\";\nimport ShopStock from \"@/pages/shop/Stock\";\nimport NotFound from \"@/pages/not-found\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Home} />\n      <Route path=\"/settings\" component={Settings} />\n      \n      {/* Owner Routes */}\n      <Route path=\"/owner\" component={OwnerDashboard} />\n      <Route path=\"/owner/requests\" component={OwnerRequests} />\n      <Route path=\"/owner/analytics\" component={OwnerAnalytics} />\n      <Route path=\"/owner/sales\" component={OwnerSales} />\n      <Route path=\"/owner/usage\" component={OwnerUsage} />\n      \n      {/* Store Routes */}\n      <Route path=\"/store\" component={StoreInventory} />\n      <Route path=\"/store/despatch\" component={StoreDespatch} />\n      <Route path=\"/store/reorder\" component={StoreReorder} />\n      <Route path=\"/store/usage\" component={StoreUsage} />\n      \n      {/* Shop Routes */}\n      <Route path=\"/shop\" component={ShopStock} />\n      \n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        <Router />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":2002,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Portal>\n    <TooltipPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </TooltipPrimitive.Portal>\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1267,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1598,"size_tokens":null},"vite-plugin-meta-images.ts":{"content":"import type { Plugin } from 'vite';\nimport fs from 'fs';\nimport path from 'path';\n\n/**\n * Vite plugin that updates og:image and twitter:image meta tags\n * to point to the app's opengraph image with the correct Replit domain.\n */\nexport function metaImagesPlugin(): Plugin {\n  return {\n    name: 'vite-plugin-meta-images',\n    transformIndexHtml(html) {\n      const baseUrl = getDeploymentUrl();\n      if (!baseUrl) {\n        log('[meta-images] no Replit deployment domain found, skipping meta tag updates');\n        return html;\n      }\n\n      // Check if opengraph image exists in public directory\n      const publicDir = path.resolve(process.cwd(), 'client', 'public');\n      const opengraphPngPath = path.join(publicDir, 'opengraph.png');\n      const opengraphJpgPath = path.join(publicDir, 'opengraph.jpg');\n      const opengraphJpegPath = path.join(publicDir, 'opengraph.jpeg');\n\n      let imageExt: string | null = null;\n      if (fs.existsSync(opengraphPngPath)) {\n        imageExt = 'png';\n      } else if (fs.existsSync(opengraphJpgPath)) {\n        imageExt = 'jpg';\n      } else if (fs.existsSync(opengraphJpegPath)) {\n        imageExt = 'jpeg';\n      }\n\n      if (!imageExt) {\n        log('[meta-images] OpenGraph image not found, skipping meta tag updates');\n        return html;\n      }\n\n      const imageUrl = `${baseUrl}/opengraph.${imageExt}`;\n\n      log('[meta-images] updating meta image tags to:', imageUrl);\n\n      html = html.replace(\n        /<meta\\s+property=\"og:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\n        `<meta property=\"og:image\" content=\"${imageUrl}\" />`\n      );\n\n      html = html.replace(\n        /<meta\\s+name=\"twitter:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\n        `<meta name=\"twitter:image\" content=\"${imageUrl}\" />`\n      );\n\n      return html;\n    },\n  };\n}\n\nfunction getDeploymentUrl(): string | null {\n  if (process.env.REPLIT_INTERNAL_APP_DOMAIN) {\n    const url = `https://${process.env.REPLIT_INTERNAL_APP_DOMAIN}`;\n    log('[meta-images] using internal app domain:', url);\n    return url;\n  }\n\n  if (process.env.REPLIT_DEV_DOMAIN) {\n    const url = `https://${process.env.REPLIT_DEV_DOMAIN}`;\n    log('[meta-images] using dev domain:', url);\n    return url;\n  }\n\n  return null;\n}\n\nfunction log(...args: any[]): void {\n  if (process.env.NODE_ENV === 'production') {\n    console.log(...args);\n  }\n}\n","path":null,"size_bytes":2333,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"pg\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1417,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md\",\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7606,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-2 w-full overflow-hidden rounded-full bg-primary/20\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":792,"size_tokens":null},"client/src/pages/store/Inventory.tsx":{"content":"import { useState } from \"react\";\nimport { MobileShell } from \"@/components/layout/MobileShell\";\nimport { BottomNav } from \"@/components/layout/BottomNav\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Search, Plus, Package, AlertTriangle, ArrowRight, Loader2 } from \"lucide-react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Link } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { InventoryItem } from \"@shared/schema\";\n\nfunction getStatus(item: InventoryItem): \"good\" | \"low\" | \"critical\" {\n  const stock = Number(item.currentStock);\n  const min = Number(item.minStock);\n  if (stock <= min * 0.5) return \"critical\";\n  if (stock <= min) return \"low\";\n  return \"good\";\n}\n\nexport default function StoreInventory() {\n  const [search, setSearch] = useState(\"\");\n  \n  const { data: inventory = [], isLoading } = useQuery<InventoryItem[]>({\n    queryKey: [\"/api/inventory\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/inventory\");\n      if (!res.ok) throw new Error(\"Failed to fetch inventory\");\n      return res.json();\n    },\n  });\n\n  const filteredInventory = inventory.filter(item => \n    item.name.toLowerCase().includes(search.toLowerCase())\n  );\n\n  return (\n    <MobileShell theme=\"store\" className=\"pb-20\">\n      <header className=\"sticky top-0 z-10 bg-background/80 backdrop-blur-md px-6 py-4 border-b space-y-4\">\n        <div className=\"flex items-center justify-between\">\n          <h1 className=\"text-2xl font-bold tracking-tight text-primary\">Store</h1>\n          <Link href=\"/store/reorder\">\n            <Button size=\"icon\" className=\"rounded-full bg-primary text-primary-foreground hover:bg-primary/90\">\n              <Plus className=\"h-5 w-5\" />\n            </Button>\n          </Link>\n        </div>\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input \n            placeholder=\"Search inventory...\" \n            className=\"pl-9 bg-secondary/50 border-none\"\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n          />\n        </div>\n      </header>\n\n      <main className=\"p-4 space-y-4\">\n        <div className=\"flex items-center justify-between px-1\">\n          <h2 className=\"text-sm font-semibold text-foreground\">Current Stock</h2>\n          <Link href=\"/store/despatch\">\n            <Button variant=\"link\" className=\"h-auto p-0 text-primary text-xs\">View Despatch Log</Button>\n          </Link>\n        </div>\n\n        {isLoading ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n          </div>\n        ) : filteredInventory.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center py-12 text-muted-foreground\">\n            <Package className=\"h-12 w-12 mb-2 opacity-50\" />\n            <p className=\"text-sm\">No inventory items found</p>\n            <Link href=\"/settings\">\n              <Button variant=\"link\" className=\"text-primary mt-2\">Sync from PosterPOS</Button>\n            </Link>\n          </div>\n        ) : (\n          filteredInventory.map((item) => {\n            const status = getStatus(item);\n            return (\n              <Card key={item.id} className=\"overflow-hidden border-none shadow-sm ring-1 ring-border/50\">\n                <CardContent className=\"p-0 flex items-center justify-between\">\n                  <div className=\"p-4 flex items-center gap-3\">\n                    <div className=\"h-10 w-10 rounded-lg flex items-center justify-center bg-secondary\">\n                      <Package className=\"h-5 w-5 text-muted-foreground\" />\n                    </div>\n                    <div>\n                      <h3 className=\"font-medium text-sm\">{item.name}</h3>\n                      <p className=\"text-xs text-muted-foreground\">Min: {item.minStock} {item.unit}</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"pr-4 flex flex-col items-end gap-1\">\n                    <span className=\"font-bold font-mono text-lg\">{item.currentStock}</span>\n                    {status === \"low\" && <Badge variant=\"secondary\" className=\"text-xs bg-yellow-100 text-yellow-700 hover:bg-yellow-100\">Low</Badge>}\n                    {status === \"critical\" && <Badge variant=\"destructive\" className=\"text-xs\">Critical</Badge>}\n                    {status === \"good\" && <Badge variant=\"outline\" className=\"text-xs text-green-600 border-green-200 bg-green-50\">OK</Badge>}\n                  </div>\n                </CardContent>\n                \n                {(status === \"low\" || status === \"critical\") && (\n                   <Link href=\"/store/reorder\" className=\"bg-red-50 px-4 py-2 flex items-center justify-between hover:bg-red-100 transition-colors\">\n                     <div className=\"flex items-center gap-2 text-xs text-red-700\">\n                       <AlertTriangle className=\"h-3 w-3\" />\n                       <span>Reorder recommended</span>\n                     </div>\n                     <ArrowRight className=\"h-3 w-3 text-red-700\" />\n                   </Link>\n                )}\n              </Card>\n            );\n          })\n        )}\n      </main>\n      <BottomNav role=\"store\" />\n    </MobileShell>\n  );\n}\n","path":null,"size_bytes":5460,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport {\n  ChevronDownIcon,\n  ChevronLeftIcon,\n  ChevronRightIcon,\n} from \"lucide-react\"\nimport { DayButton, DayPicker, getDefaultClassNames } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button, buttonVariants } from \"@/components/ui/button\"\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  captionLayout = \"label\",\n  buttonVariant = \"ghost\",\n  formatters,\n  components,\n  ...props\n}: React.ComponentProps<typeof DayPicker> & {\n  buttonVariant?: React.ComponentProps<typeof Button>[\"variant\"]\n}) {\n  const defaultClassNames = getDefaultClassNames()\n\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\n        \"bg-background group/calendar p-3 [--cell-size:2rem] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent\",\n        String.raw`rtl:**:[.rdp-button\\_next>svg]:rotate-180`,\n        String.raw`rtl:**:[.rdp-button\\_previous>svg]:rotate-180`,\n        className\n      )}\n      captionLayout={captionLayout}\n      formatters={{\n        formatMonthDropdown: (date) =>\n          date.toLocaleString(\"default\", { month: \"short\" }),\n        ...formatters,\n      }}\n      classNames={{\n        root: cn(\"w-fit\", defaultClassNames.root),\n        months: cn(\n          \"relative flex flex-col gap-4 md:flex-row\",\n          defaultClassNames.months\n        ),\n        month: cn(\"flex w-full flex-col gap-4\", defaultClassNames.month),\n        nav: cn(\n          \"absolute inset-x-0 top-0 flex w-full items-center justify-between gap-1\",\n          defaultClassNames.nav\n        ),\n        button_previous: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_previous\n        ),\n        button_next: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_next\n        ),\n        month_caption: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center px-[--cell-size]\",\n          defaultClassNames.month_caption\n        ),\n        dropdowns: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center gap-1.5 text-sm font-medium\",\n          defaultClassNames.dropdowns\n        ),\n        dropdown_root: cn(\n          \"has-focus:border-ring border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] relative rounded-md border\",\n          defaultClassNames.dropdown_root\n        ),\n        dropdown: cn(\n          \"bg-popover absolute inset-0 opacity-0\",\n          defaultClassNames.dropdown\n        ),\n        caption_label: cn(\n          \"select-none font-medium\",\n          captionLayout === \"label\"\n            ? \"text-sm\"\n            : \"[&>svg]:text-muted-foreground flex h-8 items-center gap-1 rounded-md pl-2 pr-1 text-sm [&>svg]:size-3.5\",\n          defaultClassNames.caption_label\n        ),\n        table: \"w-full border-collapse\",\n        weekdays: cn(\"flex\", defaultClassNames.weekdays),\n        weekday: cn(\n          \"text-muted-foreground flex-1 select-none rounded-md text-[0.8rem] font-normal\",\n          defaultClassNames.weekday\n        ),\n        week: cn(\"mt-2 flex w-full\", defaultClassNames.week),\n        week_number_header: cn(\n          \"w-[--cell-size] select-none\",\n          defaultClassNames.week_number_header\n        ),\n        week_number: cn(\n          \"text-muted-foreground select-none text-[0.8rem]\",\n          defaultClassNames.week_number\n        ),\n        day: cn(\n          \"group/day relative aspect-square h-full w-full select-none p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md\",\n          defaultClassNames.day\n        ),\n        range_start: cn(\n          \"bg-accent rounded-l-md\",\n          defaultClassNames.range_start\n        ),\n        range_middle: cn(\"rounded-none\", defaultClassNames.range_middle),\n        range_end: cn(\"bg-accent rounded-r-md\", defaultClassNames.range_end),\n        today: cn(\n          \"bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none\",\n          defaultClassNames.today\n        ),\n        outside: cn(\n          \"text-muted-foreground aria-selected:text-muted-foreground\",\n          defaultClassNames.outside\n        ),\n        disabled: cn(\n          \"text-muted-foreground opacity-50\",\n          defaultClassNames.disabled\n        ),\n        hidden: cn(\"invisible\", defaultClassNames.hidden),\n        ...classNames,\n      }}\n      components={{\n        Root: ({ className, rootRef, ...props }) => {\n          return (\n            <div\n              data-slot=\"calendar\"\n              ref={rootRef}\n              className={cn(className)}\n              {...props}\n            />\n          )\n        },\n        Chevron: ({ className, orientation, ...props }) => {\n          if (orientation === \"left\") {\n            return (\n              <ChevronLeftIcon className={cn(\"size-4\", className)} {...props} />\n            )\n          }\n\n          if (orientation === \"right\") {\n            return (\n              <ChevronRightIcon\n                className={cn(\"size-4\", className)}\n                {...props}\n              />\n            )\n          }\n\n          return (\n            <ChevronDownIcon className={cn(\"size-4\", className)} {...props} />\n          )\n        },\n        DayButton: CalendarDayButton,\n        WeekNumber: ({ children, ...props }) => {\n          return (\n            <td {...props}>\n              <div className=\"flex size-[--cell-size] items-center justify-center text-center\">\n                {children}\n              </div>\n            </td>\n          )\n        },\n        ...components,\n      }}\n      {...props}\n    />\n  )\n}\n\nfunction CalendarDayButton({\n  className,\n  day,\n  modifiers,\n  ...props\n}: React.ComponentProps<typeof DayButton>) {\n  const defaultClassNames = getDefaultClassNames()\n\n  const ref = React.useRef<HTMLButtonElement>(null)\n  React.useEffect(() => {\n    if (modifiers.focused) ref.current?.focus()\n  }, [modifiers.focused])\n\n  return (\n    <Button\n      ref={ref}\n      variant=\"ghost\"\n      size=\"icon\"\n      data-day={day.date.toLocaleDateString()}\n      data-selected-single={\n        modifiers.selected &&\n        !modifiers.range_start &&\n        !modifiers.range_end &&\n        !modifiers.range_middle\n      }\n      data-range-start={modifiers.range_start}\n      data-range-end={modifiers.range_end}\n      data-range-middle={modifiers.range_middle}\n      className={cn(\n        \"data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 flex aspect-square h-auto w-full min-w-[--cell-size] flex-col gap-1 font-normal leading-none data-[range-end=true]:rounded-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] [&>span]:text-xs [&>span]:opacity-70\",\n        defaultClassNames.day,\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Calendar, CalendarDayButton }\n","path":null,"size_bytes":7569,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogTrigger,\n  DialogClose,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3835,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Minus } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-9 w-9 items-center justify-center border-y border-r border-input text-sm shadow-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-1 ring-ring\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Minus />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2143,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"import * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-9 items-center space-x-1 rounded-md border bg-background p-1 shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8608,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1877,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4419,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n\" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n           // @replit: no hover, and add primary border\n           \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground shadow-sm border-destructive-border\",\n        outline:\n          // @replit Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color. Uses shadow-xs. no shadow on active\n          // No hover state\n          \" border [border-color:var(--button-outline)] shadow-xs active:shadow-none \",\n        secondary:\n          // @replit border, no hover, no shadow, secondary border.\n          \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // @replit no hover, transparent border\n        ghost: \"border border-transparent\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        // @replit changed sizes\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2356,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/pages/owner/Sales.tsx":{"content":"import { useState } from \"react\";\nimport { MobileShell } from \"@/components/layout/MobileShell\";\nimport { BottomNav } from \"@/components/layout/BottomNav\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Calendar, Receipt, TrendingUp, Loader2, ChevronLeft, ChevronRight } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { format, subDays, startOfDay, endOfDay } from \"date-fns\";\n\ntype DateRange = \"today\" | \"yesterday\" | \"week\" | \"month\" | \"custom\";\n\nexport default function OwnerSales() {\n  const [dateRange, setDateRange] = useState<DateRange>(\"today\");\n  const [customFrom, setCustomFrom] = useState<Date>(subDays(new Date(), 7));\n  const [customTo, setCustomTo] = useState<Date>(new Date());\n\n  const getDateParams = () => {\n    const now = new Date();\n    switch (dateRange) {\n      case \"today\":\n        return { from: startOfDay(now).toISOString(), to: endOfDay(now).toISOString() };\n      case \"yesterday\":\n        const yesterday = subDays(now, 1);\n        return { from: startOfDay(yesterday).toISOString(), to: endOfDay(yesterday).toISOString() };\n      case \"week\":\n        return { from: startOfDay(subDays(now, 7)).toISOString(), to: endOfDay(now).toISOString() };\n      case \"month\":\n        return { from: startOfDay(subDays(now, 30)).toISOString(), to: endOfDay(now).toISOString() };\n      case \"custom\":\n        return { from: startOfDay(customFrom).toISOString(), to: endOfDay(customTo).toISOString() };\n    }\n  };\n\n  const params = getDateParams();\n  \n  const { data, isLoading } = useQuery<{ \n    sales: any[]; \n    summary: { total: number; count: number; from: string; to: string } \n  }>({\n    queryKey: [\"/api/sales/range\", params.from, params.to],\n    queryFn: async () => {\n      const res = await fetch(`/api/sales/range?from=${params.from}&to=${params.to}`);\n      if (!res.ok) throw new Error(\"Failed to fetch sales\");\n      return res.json();\n    },\n  });\n\n  const formatTime = (date: string) => {\n    return new Date(date).toLocaleTimeString('en-US', { \n      hour: '2-digit', \n      minute: '2-digit' \n    });\n  };\n\n  const formatDate = (date: string) => {\n    return new Date(date).toLocaleDateString('en-US', { \n      month: 'short', \n      day: 'numeric' \n    });\n  };\n\n  return (\n    <MobileShell theme=\"owner\" className=\"pb-20\">\n      <header className=\"sticky top-0 z-10 bg-background/80 backdrop-blur-md px-6 py-4 border-b\">\n        <h1 className=\"text-xl font-bold tracking-tight text-primary\">Sales</h1>\n      </header>\n\n      <main className=\"p-4 space-y-4\">\n        {/* Date Range Selector */}\n        <div className=\"flex gap-2 overflow-x-auto pb-2 -mx-1 px-1\">\n          {[\n            { key: \"today\", label: \"Today\" },\n            { key: \"yesterday\", label: \"Yesterday\" },\n            { key: \"week\", label: \"7 Days\" },\n            { key: \"month\", label: \"30 Days\" },\n          ].map(({ key, label }) => (\n            <Button\n              key={key}\n              variant={dateRange === key ? \"default\" : \"outline\"}\n              size=\"sm\"\n              className=\"shrink-0\"\n              onClick={() => setDateRange(key as DateRange)}\n            >\n              {label}\n            </Button>\n          ))}\n        </div>\n\n        {/* Summary Card */}\n        <Card className=\"bg-primary text-primary-foreground border-none\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm opacity-80\">\n                  {dateRange === \"today\" ? \"Today's Sales\" : \n                   dateRange === \"yesterday\" ? \"Yesterday's Sales\" :\n                   dateRange === \"week\" ? \"Last 7 Days\" : \"Last 30 Days\"}\n                </p>\n                <div className=\"flex items-baseline gap-2 mt-1\">\n                  {isLoading ? (\n                    <Loader2 className=\"h-6 w-6 animate-spin\" />\n                  ) : (\n                    <>\n                      <span className=\"text-3xl font-bold\">\n                        KES {data?.summary.total.toFixed(2) || \"0.00\"}\n                      </span>\n                    </>\n                  )}\n                </div>\n              </div>\n              <div className=\"text-right\">\n                <TrendingUp className=\"h-8 w-8 opacity-50\" />\n                <p className=\"text-sm opacity-80 mt-1\">\n                  {data?.summary.count || 0} receipts\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Sales List */}\n        <div className=\"space-y-3\">\n          <h3 className=\"text-sm font-semibold text-muted-foreground uppercase tracking-wider px-1 flex items-center gap-2\">\n            <Receipt className=\"h-4 w-4\" />\n            Transactions\n          </h3>\n\n          {isLoading ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n            </div>\n          ) : !data?.sales.length ? (\n            <Card className=\"p-8 text-center\">\n              <Calendar className=\"h-12 w-12 mx-auto text-muted-foreground/50 mb-2\" />\n              <p className=\"text-muted-foreground\">No sales in this period</p>\n            </Card>\n          ) : (\n            data.sales.map((sale, idx) => (\n              <Card key={sale.id || idx} className=\"border-none shadow-sm\">\n                <CardContent className=\"p-4 flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"h-10 w-10 rounded-full bg-green-100 flex items-center justify-center text-green-600\">\n                      <Receipt className=\"h-5 w-5\" />\n                    </div>\n                    <div>\n                      <p className=\"font-medium text-sm\">{sale.itemName}</p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {formatDate(sale.timestamp)} at {formatTime(sale.timestamp)}\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"font-bold\">KES {Number(sale.amount).toFixed(2)}</p>\n                    <p className=\"text-xs text-muted-foreground\">x{sale.quantity}</p>\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          )}\n        </div>\n      </main>\n      <BottomNav role=\"owner\" />\n    </MobileShell>\n  );\n}\n","path":null,"size_bytes":6529,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":2001,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1148,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4887,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"server/routes.ts":{"content":"import type { Express, Request, Response, NextFunction } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { db } from \"./db\";\nimport { z } from \"zod\";\nimport { insertInventoryItemSchema, insertSalesRecordSchema, insertDespatchLogSchema, insertReorderRequestSchema } from \"@shared/schema\";\nimport { initPosterPOSClient, getPosterPOSClient, isPosterPOSInitialized } from \"./posterpos\";\nimport { initTelegramBot, getTelegramBot, isTelegramBotInitialized } from \"./telegram\";\nimport { startTransactionSync, syncNewTransactions, getLastSyncTimestamp } from \"./transactionSync\";\nimport { log } from \"./index\";\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  \n  // Initialize PosterPOS from environment variables (secure)\n  const posterEndpoint = process.env.POSTERPOS_API_ENDPOINT;\n  const posterToken = process.env.POSTERPOS_API_TOKEN;\n  \n  if (posterEndpoint && posterToken) {\n    try {\n      initPosterPOSClient(posterEndpoint, posterToken);\n      log('PosterPOS client initialized from environment');\n    } catch (error) {\n      log(`Failed to initialize PosterPOS client: ${error}`);\n    }\n  }\n\n  // Initialize Telegram bot from environment variables (secure)\n  const telegramToken = process.env.TELEGRAM_BOT_TOKEN;\n  const webhookUrl = process.env.TELEGRAM_WEBHOOK_URL;\n  \n  if (telegramToken) {\n    try {\n      initTelegramBot(telegramToken, webhookUrl);\n      log('Telegram bot initialized from environment');\n    } catch (error) {\n      log(`Failed to initialize Telegram bot: ${error}`);\n    }\n  }\n\n  // Start background transaction sync (10-minute polling)\n  if (posterEndpoint && posterToken && telegramToken) {\n    startTransactionSync();\n    log('Transaction sync started (10-minute interval)');\n  }\n\n  // ============ INVENTORY ROUTES ============\n  app.get(\"/api/inventory\", async (req, res) => {\n    try {\n      const items = await storage.getAllInventoryItems();\n      res.json(items);\n    } catch (error: any) {\n      log(`Error fetching inventory: ${error.message}`);\n      res.status(500).json({ message: \"Failed to fetch inventory\" });\n    }\n  });\n\n  app.get(\"/api/inventory/low-stock\", async (req, res) => {\n    try {\n      const items = await storage.getLowStockItems();\n      res.json(items);\n    } catch (error: any) {\n      log(`Error fetching low stock: ${error.message}`);\n      res.status(500).json({ message: \"Failed to fetch low stock items\" });\n    }\n  });\n\n  app.post(\"/api/inventory\", async (req, res) => {\n    try {\n      const data = insertInventoryItemSchema.parse(req.body);\n      const item = await storage.createInventoryItem(data);\n      res.status(201).json(item);\n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      } else {\n        log(`Error creating inventory item: ${error.message}`);\n        res.status(500).json({ message: \"Failed to create inventory item\" });\n      }\n    }\n  });\n\n  app.patch(\"/api/inventory/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const updates = req.body;\n      const item = await storage.updateInventoryItem(id, updates);\n      \n      if (!item) {\n        res.status(404).json({ message: \"Item not found\" });\n        return;\n      }\n\n      // Check if stock is now low and send alert\n      const currentStock = Number(item.currentStock);\n      const minStock = Number(item.minStock);\n      \n      if (currentStock <= minStock && isTelegramBotInitialized()) {\n        try {\n          const bot = getTelegramBot();\n          await bot.sendLowStockAlert(item.name, item.currentStock, item.minStock);\n        } catch (e) {\n          log(`Failed to send low stock alert: ${e}`);\n        }\n      }\n\n      res.json(item);\n    } catch (error: any) {\n      log(`Error updating inventory: ${error.message}`);\n      res.status(500).json({ message: \"Failed to update inventory\" });\n    }\n  });\n\n  // ============ SALES ROUTES ============\n  app.get(\"/api/sales\", async (req, res) => {\n    try {\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 100;\n      const sales = await storage.getAllSalesRecords(limit);\n      res.json(sales);\n    } catch (error: any) {\n      log(`Error fetching sales: ${error.message}`);\n      res.status(500).json({ message: \"Failed to fetch sales\" });\n    }\n  });\n\n  app.get(\"/api/sales/today\", async (req, res) => {\n    try {\n      const summary = await storage.getTodaysSales();\n      res.json(summary);\n    } catch (error: any) {\n      log(`Error fetching today's sales: ${error.message}`);\n      res.status(500).json({ message: \"Failed to fetch today's sales\" });\n    }\n  });\n\n  app.post(\"/api/sales\", async (req, res) => {\n    try {\n      const data = insertSalesRecordSchema.parse(req.body);\n      const sale = await storage.createSalesRecord(data);\n\n      // Send Telegram notification if bot is configured\n      if (isTelegramBotInitialized()) {\n        try {\n          const bot = getTelegramBot();\n          await bot.sendSaleNotification(sale.itemName, sale.quantity, sale.amount);\n        } catch (e) {\n          log(`Failed to send sale notification: ${e}`);\n        }\n      }\n\n      res.status(201).json(sale);\n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      } else {\n        log(`Error creating sale: ${error.message}`);\n        res.status(500).json({ message: \"Failed to create sale\" });\n      }\n    }\n  });\n\n  // ============ DESPATCH ROUTES ============\n  app.get(\"/api/despatch\", async (req, res) => {\n    try {\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 50;\n      const logs = await storage.getAllDespatchLogs(limit);\n      res.json(logs);\n    } catch (error: any) {\n      log(`Error fetching despatch logs: ${error.message}`);\n      res.status(500).json({ message: \"Failed to fetch despatch logs\" });\n    }\n  });\n\n  app.post(\"/api/despatch\", async (req, res) => {\n    try {\n      const data = insertDespatchLogSchema.parse(req.body);\n      \n      // Use transaction to ensure atomic update\n      const result = await storage.createDespatchWithInventoryUpdate(data);\n      \n      res.status(201).json(result);\n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      } else {\n        log(`Error creating despatch: ${error.message}`);\n        res.status(500).json({ message: \"Failed to create despatch log\" });\n      }\n    }\n  });\n\n  app.post(\"/api/despatch/batch\", async (req, res) => {\n    try {\n      const batchSchema = z.object({\n        items: z.array(z.object({\n          inventoryItemId: z.string(),\n          itemName: z.string(),\n          quantity: z.string(),\n          unit: z.string(),\n        })),\n        destination: z.string(),\n        createdBy: z.string(),\n      });\n      \n      const { items, destination, createdBy } = batchSchema.parse(req.body);\n      const results = [];\n      \n      for (const item of items) {\n        const data = {\n          inventoryItemId: item.inventoryItemId,\n          itemName: item.itemName,\n          quantity: item.quantity,\n          destination,\n          createdBy,\n        };\n        const result = await storage.createDespatchWithInventoryUpdate(data);\n        results.push(result);\n      }\n      \n      res.status(201).json({ count: results.length, despatches: results });\n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      } else {\n        log(`Error creating batch despatch: ${error.message}`);\n        res.status(500).json({ message: \"Failed to create batch despatch\" });\n      }\n    }\n  });\n\n  // ============ REORDER REQUEST ROUTES ============\n  app.get(\"/api/requests\", async (req, res) => {\n    try {\n      const status = req.query.status as string;\n      const requests = status === \"pending\" \n        ? await storage.getPendingReorderRequests()\n        : await storage.getAllReorderRequests();\n      res.json(requests);\n    } catch (error: any) {\n      log(`Error fetching requests: ${error.message}`);\n      res.status(500).json({ message: \"Failed to fetch requests\" });\n    }\n  });\n\n  app.post(\"/api/requests\", async (req, res) => {\n    try {\n      const data = insertReorderRequestSchema.parse(req.body);\n      const request = await storage.createReorderRequest(data);\n\n      // Send notification to owner if bot is configured\n      if (isTelegramBotInitialized()) {\n        try {\n          const bot = getTelegramBot();\n          await bot.sendReorderRequestNotification(request.itemName, request.requester);\n        } catch (e) {\n          log(`Failed to send reorder notification: ${e}`);\n        }\n      }\n\n      res.status(201).json(request);\n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      } else {\n        log(`Error creating request: ${error.message}`);\n        res.status(500).json({ message: \"Failed to create request\" });\n      }\n    }\n  });\n\n  app.patch(\"/api/requests/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const updates = req.body;\n      \n      if (updates.status === 'approved') {\n        updates.approvedAt = new Date();\n      }\n\n      const request = await storage.updateReorderRequest(id, updates);\n      \n      if (!request) {\n        res.status(404).json({ message: \"Request not found\" });\n        return;\n      }\n\n      res.json(request);\n    } catch (error: any) {\n      log(`Error updating request: ${error.message}`);\n      res.status(500).json({ message: \"Failed to update request\" });\n    }\n  });\n\n  // ============ POSTERPOS SYNC ROUTES ============\n  app.post(\"/api/posterpos/sync/inventory\", async (req, res) => {\n    try {\n      const client = getPosterPOSClient();\n      const stockLevels = await client.getStockLevels();\n\n      const synced: any[] = [];\n      for (const stock of stockLevels) {\n        const existing = await storage.getInventoryItemByPosterPosId(stock.product_id.toString());\n        \n        if (existing) {\n          const updated = await storage.updateInventoryItem(existing.id, {\n            currentStock: stock.stock_count.toString(),\n            lastSyncedAt: new Date(),\n          });\n          synced.push(updated);\n        } else {\n          const created = await storage.createInventoryItem({\n            posterPosId: stock.product_id.toString(),\n            name: stock.product_name,\n            currentStock: stock.stock_count.toString(),\n            minStock: \"10\",\n            unit: stock.unit_name || \"units\",\n            lastSyncedAt: new Date(),\n          });\n          synced.push(created);\n        }\n      }\n\n      res.json({ message: `Synced ${synced.length} items`, items: synced });\n    } catch (error: any) {\n      log(`Error syncing inventory: ${error.message}`);\n      res.status(500).json({ message: error.message || \"Failed to sync inventory\" });\n    }\n  });\n\n  app.post(\"/api/posterpos/sync/sales\", async (req, res) => {\n    try {\n      const client = getPosterPOSClient();\n      const days = Number(req.query.days) || 7;\n      const transactions = await client.getRecentTransactions(days);\n\n      log(`Fetched ${transactions.length} transactions from last ${days} days`);\n\n      const synced: any[] = [];\n      for (const transaction of transactions) {\n        if (!transaction.products) continue;\n        \n        for (const product of transaction.products) {\n          const posterPosId = `${transaction.transaction_id}-${product.product_id}`;\n          \n          const existing = await storage.getSalesRecordByPosterPosId(posterPosId);\n          if (existing) continue;\n          \n          const sale = await storage.createSalesRecord({\n            posterPosId,\n            itemName: `Product #${product.product_id}`,\n            quantity: product.num || '1',\n            amount: (product.payed_sum || product.product_price || 0).toString(),\n            timestamp: new Date(transaction.date_close),\n            syncedAt: new Date(),\n          });\n          synced.push(sale);\n        }\n      }\n\n      res.json({ message: `Synced ${synced.length} sales from ${transactions.length} transactions`, sales: synced });\n    } catch (error: any) {\n      log(`Error syncing sales: ${error.message}`);\n      res.status(500).json({ message: error.message || \"Failed to sync sales\" });\n    }\n  });\n\n  // Manual trigger for transaction sync (posts new receipts to Sales channel)\n  app.post(\"/api/posterpos/sync/transactions\", async (req, res) => {\n    try {\n      if (!isPosterPOSInitialized()) {\n        res.status(503).json({ message: \"PosterPOS not configured\" });\n        return;\n      }\n      \n      const count = await syncNewTransactions();\n      const lastSync = getLastSyncTimestamp();\n      \n      res.json({ \n        message: `Synced ${count} new transactions`,\n        notified: count,\n        lastSyncTimestamp: lastSync,\n        lastSyncTime: lastSync ? new Date(lastSync * 1000).toISOString() : null,\n      });\n    } catch (error: any) {\n      log(`Error in manual transaction sync: ${error.message}`);\n      res.status(500).json({ message: error.message || \"Failed to sync transactions\" });\n    }\n  });\n\n  // Get sync status\n  app.get(\"/api/posterpos/sync/status\", async (req, res) => {\n    const lastSync = getLastSyncTimestamp();\n    res.json({\n      posterPosConfigured: isPosterPOSInitialized(),\n      telegramConfigured: isTelegramBotInitialized(),\n      lastSyncTimestamp: lastSync,\n      lastSyncTime: lastSync ? new Date(lastSync * 1000).toISOString() : null,\n      syncInterval: '10 minutes',\n    });\n  });\n\n  // ============ DEBUG: Test transaction products lookup ============\n  app.get(\"/api/posterpos/transaction-products/:id\", async (req, res) => {\n    try {\n      const client = getPosterPOSClient();\n      const txId = req.params.id;\n      const result = await client.getTransactionProducts(txId);\n      res.json({ transaction_id: txId, products: result });\n    } catch (error: any) {\n      log(`Error fetching transaction products: ${error.message}`);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // ============ INGREDIENT MOVEMENTS ============\n  app.get(\"/api/posterpos/movements\", async (req, res) => {\n    try {\n      const client = getPosterPOSClient();\n      const { from, to, type } = req.query;\n      \n      let dateFrom: string | undefined;\n      let dateTo: string | undefined;\n      \n      if (from) {\n        dateFrom = new Date(from as string).toISOString().split('T')[0].replace(/-/g, '');\n      } else {\n        // Default to today\n        dateFrom = new Date().toISOString().split('T')[0].replace(/-/g, '');\n      }\n      \n      if (to) {\n        dateTo = new Date(to as string).toISOString().split('T')[0].replace(/-/g, '');\n      } else {\n        dateTo = new Date().toISOString().split('T')[0].replace(/-/g, '');\n      }\n      \n      const movements = await client.getIngredientMovements(dateFrom, dateTo, type ? Number(type) : 1);\n      \n      // Filter to show only items with usage (write_offs > 0)\n      const withUsage = movements.filter(m => m.write_offs > 0);\n      \n      // Calculate summary\n      const totalUsage = movements.reduce((sum, m) => sum + m.write_offs, 0);\n      const totalCost = movements.reduce((sum, m) => sum + (m.write_offs * m.cost_end), 0);\n      \n      res.json({\n        movements,\n        withUsage,\n        summary: {\n          totalItems: movements.length,\n          itemsWithUsage: withUsage.length,\n          totalUsage,\n          totalCost: totalCost.toFixed(2),\n          dateFrom,\n          dateTo,\n        }\n      });\n    } catch (error: any) {\n      log(`Error fetching movements: ${error.message}`);\n      res.status(500).json({ message: error.message || \"Failed to fetch ingredient movements\" });\n    }\n  });\n\n  app.get(\"/api/posterpos/movements/today\", async (req, res) => {\n    try {\n      const client = getPosterPOSClient();\n      const movements = await client.getTodaysIngredientMovements();\n      \n      // Filter to show only items with usage\n      const withUsage = movements.filter(m => m.write_offs > 0);\n      \n      res.json({\n        movements: withUsage,\n        summary: {\n          totalItems: movements.length,\n          itemsWithUsage: withUsage.length,\n          totalUsage: withUsage.reduce((sum, m) => sum + m.write_offs, 0),\n        }\n      });\n    } catch (error: any) {\n      log(`Error fetching today's movements: ${error.message}`);\n      res.status(500).json({ message: error.message || \"Failed to fetch movements\" });\n    }\n  });\n\n  // Ingredient usage endpoint for Owner Usage page\n  app.get(\"/api/usage\", async (req, res) => {\n    try {\n      const client = getPosterPOSClient();\n      const { from, to } = req.query;\n      \n      let dateFrom: string;\n      let dateTo: string;\n      \n      if (from) {\n        dateFrom = new Date(from as string).toISOString().split('T')[0].replace(/-/g, '');\n      } else {\n        dateFrom = new Date().toISOString().split('T')[0].replace(/-/g, '');\n      }\n      \n      if (to) {\n        dateTo = new Date(to as string).toISOString().split('T')[0].replace(/-/g, '');\n      } else {\n        dateTo = new Date().toISOString().split('T')[0].replace(/-/g, '');\n      }\n      \n      // No type filter - get all movements and filter for write_offs\n      const movements = await client.getIngredientMovements(dateFrom, dateTo);\n      \n      log(`Usage API: Got ${movements.length} ingredients for ${dateFrom} to ${dateTo}`);\n      \n      // Filter to only ingredients with POSITIVE write_offs (expense/usage)\n      // Ignore negative values which are corrections/reversals\n      const usage = movements\n        .filter(m => {\n          const writeOff = Number(m.write_offs) || 0;\n          return writeOff > 0;\n        })\n        .map(m => {\n          const writeOff = Math.abs(Number(m.write_offs) || 0);\n          const costEnd = Number(m.cost_end) || 0;\n          return {\n            id: m.ingredient_id,\n            name: m.ingredient_name,\n            quantity: writeOff,\n            unit: '',\n            costPerUnit: costEnd / 100,\n            totalCost: (writeOff * costEnd) / 100,\n          };\n        })\n        .sort((a, b) => b.totalCost - a.totalCost);\n      \n      const totalCost = usage.reduce((sum, u) => sum + u.totalCost, 0);\n      const totalItems = usage.length;\n      \n      log(`Usage API: Filtered to ${totalItems} ingredients with usage, total cost: ${totalCost.toFixed(2)}`);\n      \n      res.json({\n        usage,\n        summary: {\n          totalCost,\n          totalItems,\n          from: from || new Date().toISOString(),\n          to: to || new Date().toISOString(),\n        }\n      });\n    } catch (error: any) {\n      log(`Error fetching usage: ${error.message}`);\n      res.status(500).json({ message: error.message || \"Failed to fetch usage data\" });\n    }\n  });\n\n  // Real-time ingredient usage based on transactions and recipes\n  app.get(\"/api/realtime-usage\", async (req, res) => {\n    try {\n      const client = getPosterPOSClient();\n      const { from, to } = req.query;\n      \n      let dateFrom: string;\n      let dateTo: string;\n      \n      // Frontend now sends dates in YYYYMMDD format directly (local timezone)\n      if (from && /^\\d{8}$/.test(from as string)) {\n        dateFrom = from as string;\n      } else if (from) {\n        dateFrom = new Date(from as string).toISOString().split('T')[0].replace(/-/g, '');\n      } else {\n        dateFrom = new Date().toISOString().split('T')[0].replace(/-/g, '');\n      }\n      \n      if (to && /^\\d{8}$/.test(to as string)) {\n        dateTo = to as string;\n      } else if (to) {\n        dateTo = new Date(to as string).toISOString().split('T')[0].replace(/-/g, '');\n      } else {\n        dateTo = new Date().toISOString().split('T')[0].replace(/-/g, '');\n      }\n      \n      log(`Realtime usage: Fetching transactions from ${dateFrom} to ${dateTo}`);\n      \n      // Get transactions for the date range\n      const transactions = await client.getTransactions({ dateFrom, dateTo });\n      \n      log(`Realtime usage: Got ${transactions.length} transactions`);\n      \n      // Build a map of product recipes (cached per request)\n      const recipeCache: Map<string, any> = new Map();\n      // Track visited modifiers to prevent infinite loops\n      const processedModifiers: Set<string> = new Set();\n      \n      // Aggregate ingredient usage from all transactions\n      const ingredientUsage: Map<string, { \n        id: string; \n        name: string; \n        quantity: number; \n        unit: string;\n        productsSold: Map<string, { name: string; count: number }>;\n      }> = new Map();\n      \n      let totalProductsSold = 0;\n      \n      // Build a modifier name to recipe modifier lookup for faster matching\n      const buildModifierNameLookup = (recipe: any): Map<string, any> => {\n        const lookup = new Map<string, any>();\n        if (recipe.group_modifications) {\n          for (const group of recipe.group_modifications) {\n            for (const mod of group.modifications) {\n              // Store by lowercase trimmed name for fuzzy matching\n              const normalizedName = mod.name.toLowerCase().trim();\n              lookup.set(normalizedName, mod);\n            }\n          }\n        }\n        return lookup;\n      };\n\n      for (const transaction of transactions) {\n        if (!transaction.products || transaction.products.length === 0) continue;\n        \n        // Fetch detailed transaction products with modificator_name\n        const txProducts = await client.getTransactionProducts(transaction.transaction_id);\n        \n        for (let lineIdx = 0; lineIdx < txProducts.length; lineIdx++) {\n          const txProduct = txProducts[lineIdx];\n          const productId = txProduct.product_id.toString();\n          const quantitySold = parseFloat(txProduct.num) || 1;\n          totalProductsSold += quantitySold;\n          \n          // Get recipe for this product (cached)\n          let recipe = recipeCache.get(productId);\n          if (!recipe) {\n            recipe = await client.getProductWithRecipe(productId);\n            if (recipe) {\n              recipeCache.set(productId, recipe);\n            }\n          }\n          \n          if (recipe) {\n            // Process base recipe ingredients\n            if (recipe.ingredients && recipe.ingredients.length > 0) {\n              for (const ingredient of recipe.ingredients) {\n                const ingredientId = ingredient.ingredient_id;\n                const usageAmount = (ingredient.structure_netto || ingredient.structure_brutto) * quantitySold;\n                \n                const existing = ingredientUsage.get(ingredientId);\n                if (existing) {\n                  existing.quantity += usageAmount;\n                  const productEntry = existing.productsSold.get(productId);\n                  if (productEntry) {\n                    productEntry.count += quantitySold;\n                  } else {\n                    existing.productsSold.set(productId, { name: recipe.product_name, count: quantitySold });\n                  }\n                } else {\n                  const productsSold = new Map<string, { name: string; count: number }>();\n                  productsSold.set(productId, { name: recipe.product_name, count: quantitySold });\n                  ingredientUsage.set(ingredientId, {\n                    id: ingredientId,\n                    name: ingredient.ingredient_name,\n                    quantity: usageAmount,\n                    unit: ingredient.structure_unit || ingredient.ingredient_unit || '',\n                    productsSold,\n                  });\n                }\n              }\n            }\n            \n            // Process selected modifiers using modificator_name from transaction products\n            if (txProduct.modificator_name && recipe.group_modifications) {\n              const modifierLookup = buildModifierNameLookup(recipe);\n              \n              // Parse comma-separated modifier names\n              const selectedModifierNames = txProduct.modificator_name\n                .split(',')\n                .map((name: string) => name.toLowerCase().trim())\n                .filter((name: string) => name.length > 0);\n              \n              // Debug: Log modifier matching for Pure & Simple\n              if (recipe.product_name?.toLowerCase().includes('pure') || recipe.product_name?.toLowerCase().includes('simple')) {\n                log(`DEBUG Pure&Simple: Matched modifiers from \"${txProduct.modificator_name}\": [${selectedModifierNames.join(', ')}]`);\n              }\n              \n              for (const modName of selectedModifierNames) {\n                // Track to prevent double-processing within same line item\n                const modKey = `${transaction.transaction_id}-${lineIdx}-${modName}`;\n                if (processedModifiers.has(modKey)) continue;\n                processedModifiers.add(modKey);\n                \n                // Find the matching modifier in the recipe\n                const mod = modifierLookup.get(modName);\n                if (mod) {\n                  const modQty = 1; // Each selected modifier counts once\n                  const trackingKey = `${productId}-mod-${modName}`;\n                  \n                  // Process modifier with ingredient_id (type 10 = ingredient modifier)\n                  if (mod.ingredient_id && mod.ingredient_id !== '0' && mod.ingredient_id !== 0) {\n                    // Normalize ingredient ID to string\n                    const modIngredientId = mod.ingredient_id.toString();\n                    // Direct ingredient modifier - use netto with brutto fallback\n                    const usageAmount = (mod.netto || mod.brutto) * modQty * quantitySold;\n                    \n                    if (usageAmount > 0) {\n                      const existing = ingredientUsage.get(modIngredientId);\n                      if (existing) {\n                        existing.quantity += usageAmount;\n                        if (!existing.productsSold.has(trackingKey)) {\n                          existing.productsSold.set(trackingKey, { name: `${recipe.product_name} + ${mod.name}`, count: modQty * quantitySold });\n                        } else {\n                          const entry = existing.productsSold.get(trackingKey)!;\n                          entry.count += modQty * quantitySold;\n                        }\n                      } else {\n                        const productsSold = new Map<string, { name: string; count: number }>();\n                        productsSold.set(trackingKey, { name: `${recipe.product_name} + ${mod.name}`, count: modQty * quantitySold });\n                        ingredientUsage.set(modIngredientId, {\n                          id: modIngredientId,\n                          name: mod.ingredient_name || mod.name,\n                          quantity: usageAmount,\n                          unit: mod.ingredient_unit || '',\n                          productsSold,\n                        });\n                      }\n                    }\n                  }\n                  \n                  // Check if modifier references a product/dish (type 2/3) that needs recipe lookup\n                  if ((mod.type === '2' || mod.type === '3') && mod.product_id) {\n                    const modProductId = mod.product_id;\n                    let modRecipe = recipeCache.get(modProductId);\n                    if (!modRecipe) {\n                      modRecipe = await client.getProductWithRecipe(modProductId);\n                      if (modRecipe) recipeCache.set(modProductId, modRecipe);\n                    }\n                    \n                    if (modRecipe && modRecipe.ingredients) {\n                      for (const modIng of modRecipe.ingredients) {\n                        const modSubIngId = modIng.ingredient_id.toString();\n                        const usageAmount = (modIng.structure_netto || modIng.structure_brutto) * modQty * quantitySold;\n                        \n                        const existing = ingredientUsage.get(modSubIngId);\n                        if (existing) {\n                          existing.quantity += usageAmount;\n                          if (!existing.productsSold.has(trackingKey)) {\n                            existing.productsSold.set(trackingKey, { name: `${recipe.product_name} + ${mod.name}`, count: modQty * quantitySold });\n                          } else {\n                            const entry = existing.productsSold.get(trackingKey)!;\n                            entry.count += modQty * quantitySold;\n                          }\n                        } else {\n                          const productsSold = new Map<string, { name: string; count: number }>();\n                          productsSold.set(trackingKey, { name: `${recipe.product_name} + ${mod.name}`, count: modQty * quantitySold });\n                          ingredientUsage.set(modSubIngId, {\n                            id: modSubIngId,\n                            name: modIng.ingredient_name,\n                            quantity: usageAmount,\n                            unit: modIng.structure_unit || modIng.ingredient_unit || '',\n                            productsSold,\n                          });\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n      \n      // Convert to array and sort by quantity\n      const usage = Array.from(ingredientUsage.values())\n        .map(item => ({\n          id: item.id,\n          name: item.name,\n          quantity: item.quantity,\n          unit: item.unit,\n          products: Array.from(item.productsSold.values()),\n        }))\n        .sort((a, b) => b.quantity - a.quantity);\n      \n      log(`Realtime usage: Found ${usage.length} ingredients used across ${transactions.length} transactions`);\n      \n      res.json({\n        usage,\n        summary: {\n          totalIngredients: usage.length,\n          totalTransactions: transactions.length,\n          totalProductsSold,\n          from: from || new Date().toISOString(),\n          to: to || new Date().toISOString(),\n        }\n      });\n    } catch (error: any) {\n      log(`Error fetching realtime usage: ${error.message}`);\n      res.status(500).json({ message: error.message || \"Failed to fetch realtime usage data\" });\n    }\n  });\n\n  // Debug endpoint to inspect product recipes and modifiers\n  app.get(\"/api/debug/product/:productId\", async (req, res) => {\n    try {\n      const client = getPosterPOSClient();\n      const { productId } = req.params;\n      \n      // Get the product recipe\n      const recipe = await client.getProductWithRecipe(productId);\n      \n      if (!recipe) {\n        return res.status(404).json({ message: \"Product not found\" });\n      }\n      \n      // Get recent transactions that include this product\n      const today = new Date();\n      const weekAgo = new Date();\n      weekAgo.setDate(weekAgo.getDate() - 7);\n      \n      const dateFrom = weekAgo.toISOString().split('T')[0].replace(/-/g, '');\n      const dateTo = today.toISOString().split('T')[0].replace(/-/g, '');\n      \n      const transactions = await client.getTransactions({ dateFrom, dateTo });\n      \n      // Filter transactions that contain this product\n      const productTransactions = transactions\n        .filter(tx => tx.products?.some(p => p.product_id.toString() === productId))\n        .slice(0, 10) // Limit to 10 most recent\n        .map(tx => ({\n          transaction_id: tx.transaction_id,\n          date_close: tx.date_close,\n          products: tx.products?.filter(p => p.product_id.toString() === productId).map(p => ({\n            product_id: p.product_id,\n            num: p.num,\n            modifications: p.modifications,\n          })),\n        }));\n      \n      res.json({\n        recipe: {\n          product_id: recipe.product_id,\n          product_name: recipe.product_name,\n          ingredients: recipe.ingredients,\n          group_modifications: recipe.group_modifications,\n        },\n        recentTransactions: productTransactions,\n        summary: {\n          totalTransactionsWithProduct: productTransactions.length,\n          hasIngredients: (recipe.ingredients?.length || 0) > 0,\n          hasModifiers: (recipe.group_modifications?.length || 0) > 0,\n          modifierGroups: recipe.group_modifications?.map(g => ({\n            name: g.name,\n            modifierCount: g.modifications.length,\n            modifiers: g.modifications.map(m => ({\n              id: m.dish_modification_id,\n              name: m.name,\n              type: m.type,\n              ingredient_id: m.ingredient_id,\n              product_id: m.product_id,\n              brutto: m.brutto,\n              netto: m.netto,\n            })),\n          })),\n        },\n      });\n    } catch (error: any) {\n      log(`Error debugging product: ${error.message}`);\n      res.status(500).json({ message: error.message || \"Failed to debug product\" });\n    }\n  });\n\n  // ============ POSTERPOS WEBHOOK (Real-time receipts) ============\n  app.post(\"/api/posterpos/webhook\", async (req, res) => {\n    try {\n      const { object, action, data } = req.body;\n      log(`PosterPOS webhook: ${object}.${action}`, 'posterpos');\n\n      // Handle transaction events\n      if (object === 'transaction' && (action === 'added' || action === 'closed')) {\n        const transaction = data;\n        \n        // Calculate total\n        let totalAmount = 0;\n        const items: string[] = [];\n        \n        if (transaction.products) {\n          for (const product of transaction.products) {\n            totalAmount += Number(product.product_sum || 0);\n            items.push(product.product_name);\n          }\n        }\n\n        // Send Telegram notification for new sale to sales channel\n        if (isTelegramBotInitialized()) {\n          try {\n            const bot = getTelegramBot();\n            await bot.sendReceiptNotification(totalAmount, items);\n          } catch (e) {\n            log(`Failed to send receipt notification: ${e}`);\n          }\n        }\n\n        // Store in database\n        if (transaction.products) {\n          for (const product of transaction.products) {\n            const posterPosId = `${transaction.transaction_id}-${product.product_id}`;\n            const existing = await storage.getSalesRecordByPosterPosId(posterPosId);\n            if (!existing) {\n              await storage.createSalesRecord({\n                posterPosId,\n                itemName: product.product_name,\n                quantity: product.num || '1',\n                amount: (product.product_sum || 0).toString(),\n                timestamp: new Date(),\n                syncedAt: new Date(),\n              });\n            }\n          }\n        }\n      }\n\n      // Handle inventory changes - send to inventory channel\n      if (object === 'storage' || object === 'ingredient') {\n        if (isTelegramBotInitialized()) {\n          try {\n            const bot = getTelegramBot();\n            await bot.sendInventoryUpdate(`Stock ${action}`, data?.ingredient_name || data?.product_name);\n          } catch (e) {\n            log(`Failed to send inventory notification: ${e}`);\n          }\n        }\n      }\n\n      res.json({ ok: true });\n    } catch (error: any) {\n      log(`PosterPOS webhook error: ${error.message}`);\n      res.status(500).json({ message: \"Webhook processing failed\" });\n    }\n  });\n\n  // ============ SALES BY DATE RANGE ============\n  app.get(\"/api/sales/range\", async (req, res) => {\n    try {\n      const { from, to } = req.query;\n      \n      let fromDate = from ? new Date(from as string) : new Date();\n      let toDate = to ? new Date(to as string) : new Date();\n      \n      // Default to last 7 days if no dates provided\n      if (!from) {\n        fromDate.setDate(fromDate.getDate() - 7);\n      }\n      \n      // Set end of day for toDate\n      toDate.setHours(23, 59, 59, 999);\n      \n      const sales = await storage.getSalesRecordsSince(fromDate);\n      const filtered = sales.filter(s => new Date(s.timestamp) <= toDate);\n      \n      const total = filtered.reduce((sum, s) => sum + Number(s.amount), 0);\n      \n      res.json({\n        sales: filtered,\n        summary: {\n          total,\n          count: filtered.length,\n          from: fromDate.toISOString(),\n          to: toDate.toISOString(),\n        }\n      });\n    } catch (error: any) {\n      log(`Error fetching sales range: ${error.message}`);\n      res.status(500).json({ message: \"Failed to fetch sales\" });\n    }\n  });\n\n  // ============ TELEGRAM WEBHOOK ============\n  app.post(\"/api/telegram/webhook\", async (req, res) => {\n    try {\n      if (!isTelegramBotInitialized()) {\n        res.status(503).json({ message: \"Telegram bot not configured\" });\n        return;\n      }\n      \n      const bot = getTelegramBot();\n      await bot.processWebhookUpdate(req.body);\n      res.sendStatus(200);\n    } catch (error: any) {\n      log(`Telegram webhook error: ${error}`);\n      res.sendStatus(500);\n    }\n  });\n\n  // ============ ANALYTICS ROUTES ============\n  app.get(\"/api/analytics/weekly\", async (req, res) => {\n    try {\n      const weekAgo = new Date();\n      weekAgo.setDate(weekAgo.getDate() - 7);\n      \n      const sales = await storage.getSalesRecordsSince(weekAgo);\n      \n      // Group by day\n      const dailyData: Record<string, { sales: number; count: number }> = {};\n      \n      sales.forEach(sale => {\n        const day = new Date(sale.timestamp).toLocaleDateString('en-US', { weekday: 'short' });\n        if (!dailyData[day]) {\n          dailyData[day] = { sales: 0, count: 0 };\n        }\n        dailyData[day].sales += Number(sale.amount);\n        dailyData[day].count += 1;\n      });\n\n      const result = Object.entries(dailyData).map(([name, data]) => ({\n        name,\n        sales: data.sales,\n        count: data.count,\n      }));\n\n      res.json(result);\n    } catch (error: any) {\n      log(`Error fetching analytics: ${error.message}`);\n      res.status(500).json({ message: \"Failed to fetch analytics\" });\n    }\n  });\n\n  // ============ SHOP STOCK SESSIONS ============\n  \n  // Get current or create new stock session\n  app.get(\"/api/shop/stock/session/:type\", async (req, res) => {\n    try {\n      const type = req.params.type as 'opening' | 'closing';\n      if (type !== 'opening' && type !== 'closing') {\n        res.status(400).json({ message: \"Invalid session type\" });\n        return;\n      }\n      \n      const session = await storage.getTodaysStockSession(type);\n      if (session) {\n        const entries = await storage.getStockEntriesBySession(session.id);\n        res.json({ session, entries });\n      } else {\n        res.json({ session: null, entries: [] });\n      }\n    } catch (error: any) {\n      log(`Error fetching stock session: ${error.message}`);\n      res.status(500).json({ message: \"Failed to fetch session\" });\n    }\n  });\n\n  // Start a new stock session (opening or closing)\n  app.post(\"/api/shop/stock/session\", async (req, res) => {\n    try {\n      const { sessionType, staffName } = req.body;\n      \n      if (!sessionType || !staffName) {\n        res.status(400).json({ message: \"sessionType and staffName are required\" });\n        return;\n      }\n      \n      // Check if session already exists for today\n      const existing = await storage.getTodaysStockSession(sessionType);\n      if (existing && existing.status === 'in_progress') {\n        const entries = await storage.getStockEntriesBySession(existing.id);\n        res.json({ session: existing, entries, resumed: true });\n        return;\n      }\n      \n      // Get inventory items count\n      const items = await storage.getAllInventoryItems();\n      \n      const session = await storage.createStockSession({\n        sessionType,\n        staffName,\n        status: 'in_progress',\n        totalItems: items.length,\n        countedItems: 0,\n      });\n      \n      res.status(201).json({ session, entries: [], items });\n    } catch (error: any) {\n      log(`Error creating stock session: ${error.message}`);\n      res.status(500).json({ message: \"Failed to create session\" });\n    }\n  });\n\n  // Save a stock entry (individual item count)\n  app.post(\"/api/shop/stock/entry\", async (req, res) => {\n    try {\n      const { sessionId, itemName, quantity, unit, inventoryItemId, posterPosId, notes } = req.body;\n      \n      if (!sessionId || !itemName || quantity === undefined) {\n        res.status(400).json({ message: \"sessionId, itemName, and quantity are required\" });\n        return;\n      }\n      \n      const entry = await storage.createStockEntry({\n        sessionId,\n        itemName,\n        quantity: quantity.toString(),\n        unit: unit || 'units',\n        inventoryItemId,\n        posterPosId,\n        notes,\n      });\n      \n      // Update session counted items\n      const session = await storage.getStockSession(sessionId);\n      if (session) {\n        await storage.updateStockSession(sessionId, {\n          countedItems: (session.countedItems || 0) + 1,\n        });\n      }\n      \n      res.status(201).json(entry);\n    } catch (error: any) {\n      log(`Error saving stock entry: ${error.message}`);\n      res.status(500).json({ message: \"Failed to save entry\" });\n    }\n  });\n\n  // Complete a stock session\n  app.patch(\"/api/shop/stock/session/:id/complete\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      \n      const session = await storage.updateStockSession(id, {\n        status: 'completed',\n        completedAt: new Date(),\n      });\n      \n      if (!session) {\n        res.status(404).json({ message: \"Session not found\" });\n        return;\n      }\n      \n      // If this is closing stock, trigger reconciliation\n      if (session.sessionType === 'closing') {\n        const openingSession = await storage.getTodaysStockSession('opening');\n        if (openingSession && openingSession.status === 'completed') {\n          // Trigger reconciliation calculation\n          try {\n            await calculateAndSendReconciliation(openingSession.id, session.id);\n          } catch (e) {\n            log(`Reconciliation failed: ${e}`);\n          }\n        }\n      }\n      \n      res.json(session);\n    } catch (error: any) {\n      log(`Error completing session: ${error.message}`);\n      res.status(500).json({ message: \"Failed to complete session\" });\n    }\n  });\n\n  // Get inventory items for wizard\n  app.get(\"/api/shop/stock/items\", async (req, res) => {\n    try {\n      const items = await storage.getAllInventoryItems();\n      res.json(items);\n    } catch (error: any) {\n      log(`Error fetching items: ${error.message}`);\n      res.status(500).json({ message: \"Failed to fetch items\" });\n    }\n  });\n\n  // ============ GOODS RECEIVED ============\n  \n  // Get pending dispatches from store\n  app.get(\"/api/shop/goods/pending\", async (req, res) => {\n    try {\n      const despatchLogs = await storage.getPendingDespatchForShop();\n      res.json(despatchLogs);\n    } catch (error: any) {\n      log(`Error fetching pending goods: ${error.message}`);\n      res.status(500).json({ message: \"Failed to fetch pending goods\" });\n    }\n  });\n\n  // Get all goods receipts\n  app.get(\"/api/shop/goods/receipts\", async (req, res) => {\n    try {\n      const receipts = await storage.getAllGoodsReceipts();\n      res.json(receipts);\n    } catch (error: any) {\n      log(`Error fetching receipts: ${error.message}`);\n      res.status(500).json({ message: \"Failed to fetch receipts\" });\n    }\n  });\n\n  // Create goods receipt from despatch\n  app.post(\"/api/shop/goods/receive\", async (req, res) => {\n    try {\n      const { despatchLogId, receivedBy, items, notes } = req.body;\n      \n      if (!receivedBy || !items || !Array.isArray(items)) {\n        res.status(400).json({ message: \"receivedBy and items array are required\" });\n        return;\n      }\n      \n      // Create the receipt\n      const receipt = await storage.createGoodsReceipt({\n        despatchLogId,\n        receivedBy,\n        status: 'received',\n        notes,\n      });\n      \n      // Add items to receipt\n      for (const item of items) {\n        await storage.createGoodsReceiptItem({\n          receiptId: receipt.id,\n          itemName: item.itemName,\n          expectedQuantity: item.expectedQuantity?.toString() || '0',\n          receivedQuantity: item.receivedQuantity?.toString() || item.expectedQuantity?.toString() || '0',\n          unit: item.unit || 'units',\n          costPerUnit: item.costPerUnit?.toString(),\n          inventoryItemId: item.inventoryItemId,\n          posterPosId: item.posterPosId,\n          notes: item.notes,\n        });\n      }\n      \n      // Generate Excel file\n      const excelPath = await generateGoodsReceiptExcel(receipt.id);\n      if (excelPath) {\n        await storage.updateGoodsReceipt(receipt.id, { excelFilePath: excelPath });\n      }\n      \n      res.status(201).json({ receipt, excelPath });\n    } catch (error: any) {\n      log(`Error receiving goods: ${error.message}`);\n      res.status(500).json({ message: \"Failed to receive goods\" });\n    }\n  });\n\n  // Download goods receipt Excel\n  app.get(\"/api/shop/goods/receipt/:id/excel\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const receipt = await storage.getGoodsReceipt(id);\n      \n      if (!receipt) {\n        res.status(404).json({ message: \"Receipt not found\" });\n        return;\n      }\n      \n      // Generate fresh Excel file\n      const excelBuffer = await generateGoodsReceiptExcelBuffer(id);\n      \n      res.setHeader('Content-Type', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');\n      res.setHeader('Content-Disposition', `attachment; filename=goods_receipt_${id}.xlsx`);\n      res.send(excelBuffer);\n    } catch (error: any) {\n      log(`Error generating Excel: ${error.message}`);\n      res.status(500).json({ message: \"Failed to generate Excel\" });\n    }\n  });\n\n  // ============ SHOP EXPENSES ============\n  \n  // Get all expenses\n  app.get(\"/api/shop/expenses\", async (req, res) => {\n    try {\n      const { type } = req.query;\n      \n      let expenses;\n      if (type) {\n        expenses = await storage.getExpensesByType(type as string);\n      } else {\n        expenses = await storage.getAllExpenses();\n      }\n      \n      // Get items for supermarket expenses\n      const expensesWithItems = await Promise.all(\n        expenses.map(async (expense) => {\n          const items = expense.expenseType === 'supermarket' \n            ? await storage.getExpenseItems(expense.id)\n            : [];\n          return { ...expense, items };\n        })\n      );\n      \n      res.json(expensesWithItems);\n    } catch (error: any) {\n      log(`Error fetching expenses: ${error.message}`);\n      res.status(500).json({ message: \"Failed to fetch expenses\" });\n    }\n  });\n\n  // Get today's expenses summary\n  app.get(\"/api/shop/expenses/today\", async (req, res) => {\n    try {\n      const expenses = await storage.getTodaysExpenses();\n      const total = expenses.reduce((sum, e) => sum + Number(e.amount), 0);\n      \n      // Group by category\n      const byCategory: Record<string, number> = {};\n      expenses.forEach(e => {\n        const cat = e.category || e.expenseType;\n        byCategory[cat] = (byCategory[cat] || 0) + Number(e.amount);\n      });\n      \n      res.json({ expenses, total, byCategory });\n    } catch (error: any) {\n      log(`Error fetching today's expenses: ${error.message}`);\n      res.status(500).json({ message: \"Failed to fetch expenses\" });\n    }\n  });\n\n  // Create expense (supermarket or petty cash)\n  app.post(\"/api/shop/expenses\", async (req, res) => {\n    try {\n      const { expenseType, category, description, amount, paidBy, paidTo, receiptNumber, notes, items } = req.body;\n      \n      if (!expenseType || !description || !amount || !paidBy) {\n        res.status(400).json({ message: \"expenseType, description, amount, and paidBy are required\" });\n        return;\n      }\n      \n      const expense = await storage.createExpense({\n        expenseType,\n        category,\n        description,\n        amount: amount.toString(),\n        paidBy,\n        paidTo,\n        receiptNumber,\n        notes,\n      });\n      \n      // If supermarket expense with items, add them\n      if (expenseType === 'supermarket' && items && Array.isArray(items)) {\n        for (const item of items) {\n          await storage.createExpenseItem({\n            expenseId: expense.id,\n            itemName: item.itemName,\n            quantity: item.quantity?.toString() || '1',\n            unit: item.unit || 'units',\n            costPerUnit: item.costPerUnit?.toString(),\n            inventoryItemId: item.inventoryItemId,\n          });\n        }\n      }\n      \n      res.status(201).json(expense);\n    } catch (error: any) {\n      log(`Error creating expense: ${error.message}`);\n      res.status(500).json({ message: \"Failed to create expense\" });\n    }\n  });\n\n  // ============ RECONCILIATION ============\n  \n  // Get today's reconciliation\n  app.get(\"/api/shop/reconciliation/today\", async (req, res) => {\n    try {\n      const recon = await storage.getTodaysReconciliation();\n      res.json(recon || { status: 'pending' });\n    } catch (error: any) {\n      log(`Error fetching reconciliation: ${error.message}`);\n      res.status(500).json({ message: \"Failed to fetch reconciliation\" });\n    }\n  });\n\n  // Trigger manual reconciliation\n  app.post(\"/api/shop/reconciliation/calculate\", async (req, res) => {\n    try {\n      const openingSession = await storage.getTodaysStockSession('opening');\n      const closingSession = await storage.getTodaysStockSession('closing');\n      \n      if (!openingSession || openingSession.status !== 'completed') {\n        res.status(400).json({ message: \"Opening stock must be completed first\" });\n        return;\n      }\n      \n      if (!closingSession || closingSession.status !== 'completed') {\n        res.status(400).json({ message: \"Closing stock must be completed first\" });\n        return;\n      }\n      \n      const result = await calculateAndSendReconciliation(openingSession.id, closingSession.id);\n      res.json(result);\n    } catch (error: any) {\n      log(`Error calculating reconciliation: ${error.message}`);\n      res.status(500).json({ message: \"Failed to calculate reconciliation\" });\n    }\n  });\n\n  // Helper function for reconciliation\n  async function calculateAndSendReconciliation(openingId: string, closingId: string) {\n    const openingEntries = await storage.getStockEntriesBySession(openingId);\n    const closingEntries = await storage.getStockEntriesBySession(closingId);\n    \n    // Get goods received today\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    const receipts = await storage.getAllGoodsReceipts(20);\n    const todayReceipts = receipts.filter(r => new Date(r.receivedAt) >= today);\n    \n    // Build lookup maps\n    const openingMap = new Map(openingEntries.map(e => [e.itemName, Number(e.quantity)]));\n    const closingMap = new Map(closingEntries.map(e => [e.itemName, Number(e.quantity)]));\n    \n    // Calculate received quantities per item\n    const receivedMap = new Map<string, number>();\n    for (const receipt of todayReceipts) {\n      const items = await storage.getGoodsReceiptItems(receipt.id);\n      for (const item of items) {\n        const current = receivedMap.get(item.itemName) || 0;\n        receivedMap.set(item.itemName, current + Number(item.receivedQuantity || 0));\n      }\n    }\n    \n    // Calculate variances\n    const allItems = new Set([...Array.from(openingMap.keys()), ...Array.from(closingMap.keys())]);\n    let overItems = 0;\n    let underItems = 0;\n    let matchedItems = 0;\n    \n    const details: Array<{\n      item: string;\n      opening: number;\n      received: number;\n      expected: number;\n      closing: number;\n      variance: number;\n      status: 'over' | 'under' | 'equal';\n    }> = [];\n    \n    allItems.forEach(itemName => {\n      const opening = openingMap.get(itemName) || 0;\n      const received = receivedMap.get(itemName) || 0;\n      const closing = closingMap.get(itemName) || 0;\n      const expected = opening + received;\n      const variance = closing - expected;\n      \n      let status: 'over' | 'under' | 'equal';\n      if (variance > 0) {\n        status = 'over';\n        overItems++;\n      } else if (variance < 0) {\n        status = 'under';\n        underItems++;\n      } else {\n        status = 'equal';\n        matchedItems++;\n      }\n      \n      details.push({ item: itemName, opening, received, expected, closing, variance, status });\n    });\n    \n    // Save reconciliation\n    const recon = await storage.createReconciliation({\n      date: new Date(),\n      openingSessionId: openingId,\n      closingSessionId: closingId,\n      status: 'completed',\n      overItems,\n      underItems,\n      matchedItems,\n    });\n    \n    // Send to owner via Telegram\n    if (isTelegramBotInitialized()) {\n      try {\n        const bot = getTelegramBot();\n        \n        const overDetails = details.filter(d => d.status === 'over').map(d => \n          `  ${d.item}: +${d.variance} (expected ${d.expected}, found ${d.closing})`\n        ).join('\\n');\n        \n        const underDetails = details.filter(d => d.status === 'under').map(d => \n          `  ${d.item}: ${d.variance} (expected ${d.expected}, found ${d.closing})`\n        ).join('\\n');\n        \n        let message = ` *Daily Stock Reconciliation*\\n\\n`;\n        message += ` Date: ${new Date().toLocaleDateString()}\\n\\n`;\n        message += ` Matched: ${matchedItems} items\\n`;\n        message += ` Over: ${overItems} items\\n`;\n        message += ` Under: ${underItems} items\\n\\n`;\n        \n        if (overItems > 0) {\n          message += `*Items OVER:*\\n${overDetails}\\n\\n`;\n        }\n        \n        if (underItems > 0) {\n          message += `*Items UNDER:*\\n${underDetails}\\n`;\n        }\n        \n        await bot.sendNotification(message, 'owner');\n        \n        await storage.updateReconciliation(recon.id, {\n          status: 'sent',\n          sentToOwnerAt: new Date(),\n        });\n      } catch (e) {\n        log(`Failed to send reconciliation to owner: ${e}`);\n      }\n    }\n    \n    return { reconciliation: recon, details };\n  }\n\n  // Helper function to generate Excel for goods receipt\n  async function generateGoodsReceiptExcel(receiptId: string): Promise<string | null> {\n    try {\n      const ExcelJS = require('exceljs');\n      const fs = require('fs');\n      const path = require('path');\n      \n      const receipt = await storage.getGoodsReceipt(receiptId);\n      if (!receipt) return null;\n      \n      const items = await storage.getGoodsReceiptItems(receiptId);\n      \n      const workbook = new ExcelJS.Workbook();\n      const worksheet = workbook.addWorksheet('Goods Receipt');\n      \n      // PosterPOS Add Supply format\n      worksheet.columns = [\n        { header: 'Product Name', key: 'name', width: 30 },\n        { header: 'Quantity', key: 'qty', width: 12 },\n        { header: 'Unit', key: 'unit', width: 12 },\n        { header: 'Cost per Unit', key: 'cost', width: 15 },\n        { header: 'Total Cost', key: 'total', width: 15 },\n        { header: 'Notes', key: 'notes', width: 20 },\n      ];\n      \n      items.forEach(item => {\n        const cost = Number(item.costPerUnit || 0);\n        const qty = Number(item.receivedQuantity || 0);\n        worksheet.addRow({\n          name: item.itemName,\n          qty: qty,\n          unit: item.unit,\n          cost: cost,\n          total: cost * qty,\n          notes: item.notes || '',\n        });\n      });\n      \n      // Style header row\n      worksheet.getRow(1).font = { bold: true };\n      worksheet.getRow(1).fill = {\n        type: 'pattern',\n        pattern: 'solid',\n        fgColor: { argb: 'FFE0E0E0' },\n      };\n      \n      // Create exports directory if needed\n      const dir = './exports';\n      if (!fs.existsSync(dir)) {\n        fs.mkdirSync(dir, { recursive: true });\n      }\n      \n      const filename = `goods_receipt_${receiptId}_${Date.now()}.xlsx`;\n      const filepath = path.join(dir, filename);\n      \n      await workbook.xlsx.writeFile(filepath);\n      \n      return filepath;\n    } catch (error) {\n      log(`Error generating Excel: ${error}`);\n      return null;\n    }\n  }\n\n  // Helper to generate Excel buffer for download\n  async function generateGoodsReceiptExcelBuffer(receiptId: string): Promise<Buffer> {\n    const ExcelJS = require('exceljs');\n    \n    const receipt = await storage.getGoodsReceipt(receiptId);\n    if (!receipt) throw new Error('Receipt not found');\n    \n    const items = await storage.getGoodsReceiptItems(receiptId);\n    \n    const workbook = new ExcelJS.Workbook();\n    const worksheet = workbook.addWorksheet('Goods Receipt');\n    \n    worksheet.columns = [\n      { header: 'Product Name', key: 'name', width: 30 },\n      { header: 'Quantity', key: 'qty', width: 12 },\n      { header: 'Unit', key: 'unit', width: 12 },\n      { header: 'Cost per Unit', key: 'cost', width: 15 },\n      { header: 'Total Cost', key: 'total', width: 15 },\n      { header: 'Notes', key: 'notes', width: 20 },\n    ];\n    \n    items.forEach(item => {\n      const cost = Number(item.costPerUnit || 0);\n      const qty = Number(item.receivedQuantity || 0);\n      worksheet.addRow({\n        name: item.itemName,\n        qty: qty,\n        unit: item.unit,\n        cost: cost,\n        total: cost * qty,\n        notes: item.notes || '',\n      });\n    });\n    \n    worksheet.getRow(1).font = { bold: true };\n    \n    return await workbook.xlsx.writeBuffer();\n  }\n\n  // ============ CONFIG STATUS ROUTES ============\n  app.get(\"/api/config/status\", async (req, res) => {\n    res.json({\n      posterpos: !!posterEndpoint && !!posterToken,\n      telegram: !!telegramToken,\n    });\n  });\n\n  return httpServer;\n}\n","path":null,"size_bytes":58054,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/ui/empty.tsx":{"content":"import { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Empty({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty\"\n      className={cn(\n        \"flex min-w-0 flex-1 flex-col items-center justify-center gap-6 text-balance rounded-lg border-dashed p-6 text-center md:p-12\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-header\"\n      className={cn(\n        \"flex max-w-sm flex-col items-center gap-2 text-center\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst emptyMediaVariants = cva(\n  \"mb-2 flex shrink-0 items-center justify-center [&_svg]:pointer-events-none [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted text-foreground flex size-10 shrink-0 items-center justify-center rounded-lg [&_svg:not([class*='size-'])]:size-6\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction EmptyMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof emptyMediaVariants>) {\n  return (\n    <div\n      data-slot=\"empty-icon\"\n      data-variant={variant}\n      className={cn(emptyMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-title\"\n      className={cn(\"text-lg font-medium tracking-tight\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <div\n      data-slot=\"empty-description\"\n      className={cn(\n        \"text-muted-foreground [&>a:hover]:text-primary text-sm/relaxed [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-content\"\n      className={cn(\n        \"flex w-full min-w-0 max-w-sm flex-col items-center gap-4 text-balance text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Empty,\n  EmptyHeader,\n  EmptyTitle,\n  EmptyDescription,\n  EmptyContent,\n  EmptyMedia,\n}\n","path":null,"size_bytes":2396,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-9 px-2 min-w-9\",\n        sm: \"h-8 px-1.5 min-w-8\",\n        lg: \"h-10 px-2.5 min-w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1486,"size_tokens":null},"client/src/pages/owner/Analytics.tsx":{"content":"import { MobileShell } from \"@/components/layout/MobileShell\";\nimport { BottomNav } from \"@/components/layout/BottomNav\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from \"@/components/ui/tabs\";\nimport { Bar, BarChart, CartesianGrid, XAxis, ResponsiveContainer, Tooltip, Legend, Line, ComposedChart } from \"recharts\";\n\nconst data = [\n  { name: \"Mon\", sales: 4000, stock: 2400 },\n  { name: \"Tue\", sales: 3000, stock: 2210 },\n  { name: \"Wed\", sales: 2000, stock: 2290 },\n  { name: \"Thu\", sales: 2780, stock: 2000 },\n  { name: \"Fri\", sales: 1890, stock: 2181 },\n  { name: \"Sat\", sales: 2390, stock: 2500 },\n  { name: \"Sun\", sales: 3490, stock: 2100 },\n];\n\nconst categoryData = [\n  { name: \"Coffee\", sales: 65, stock: 40 },\n  { name: \"Food\", sales: 25, stock: 30 },\n  { name: \"Merch\", sales: 10, stock: 30 },\n];\n\nexport default function OwnerAnalytics() {\n  return (\n    <MobileShell theme=\"owner\" className=\"pb-20\">\n      <header className=\"sticky top-0 z-10 bg-background/80 backdrop-blur-md px-6 py-4 border-b\">\n        <h1 className=\"text-xl font-bold tracking-tight text-primary\">Analytics</h1>\n      </header>\n\n      <main className=\"p-4 space-y-6\">\n        <Tabs defaultValue=\"overview\" className=\"w-full\">\n          <TabsList className=\"w-full grid grid-cols-2\">\n            <TabsTrigger value=\"overview\">Sales vs Stock</TabsTrigger>\n            <TabsTrigger value=\"categories\">Categories</TabsTrigger>\n          </TabsList>\n          \n          <TabsContent value=\"overview\" className=\"space-y-4 mt-4\">\n            <Card className=\"border-none shadow-sm\">\n              <CardHeader>\n                <CardTitle className=\"text-sm font-medium\">Weekly Performance</CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-0 h-[300px] pb-4\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <ComposedChart data={data} margin={{ top: 20, right: 20, bottom: 20, left: -20 }}>\n                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"hsl(var(--border))\" />\n                    <XAxis \n                      dataKey=\"name\" \n                      axisLine={false} \n                      tickLine={false} \n                      tick={{fill: 'hsl(var(--muted-foreground))', fontSize: 10}} \n                    />\n                    <Tooltip \n                      contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 12px rgba(0,0,0,0.1)' }}\n                    />\n                    <Legend />\n                    <Bar dataKey=\"sales\" name=\"Sales ($)\" fill=\"hsl(var(--primary))\" radius={[4, 4, 0, 0]} barSize={20} />\n                    <Line type=\"monotone\" dataKey=\"stock\" name=\"Stock Level\" stroke=\"#f59e0b\" strokeWidth={2} dot={false} />\n                  </ComposedChart>\n                </ResponsiveContainer>\n              </CardContent>\n            </Card>\n            \n            <div className=\"grid grid-cols-2 gap-4\">\n               <Card className=\"bg-blue-50 border-none\">\n                 <CardContent className=\"p-4\">\n                   <div className=\"text-xs text-blue-600 font-medium uppercase\">Turnover Rate</div>\n                   <div className=\"text-2xl font-bold text-blue-900 mt-1\">4.2x</div>\n                   <div className=\"text-xs text-blue-600/80 mt-1\">High efficiency</div>\n                 </CardContent>\n               </Card>\n               <Card className=\"bg-orange-50 border-none\">\n                 <CardContent className=\"p-4\">\n                   <div className=\"text-xs text-orange-600 font-medium uppercase\">Low Stock Alerts</div>\n                   <div className=\"text-2xl font-bold text-orange-900 mt-1\">3</div>\n                   <div className=\"text-xs text-orange-600/80 mt-1\">Action needed</div>\n                 </CardContent>\n               </Card>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"categories\" className=\"mt-4\">\n             <Card className=\"border-none shadow-sm\">\n               <CardHeader>\n                 <CardTitle className=\"text-sm font-medium\">Sales Distribution</CardTitle>\n               </CardHeader>\n               <CardContent className=\"space-y-4\">\n                 {categoryData.map((cat) => (\n                   <div key={cat.name} className=\"space-y-1\">\n                     <div className=\"flex items-center justify-between text-sm\">\n                       <span className=\"font-medium\">{cat.name}</span>\n                       <span className=\"text-muted-foreground\">{cat.sales}% of sales</span>\n                     </div>\n                     <div className=\"h-2 w-full bg-secondary rounded-full overflow-hidden\">\n                       <div \n                         className=\"h-full bg-primary\" \n                         style={{ width: `${cat.sales}%` }}\n                       />\n                     </div>\n                     <div className=\"flex items-center justify-between text-xs text-muted-foreground pt-1\">\n                        <span>Stock Coverage</span>\n                        <span className={cat.stock < 20 ? \"text-red-500 font-bold\" : \"text-green-600\"}>\n                          {cat.stock < 20 ? \"Low\" : \"Healthy\"}\n                        </span>\n                     </div>\n                   </div>\n                 ))}\n               </CardContent>\n             </Card>\n          </TabsContent>\n        </Tabs>\n      </main>\n      <BottomNav role=\"owner\" />\n    </MobileShell>\n  );\n}\n","path":null,"size_bytes":5514,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-3.5 w-3.5 fill-primary\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1410,"size_tokens":null},"client/src/components/layout/MobileShell.tsx":{"content":"import React from \"react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface MobileShellProps {\n  children: React.ReactNode;\n  className?: string;\n  theme?: \"owner\" | \"store\" | \"shop\";\n}\n\nexport function MobileShell({ children, className, theme = \"owner\" }: MobileShellProps) {\n  return (\n    <div className={cn(\n      \"min-h-screen w-full bg-background font-sans text-foreground antialiased sm:max-w-md sm:mx-auto sm:border-x sm:border-border\",\n      theme === \"store\" && \"theme-store\",\n      theme === \"shop\" && \"theme-shop\",\n      className\n    )}>\n      {children}\n    </div>\n  );\n}\n","path":null,"size_bytes":582,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":2560,"size_tokens":null},"client/src/components/shop/GoodsReceived.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { CheckCircle, Download, Loader2, Package, Truck, Plus, X } from \"lucide-react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\n\ninterface DespatchLog {\n  id: string;\n  itemName: string;\n  quantity: string;\n  destination: string;\n  createdBy: string;\n  createdAt: string;\n}\n\ninterface GoodsReceipt {\n  id: string;\n  receivedBy: string;\n  receivedAt: string;\n  status: string;\n}\n\ninterface ReceiveItem {\n  itemName: string;\n  expectedQuantity: number;\n  receivedQuantity: number;\n  unit: string;\n  costPerUnit?: number;\n}\n\nexport function GoodsReceived() {\n  const [isReceiving, setIsReceiving] = useState(false);\n  const [receivedBy, setReceivedBy] = useState(\"\");\n  const [receiveItems, setReceiveItems] = useState<ReceiveItem[]>([]);\n  const [notes, setNotes] = useState(\"\");\n  const [selectedDespatch, setSelectedDespatch] = useState<DespatchLog | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: pending = [], isLoading: loadingPending } = useQuery<DespatchLog[]>({\n    queryKey: [\"/api/shop/goods/pending\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/shop/goods/pending\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(`${res.status}: ${await res.text()}`);\n      return res.json();\n    },\n  });\n\n  const { data: receipts = [], isLoading: loadingReceipts } = useQuery<GoodsReceipt[]>({\n    queryKey: [\"/api/shop/goods/receipts\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/shop/goods/receipts\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(`${res.status}: ${await res.text()}`);\n      return res.json();\n    },\n  });\n\n  const receiveMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", \"/api/shop/goods/receive\", {\n        despatchLogId: selectedDespatch?.id,\n        receivedBy,\n        items: receiveItems,\n        notes,\n      });\n      return res.json();\n    },\n    onSuccess: (data) => {\n      toast({ title: \"Goods received successfully!\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/shop/goods/pending\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/shop/goods/receipts\"] });\n      setIsReceiving(false);\n      setReceiveItems([]);\n      setReceivedBy(\"\");\n      setNotes(\"\");\n      setSelectedDespatch(null);\n\n      if (data.excelPath) {\n        toast({ title: \"Excel file generated\" });\n      }\n    },\n    onError: () => {\n      toast({ title: \"Failed to receive goods\", variant: \"destructive\" });\n    },\n  });\n\n  const startReceiving = (despatch?: DespatchLog) => {\n    if (despatch) {\n      setSelectedDespatch(despatch);\n      setReceiveItems([{\n        itemName: despatch.itemName,\n        expectedQuantity: Number(despatch.quantity),\n        receivedQuantity: Number(despatch.quantity),\n        unit: \"units\",\n      }]);\n    } else {\n      setReceiveItems([{ itemName: \"\", expectedQuantity: 0, receivedQuantity: 0, unit: \"units\" }]);\n    }\n    setIsReceiving(true);\n  };\n\n  const addItem = () => {\n    setReceiveItems([...receiveItems, { itemName: \"\", expectedQuantity: 0, receivedQuantity: 0, unit: \"units\" }]);\n  };\n\n  const removeItem = (index: number) => {\n    setReceiveItems(receiveItems.filter((_, i) => i !== index));\n  };\n\n  const updateItem = (index: number, field: keyof ReceiveItem, value: string | number) => {\n    const updated = [...receiveItems];\n    updated[index] = { ...updated[index], [field]: value };\n    setReceiveItems(updated);\n  };\n\n  const downloadExcel = async (receiptId: string) => {\n    try {\n      const response = await fetch(`/api/shop/goods/receipt/${receiptId}/excel`);\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `goods_receipt_${receiptId}.xlsx`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      window.URL.revokeObjectURL(url);\n    } catch {\n      toast({ title: \"Failed to download Excel\", variant: \"destructive\" });\n    }\n  };\n\n  if (loadingPending || loadingReceipts) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (isReceiving) {\n    return (\n      <div className=\"space-y-4\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Receive Goods</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"receivedBy\">Received By</Label>\n              <Input\n                id=\"receivedBy\"\n                value={receivedBy}\n                onChange={(e) => setReceivedBy(e.target.value)}\n                placeholder=\"Your name\"\n                data-testid=\"input-received-by\"\n              />\n            </div>\n\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center justify-between\">\n                <Label>Items</Label>\n                <Button size=\"sm\" variant=\"outline\" onClick={addItem} data-testid=\"button-add-item\">\n                  <Plus className=\"h-3 w-3 mr-1\" /> Add\n                </Button>\n              </div>\n\n              {receiveItems.map((item, index) => (\n                <Card key={index} className=\"p-3\">\n                  <div className=\"space-y-2\">\n                    <div className=\"flex gap-2\">\n                      <Input\n                        placeholder=\"Item name\"\n                        value={item.itemName}\n                        onChange={(e) => updateItem(index, \"itemName\", e.target.value)}\n                        data-testid={`input-item-name-${index}`}\n                      />\n                      {receiveItems.length > 1 && (\n                        <Button size=\"icon\" variant=\"ghost\" onClick={() => removeItem(index)}>\n                          <X className=\"h-4 w-4\" />\n                        </Button>\n                      )}\n                    </div>\n                    <div className=\"grid grid-cols-3 gap-2\">\n                      <div>\n                        <Label className=\"text-xs\">Expected</Label>\n                        <Input\n                          type=\"number\"\n                          value={item.expectedQuantity}\n                          onChange={(e) => updateItem(index, \"expectedQuantity\", Number(e.target.value))}\n                          data-testid={`input-expected-${index}`}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs\">Received</Label>\n                        <Input\n                          type=\"number\"\n                          value={item.receivedQuantity}\n                          onChange={(e) => updateItem(index, \"receivedQuantity\", Number(e.target.value))}\n                          data-testid={`input-received-${index}`}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs\">Cost/Unit</Label>\n                        <Input\n                          type=\"number\"\n                          value={item.costPerUnit || \"\"}\n                          onChange={(e) => updateItem(index, \"costPerUnit\", Number(e.target.value))}\n                          placeholder=\"0\"\n                          data-testid={`input-cost-${index}`}\n                        />\n                      </div>\n                    </div>\n                  </div>\n                </Card>\n              ))}\n            </div>\n\n            <div>\n              <Label htmlFor=\"notes\">Notes</Label>\n              <Input\n                id=\"notes\"\n                value={notes}\n                onChange={(e) => setNotes(e.target.value)}\n                placeholder=\"Optional notes\"\n                data-testid=\"input-notes\"\n              />\n            </div>\n\n            <div className=\"flex gap-2\">\n              <Button\n                variant=\"outline\"\n                className=\"flex-1\"\n                onClick={() => setIsReceiving(false)}\n              >\n                Cancel\n              </Button>\n              <Button\n                className=\"flex-1\"\n                onClick={() => receiveMutation.mutate()}\n                disabled={!receivedBy || receiveItems.length === 0 || receiveMutation.isPending}\n                data-testid=\"button-confirm-receive\"\n              >\n                {receiveMutation.isPending ? (\n                  <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                ) : (\n                  <CheckCircle className=\"h-4 w-4 mr-2\" />\n                )}\n                Confirm Receipt\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {pending.length > 0 && (\n        <>\n          <h3 className=\"text-sm font-semibold text-muted-foreground uppercase\">\n            Pending from Store\n          </h3>\n          {pending.map((despatch) => (\n            <Card key={despatch.id} className=\"border-orange-200 bg-orange-50\" data-testid={`card-pending-${despatch.id}`}>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <Truck className=\"h-5 w-5 text-orange-600\" />\n                    <div>\n                      <p className=\"font-medium\">{despatch.itemName}</p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {despatch.quantity} units  From: {despatch.createdBy}\n                      </p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {new Date(despatch.createdAt).toLocaleDateString()}\n                      </p>\n                    </div>\n                  </div>\n                  <Button size=\"sm\" onClick={() => startReceiving(despatch)} data-testid={`button-receive-${despatch.id}`}>\n                    Receive\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </>\n      )}\n\n      <Button\n        variant=\"outline\"\n        className=\"w-full\"\n        onClick={() => startReceiving()}\n        data-testid=\"button-manual-receive\"\n      >\n        <Plus className=\"h-4 w-4 mr-2\" />\n        Manual Entry\n      </Button>\n\n      {receipts.length > 0 && (\n        <>\n          <h3 className=\"text-sm font-semibold text-muted-foreground uppercase mt-6\">\n            Recent Receipts\n          </h3>\n          {receipts.slice(0, 10).map((receipt) => (\n            <Card key={receipt.id} className=\"border-green-200\" data-testid={`card-receipt-${receipt.id}`}>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <Package className=\"h-5 w-5 text-green-600\" />\n                    <div>\n                      <p className=\"font-medium\">Receipt</p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        By: {receipt.receivedBy}\n                      </p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {new Date(receipt.receivedAt).toLocaleDateString()}\n                      </p>\n                    </div>\n                  </div>\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => downloadExcel(receipt.id)}\n                    data-testid={`button-download-${receipt.id}`}\n                  >\n                    <Download className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </>\n      )}\n\n      {pending.length === 0 && receipts.length === 0 && (\n        <Card className=\"p-8 text-center\">\n          <Package className=\"h-12 w-12 mx-auto text-muted-foreground/50 mb-2\" />\n          <p className=\"text-muted-foreground\">No pending deliveries</p>\n          <p className=\"text-xs text-muted-foreground mt-1\">\n            Items despatched from store will appear here\n          </p>\n        </Card>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":12816,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n      {children}\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4280,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"grid place-content-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1031,"size_tokens":null},"server/db.ts":{"content":"import { drizzle } from 'drizzle-orm/node-postgres';\nimport pg from 'pg';\n\nconst { Pool } = pg;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error('DATABASE_URL must be set. Did you forget to provision a database?');\n}\n\nexport const pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n});\n\nexport const db = drizzle(pool);\n","path":null,"size_bytes":336,"size_tokens":null},"client/src/pages/owner/Requests.tsx":{"content":"import { MobileShell } from \"@/components/layout/MobileShell\";\nimport { BottomNav } from \"@/components/layout/BottomNav\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Check, X, Clock, Package, Loader2 } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport type { ReorderRequest } from \"@shared/schema\";\n\nexport default function OwnerRequests() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: requests = [], isLoading } = useQuery<ReorderRequest[]>({\n    queryKey: [\"/api/requests\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/requests\");\n      if (!res.ok) throw new Error(\"Failed to fetch requests\");\n      return res.json();\n    },\n  });\n\n  const updateRequest = useMutation({\n    mutationFn: async ({ id, status, approvedBy }: { id: string; status: string; approvedBy?: string }) => {\n      const res = await fetch(`/api/requests/${id}`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ status, approvedBy }),\n      });\n      if (!res.ok) throw new Error(\"Failed to update request\");\n      return res.json();\n    },\n    onSuccess: (_, variables) => {\n      toast({\n        title: variables.status === \"approved\" ? \"Request Approved\" : \"Request Rejected\",\n        description: `Order has been ${variables.status}.`,\n        className: variables.status === \"approved\" ? \"bg-green-600 text-white border-none\" : \"\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/requests\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleApprove = (id: string) => {\n    updateRequest.mutate({ id, status: \"approved\", approvedBy: \"Owner\" });\n  };\n\n  const handleReject = (id: string) => {\n    updateRequest.mutate({ id, status: \"rejected\" });\n  };\n\n  const formatTime = (date: Date | string) => {\n    const d = new Date(date);\n    const now = new Date();\n    const diffMs = now.getTime() - d.getTime();\n    const diffHours = Math.floor(diffMs / (1000 * 60 * 60));\n    const diffDays = Math.floor(diffHours / 24);\n    \n    if (diffDays > 0) return `${diffDays}d ago`;\n    if (diffHours > 0) return `${diffHours}h ago`;\n    return \"Just now\";\n  };\n\n  return (\n    <MobileShell theme=\"owner\" className=\"pb-20\">\n      <header className=\"sticky top-0 z-10 bg-background/80 backdrop-blur-md px-6 py-4 border-b\">\n        <h1 className=\"text-xl font-bold tracking-tight text-primary\">Stock Requests</h1>\n      </header>\n\n      <main className=\"p-4 space-y-4\">\n        {isLoading ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n          </div>\n        ) : requests.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center py-12 text-muted-foreground\">\n            <Package className=\"h-12 w-12 mb-2 opacity-50\" />\n            <p className=\"text-sm\">No reorder requests</p>\n          </div>\n        ) : (\n          requests.map((req) => (\n            <Card key={req.id} className=\"overflow-hidden border-none shadow-sm ring-1 ring-border/50\">\n              <CardHeader className=\"p-4 pb-2 flex flex-row items-center justify-between space-y-0\">\n                <div className=\"flex items-center gap-2\">\n                  <Badge \n                    variant={req.status === 'pending' ? \"secondary\" : \"outline\"} \n                    className={\n                      req.status === 'pending' ? \"bg-yellow-100 text-yellow-800 hover:bg-yellow-100\" : \n                      req.status === 'approved' ? \"text-green-600 border-green-200\" :\n                      \"text-red-600 border-red-200\"\n                    }\n                  >\n                    {req.status}\n                  </Badge>\n                  <span className=\"text-xs text-muted-foreground flex items-center gap-1\">\n                    <Clock className=\"h-3 w-3\" /> {formatTime(req.createdAt)}\n                  </span>\n                </div>\n                {req.estimatedCost && (\n                  <div className=\"font-mono font-bold\">${req.estimatedCost}</div>\n                )}\n              </CardHeader>\n              <CardContent className=\"p-4 pt-2\">\n                <div className=\"flex items-start gap-3 mb-4\">\n                  <div className=\"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center text-primary\">\n                    <Package className=\"h-5 w-5\" />\n                  </div>\n                  <div>\n                    <h3 className=\"font-medium\">{req.itemName}</h3>\n                    <p className=\"text-sm text-muted-foreground\">Quantity: {req.quantity} {req.unit}</p>\n                    {req.vendor && <p className=\"text-xs text-muted-foreground mt-1\">Vendor: {req.vendor}</p>}\n                    <p className=\"text-xs text-muted-foreground\">Requested by {req.requester}</p>\n                    {req.notes && <p className=\"text-xs text-muted-foreground/70 mt-1\">\"{req.notes}\"</p>}\n                  </div>\n                </div>\n\n                {req.status === 'pending' && (\n                  <div className=\"grid grid-cols-2 gap-3\">\n                    <Button \n                      variant=\"outline\" \n                      className=\"border-red-200 text-red-600 hover:bg-red-50 hover:text-red-700\"\n                      onClick={() => handleReject(req.id)}\n                      disabled={updateRequest.isPending}\n                    >\n                      <X className=\"mr-2 h-4 w-4\" /> Reject\n                    </Button>\n                    <Button \n                      onClick={() => handleApprove(req.id)} \n                      className=\"bg-green-600 hover:bg-green-700 text-white\"\n                      disabled={updateRequest.isPending}\n                    >\n                      {updateRequest.isPending ? (\n                        <Loader2 className=\"h-4 w-4 animate-spin\" />\n                      ) : (\n                        <><Check className=\"mr-2 h-4 w-4\" /> Approve</>\n                      )}\n                    </Button>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          ))\n        )}\n      </main>\n      <BottomNav role=\"owner\" />\n    </MobileShell>\n  );\n}\n","path":null,"size_bytes":6560,"size_tokens":null},"client/src/pages/shop/POS.tsx":{"content":"import { useState } from \"react\";\nimport { MobileShell } from \"@/components/layout/MobileShell\";\nimport { BottomNav } from \"@/components/layout/BottomNav\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { ShoppingCart, Plus, Minus, X, Trash2 } from \"lucide-react\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Sheet, SheetContent, SheetHeader, SheetTitle, SheetTrigger } from \"@/components/ui/sheet\";\nimport { Badge } from \"@/components/ui/badge\";\n\nconst categories = [\"Coffee\", \"Tea\", \"Food\", \"Merch\"];\nconst products = {\n  Coffee: [\n    { id: 1, name: \"Espresso\", price: 3.50 },\n    { id: 2, name: \"Latte\", price: 4.50 },\n    { id: 3, name: \"Cappuccino\", price: 4.50 },\n    { id: 4, name: \"Americano\", price: 3.75 },\n    { id: 5, name: \"Mocha\", price: 5.00 },\n  ],\n  Tea: [\n    { id: 6, name: \"Earl Grey\", price: 3.00 },\n    { id: 7, name: \"Green Tea\", price: 3.00 },\n  ],\n  Food: [\n    { id: 8, name: \"Croissant\", price: 3.50 },\n    { id: 9, name: \"Muffin\", price: 4.00 },\n  ],\n  Merch: [\n    { id: 10, name: \"Mug\", price: 15.00 },\n  ]\n};\n\nexport default function ShopPOS() {\n  const [cart, setCart] = useState<{id: number, name: string, price: number, qty: number}[]>([]);\n  const [activeCategory, setActiveCategory] = useState(\"Coffee\");\n  const [isCartOpen, setIsCartOpen] = useState(false);\n\n  const addToCart = (product: any) => {\n    setCart(prev => {\n      const existing = prev.find(p => p.id === product.id);\n      if (existing) {\n        return prev.map(p => p.id === product.id ? { ...p, qty: p.qty + 1 } : p);\n      }\n      return [...prev, { ...product, qty: 1 }];\n    });\n  };\n\n  const removeFromCart = (id: number) => {\n    setCart(prev => prev.filter(p => p.id !== id));\n  };\n\n  const updateQty = (id: number, delta: number) => {\n    setCart(prev => {\n      return prev.map(p => {\n        if (p.id === id) {\n          const newQty = p.qty + delta;\n          return newQty > 0 ? { ...p, qty: newQty } : p;\n        }\n        return p;\n      });\n    });\n  };\n\n  const total = cart.reduce((acc, curr) => acc + (curr.price * curr.qty), 0);\n  const totalItems = cart.reduce((acc, curr) => acc + curr.qty, 0);\n\n  return (\n    <MobileShell theme=\"shop\" className=\"flex flex-col h-screen pb-20\">\n      <header className=\"flex-none bg-primary text-primary-foreground px-4 py-3 flex items-center justify-between shadow-md z-10\">\n        <h1 className=\"text-lg font-bold tracking-tight\">Poster Shop</h1>\n        <div className=\"flex items-center gap-2 bg-white/20 px-2 py-0.5 rounded-full text-xs backdrop-blur-sm\">\n          <div className=\"w-1.5 h-1.5 rounded-full bg-green-400 animate-pulse\" />\n          <span>Online</span>\n        </div>\n      </header>\n\n      <div className=\"flex-1 flex flex-col overflow-hidden\">\n        {/* Categories */}\n        <div className=\"flex-none bg-background border-b p-2 shadow-sm z-0\">\n          <ScrollArea className=\"w-full whitespace-nowrap\">\n            <div className=\"flex space-x-2 px-1\">\n              {categories.map(cat => (\n                <Button\n                  key={cat}\n                  variant={activeCategory === cat ? \"default\" : \"outline\"}\n                  onClick={() => setActiveCategory(cat)}\n                  size=\"sm\"\n                  className={`rounded-full px-4 ${activeCategory === cat ? 'bg-primary text-primary-foreground' : 'bg-background border-border hover:bg-secondary'}`}\n                >\n                  {cat}\n                </Button>\n              ))}\n            </div>\n          </ScrollArea>\n        </div>\n\n        {/* Product Grid */}\n        <ScrollArea className=\"flex-1 bg-secondary/30 p-3\">\n          <div className=\"grid grid-cols-2 gap-3 pb-4\">\n            {products[activeCategory as keyof typeof products].map(product => (\n              <Card \n                key={product.id} \n                className=\"cursor-pointer border-none shadow-sm hover:shadow-md transition-all active:scale-95 bg-card\"\n                onClick={() => addToCart(product)}\n              >\n                <CardContent className=\"p-3 flex flex-col items-center text-center gap-2\">\n                  <div className=\"h-14 w-14 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold text-lg\">\n                    {product.name.charAt(0)}\n                  </div>\n                  <div className=\"w-full\">\n                    <h3 className=\"font-medium text-sm truncate w-full\">{product.name}</h3>\n                    <p className=\"text-primary font-bold text-sm\">${product.price.toFixed(2)}</p>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </ScrollArea>\n\n        {/* Mobile Cart Footer */}\n        {cart.length > 0 && (\n          <div className=\"absolute bottom-16 left-0 right-0 p-4 z-20 sm:max-w-md sm:mx-auto\">\n            <Sheet open={isCartOpen} onOpenChange={setIsCartOpen}>\n              <SheetTrigger asChild>\n                <Button className=\"w-full h-14 text-lg shadow-xl shadow-primary/20 flex items-center justify-between px-6 rounded-xl animate-in slide-in-from-bottom-4 duration-300\">\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"bg-white/20 px-2 py-0.5 rounded text-sm font-bold min-w-[1.5rem] text-center\">\n                      {totalItems}\n                    </div>\n                    <span className=\"text-sm font-normal opacity-90\">View Order</span>\n                  </div>\n                  <span className=\"font-bold text-xl\">${total.toFixed(2)}</span>\n                </Button>\n              </SheetTrigger>\n              <SheetContent side=\"bottom\" className=\"h-[85vh] rounded-t-[20px] p-0 flex flex-col\">\n                <SheetHeader className=\"p-4 border-b\">\n                  <div className=\"flex items-center justify-between\">\n                    <SheetTitle>Current Order</SheetTitle>\n                    <Button variant=\"ghost\" size=\"sm\" className=\"text-muted-foreground\" onClick={() => setCart([])}>\n                      Clear\n                    </Button>\n                  </div>\n                </SheetHeader>\n                \n                <ScrollArea className=\"flex-1 p-4\">\n                  <div className=\"space-y-4\">\n                    {cart.map(item => (\n                      <div key={item.id} className=\"flex items-center justify-between\">\n                        <div className=\"flex-1\">\n                          <div className=\"font-medium\">{item.name}</div>\n                          <div className=\"text-sm text-muted-foreground\">${(item.price * item.qty).toFixed(2)}</div>\n                        </div>\n                        <div className=\"flex items-center gap-3 bg-secondary/50 rounded-lg p-1\">\n                          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 rounded-md bg-background shadow-sm\" onClick={() => updateQty(item.id, -1)}>\n                             {item.qty === 1 ? <Trash2 className=\"h-4 w-4 text-destructive\" /> : <Minus className=\"h-4 w-4\" />}\n                          </Button>\n                          <span className=\"w-4 text-center font-medium\">{item.qty}</span>\n                          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 rounded-md bg-background shadow-sm\" onClick={() => updateQty(item.id, 1)}>\n                            <Plus className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </ScrollArea>\n                \n                <div className=\"p-4 border-t bg-muted/20 space-y-4\">\n                  <div className=\"space-y-2\">\n                    <div className=\"flex justify-between text-sm\">\n                      <span className=\"text-muted-foreground\">Subtotal</span>\n                      <span>${total.toFixed(2)}</span>\n                    </div>\n                    <div className=\"flex justify-between text-sm\">\n                      <span className=\"text-muted-foreground\">Tax (8%)</span>\n                      <span>${(total * 0.08).toFixed(2)}</span>\n                    </div>\n                    <div className=\"flex justify-between text-lg font-bold pt-2 border-t\">\n                      <span>Total</span>\n                      <span>${(total * 1.08).toFixed(2)}</span>\n                    </div>\n                  </div>\n                  <Button className=\"w-full h-12 text-lg font-bold\" onClick={() => {\n                    setCart([]);\n                    setIsCartOpen(false);\n                  }}>\n                    Charge ${(total * 1.08).toFixed(2)}\n                  </Button>\n                </div>\n              </SheetContent>\n            </Sheet>\n          </div>\n        )}\n      </div>\n      \n      <BottomNav role=\"shop\" />\n    </MobileShell>\n  );\n}\n","path":null,"size_bytes":8868,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue | null>(null)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  if (!itemContext) {\n    throw new Error(\"useFormField should be used within <FormItem>\")\n  }\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue | null>(null)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-[0.8rem] text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-[0.8rem] font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4175,"size_tokens":null},"client/src/components/ui/item.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction ItemGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      role=\"list\"\n      data-slot=\"item-group\"\n      className={cn(\"group/item-group flex flex-col\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"item-separator\"\n      orientation=\"horizontal\"\n      className={cn(\"my-0\", className)}\n      {...props}\n    />\n  )\n}\n\nconst itemVariants = cva(\n  \"group/item [a]:hover:bg-accent/50 focus-visible:border-ring focus-visible:ring-ring/50 [a]:transition-colors flex flex-wrap items-center rounded-md border border-transparent text-sm outline-none transition-colors duration-100 focus-visible:ring-[3px]\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline: \"border-border\",\n        muted: \"bg-muted/50\",\n      },\n      size: {\n        default: \"gap-4 p-4 \",\n        sm: \"gap-2.5 px-4 py-3\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction Item({\n  className,\n  variant = \"default\",\n  size = \"default\",\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> &\n  VariantProps<typeof itemVariants> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n  return (\n    <Comp\n      data-slot=\"item\"\n      data-variant={variant}\n      data-size={size}\n      className={cn(itemVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nconst itemMediaVariants = cva(\n  \"flex shrink-0 items-center justify-center gap-2 group-has-[[data-slot=item-description]]/item:translate-y-0.5 group-has-[[data-slot=item-description]]/item:self-start [&_svg]:pointer-events-none\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted size-8 rounded-sm border [&_svg:not([class*='size-'])]:size-4\",\n        image:\n          \"size-10 overflow-hidden rounded-sm [&_img]:size-full [&_img]:object-cover\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction ItemMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof itemMediaVariants>) {\n  return (\n    <div\n      data-slot=\"item-media\"\n      data-variant={variant}\n      className={cn(itemMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction ItemContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-content\"\n      className={cn(\n        \"flex flex-1 flex-col gap-1 [&+[data-slot=item-content]]:flex-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-title\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"item-description\"\n      className={cn(\n        \"text-muted-foreground line-clamp-2 text-balance text-sm font-normal leading-normal\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemActions({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-actions\"\n      className={cn(\"flex items-center gap-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-header\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-footer\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Item,\n  ItemMedia,\n  ItemContent,\n  ItemActions,\n  ItemGroup,\n  ItemSeparator,\n  ItemTitle,\n  ItemDescription,\n  ItemHeader,\n  ItemFooter,\n}\n","path":null,"size_bytes":4494,"size_tokens":null},"client/src/components/ui/field.tsx":{"content":"\"use client\"\n\nimport { useMemo } from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction FieldSet({ className, ...props }: React.ComponentProps<\"fieldset\">) {\n  return (\n    <fieldset\n      data-slot=\"field-set\"\n      className={cn(\n        \"flex flex-col gap-6\",\n        \"has-[>[data-slot=checkbox-group]]:gap-3 has-[>[data-slot=radio-group]]:gap-3\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLegend({\n  className,\n  variant = \"legend\",\n  ...props\n}: React.ComponentProps<\"legend\"> & { variant?: \"legend\" | \"label\" }) {\n  return (\n    <legend\n      data-slot=\"field-legend\"\n      data-variant={variant}\n      className={cn(\n        \"mb-3 font-medium\",\n        \"data-[variant=legend]:text-base\",\n        \"data-[variant=label]:text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-group\"\n      className={cn(\n        \"group/field-group @container/field-group flex w-full flex-col gap-7 data-[slot=checkbox-group]:gap-3 [&>[data-slot=field-group]]:gap-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst fieldVariants = cva(\n  \"group/field data-[invalid=true]:text-destructive flex w-full gap-3\",\n  {\n    variants: {\n      orientation: {\n        vertical: [\"flex-col [&>*]:w-full [&>.sr-only]:w-auto\"],\n        horizontal: [\n          \"flex-row items-center\",\n          \"[&>[data-slot=field-label]]:flex-auto\",\n          \"has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px has-[>[data-slot=field-content]]:items-start\",\n        ],\n        responsive: [\n          \"@md/field-group:flex-row @md/field-group:items-center @md/field-group:[&>*]:w-auto flex-col [&>*]:w-full [&>.sr-only]:w-auto\",\n          \"@md/field-group:[&>[data-slot=field-label]]:flex-auto\",\n          \"@md/field-group:has-[>[data-slot=field-content]]:items-start @md/field-group:has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px\",\n        ],\n      },\n    },\n    defaultVariants: {\n      orientation: \"vertical\",\n    },\n  }\n)\n\nfunction Field({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof fieldVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"field\"\n      data-orientation={orientation}\n      className={cn(fieldVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction FieldContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-content\"\n      className={cn(\n        \"group/field-content flex flex-1 flex-col gap-1.5 leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLabel({\n  className,\n  ...props\n}: React.ComponentProps<typeof Label>) {\n  return (\n    <Label\n      data-slot=\"field-label\"\n      className={cn(\n        \"group/field-label peer/field-label flex w-fit gap-2 leading-snug group-data-[disabled=true]/field:opacity-50\",\n        \"has-[>[data-slot=field]]:w-full has-[>[data-slot=field]]:flex-col has-[>[data-slot=field]]:rounded-md has-[>[data-slot=field]]:border [&>[data-slot=field]]:p-4\",\n        \"has-data-[state=checked]:bg-primary/5 has-data-[state=checked]:border-primary dark:has-data-[state=checked]:bg-primary/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-label\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug group-data-[disabled=true]/field:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"field-description\"\n      className={cn(\n        \"text-muted-foreground text-sm font-normal leading-normal group-has-[[data-orientation=horizontal]]/field:text-balance\",\n        \"nth-last-2:-mt-1 last:mt-0 [[data-variant=legend]+&]:-mt-1.5\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldSeparator({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  children?: React.ReactNode\n}) {\n  return (\n    <div\n      data-slot=\"field-separator\"\n      data-content={!!children}\n      className={cn(\n        \"relative -my-2 h-5 text-sm group-data-[variant=outline]/field-group:-mb-2\",\n        className\n      )}\n      {...props}\n    >\n      <Separator className=\"absolute inset-0 top-1/2\" />\n      {children && (\n        <span\n          className=\"bg-background text-muted-foreground relative mx-auto block w-fit px-2\"\n          data-slot=\"field-separator-content\"\n        >\n          {children}\n        </span>\n      )}\n    </div>\n  )\n}\n\nfunction FieldError({\n  className,\n  children,\n  errors,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  errors?: Array<{ message?: string } | undefined>\n}) {\n  const content = useMemo(() => {\n    if (children) {\n      return children\n    }\n\n    if (!errors) {\n      return null\n    }\n\n    if (errors?.length === 1 && errors[0]?.message) {\n      return errors[0].message\n    }\n\n    return (\n      <ul className=\"ml-4 flex list-disc flex-col gap-1\">\n        {errors.map(\n          (error, index) =>\n            error?.message && <li key={index}>{error.message}</li>\n        )}\n      </ul>\n    )\n  }, [children, errors])\n\n  if (!content) {\n    return null\n  }\n\n  return (\n    <div\n      role=\"alert\"\n      data-slot=\"field-error\"\n      className={cn(\"text-destructive text-sm font-normal\", className)}\n      {...props}\n    >\n      {content}\n    </div>\n  )\n}\n\nexport {\n  Field,\n  FieldLabel,\n  FieldDescription,\n  FieldError,\n  FieldGroup,\n  FieldLegend,\n  FieldSeparator,\n  FieldSet,\n  FieldContent,\n  FieldTitle,\n}\n","path":null,"size_bytes":6044,"size_tokens":null},"client/src/pages/store/Reorder.tsx":{"content":"import { useState } from \"react\";\nimport { MobileShell } from \"@/components/layout/MobileShell\";\nimport { BottomNav } from \"@/components/layout/BottomNav\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Send, AlertTriangle, Loader2 } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useLocation } from \"wouter\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\n\nexport default function StoreReorder() {\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  const queryClient = useQueryClient();\n\n  const [formData, setFormData] = useState({\n    itemName: \"\",\n    quantity: \"\",\n    unit: \"kg\",\n    vendor: \"\",\n    estimatedCost: \"\",\n    notes: \"\",\n    requester: \"Store Manager\",\n  });\n\n  const createRequest = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const res = await fetch(\"/api/requests\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n      if (!res.ok) throw new Error(\"Failed to create request\");\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Request Sent\",\n        description: \"Owner has been notified for approval.\",\n        className: \"bg-blue-600 text-white border-none\"\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/requests\"] });\n      setTimeout(() => setLocation(\"/store\"), 1500);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!formData.itemName || !formData.quantity) {\n      toast({\n        title: \"Missing Fields\",\n        description: \"Please fill in item name and quantity.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    createRequest.mutate(formData);\n  };\n\n  const estimatedCostNum = parseFloat(formData.estimatedCost) || 0;\n\n  return (\n    <MobileShell theme=\"store\" className=\"pb-20\">\n      <header className=\"sticky top-0 z-10 bg-background/80 backdrop-blur-md px-6 py-4 border-b\">\n        <h1 className=\"text-xl font-bold tracking-tight text-primary\">Request Stock</h1>\n      </header>\n\n      <main className=\"p-4\">\n        <Card className=\"border-none shadow-md\">\n           {estimatedCostNum > 500 && (\n             <div className=\"bg-yellow-50 border-b border-yellow-100 p-3 flex items-start gap-2 text-sm text-yellow-800\">\n               <AlertTriangle className=\"h-4 w-4 mt-0.5 shrink-0\" />\n               <p>Orders over $500 require Owner approval.</p>\n             </div>\n           )}\n\n          <CardContent className=\"p-5 pt-4\">\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"space-y-1\">\n                <Label htmlFor=\"vendor\">Vendor</Label>\n                <Select value={formData.vendor} onValueChange={(v) => setFormData(prev => ({ ...prev, vendor: v }))}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select vendor...\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"local\">Local Roasters Co.</SelectItem>\n                    <SelectItem value=\"dairy\">City Dairy Supplies</SelectItem>\n                    <SelectItem value=\"pack\">EcoPackaging Solutions</SelectItem>\n                    <SelectItem value=\"other\">Other</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-1\">\n                <Label htmlFor=\"item\">Item Name *</Label>\n                <Input \n                  id=\"item\" \n                  placeholder=\"e.g. Espresso Blend\" \n                  value={formData.itemName}\n                  onChange={(e) => setFormData(prev => ({ ...prev, itemName: e.target.value }))}\n                />\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-1\">\n                  <Label htmlFor=\"qty\">Quantity *</Label>\n                  <Input \n                    id=\"qty\" \n                    type=\"number\" \n                    placeholder=\"0\" \n                    value={formData.quantity}\n                    onChange={(e) => setFormData(prev => ({ ...prev, quantity: e.target.value }))}\n                  />\n                </div>\n                <div className=\"space-y-1\">\n                  <Label htmlFor=\"unit\">Unit</Label>\n                  <Select value={formData.unit} onValueChange={(v) => setFormData(prev => ({ ...prev, unit: v }))}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Unit\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"kg\">kg</SelectItem>\n                      <SelectItem value=\"L\">L</SelectItem>\n                      <SelectItem value=\"units\">units</SelectItem>\n                      <SelectItem value=\"box\">box</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div className=\"space-y-1\">\n                <Label htmlFor=\"cost\">Estimated Cost ($)</Label>\n                <Input \n                  id=\"cost\" \n                  type=\"number\" \n                  placeholder=\"0.00\" \n                  value={formData.estimatedCost}\n                  onChange={(e) => setFormData(prev => ({ ...prev, estimatedCost: e.target.value }))}\n                />\n              </div>\n\n              <div className=\"space-y-1\">\n                <Label htmlFor=\"notes\">Notes</Label>\n                <Textarea \n                  id=\"notes\" \n                  placeholder=\"Urgency, specific batch, etc.\" \n                  value={formData.notes}\n                  onChange={(e) => setFormData(prev => ({ ...prev, notes: e.target.value }))}\n                />\n              </div>\n\n              <div className=\"pt-2\">\n                <Button \n                  type=\"submit\" \n                  className=\"w-full bg-primary hover:bg-primary/90 text-white flex items-center justify-center gap-2\"\n                  disabled={createRequest.isPending}\n                >\n                  {createRequest.isPending ? (\n                    <><Loader2 className=\"h-4 w-4 animate-spin\" /> Sending...</>\n                  ) : (\n                    <><Send className=\"h-4 w-4\" /> Send Request</>\n                  )}\n                </Button>\n              </div>\n            </form>\n          </CardContent>\n        </Card>\n      </main>\n      <BottomNav role=\"store\" />\n    </MobileShell>\n  );\n}\n","path":null,"size_bytes":7003,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":724,"size_tokens":null},"client/src/components/ui/button-group.tsx":{"content":"import { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nconst buttonGroupVariants = cva(\n  \"flex w-fit items-stretch has-[>[data-slot=button-group]]:gap-2 [&>*]:focus-visible:relative [&>*]:focus-visible:z-10 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-md [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1\",\n  {\n    variants: {\n      orientation: {\n        horizontal:\n          \"[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none\",\n        vertical:\n          \"flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none\",\n      },\n    },\n    defaultVariants: {\n      orientation: \"horizontal\",\n    },\n  }\n)\n\nfunction ButtonGroup({\n  className,\n  orientation,\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof buttonGroupVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"button-group\"\n      data-orientation={orientation}\n      className={cn(buttonGroupVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupText({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  asChild?: boolean\n}) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      className={cn(\n        \"bg-muted shadow-xs flex items-center gap-2 rounded-md border px-4 text-sm font-medium [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupSeparator({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"button-group-separator\"\n      orientation={orientation}\n      className={cn(\n        \"bg-input relative !m-0 self-stretch data-[orientation=vertical]:h-auto\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  ButtonGroup,\n  ButtonGroupSeparator,\n  ButtonGroupText,\n  buttonGroupVariants,\n}\n","path":null,"size_bytes":2209,"size_tokens":null},"client/src/pages/store/Usage.tsx":{"content":"import { useState } from \"react\";\nimport { MobileShell } from \"@/components/layout/MobileShell\";\nimport { BottomNav } from \"@/components/layout/BottomNav\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { ArrowDown, ArrowUp, Package, Loader2, Calendar, TrendingDown } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { format, subDays } from \"date-fns\";\n\ntype DateRange = \"today\" | \"yesterday\" | \"week\";\n\ninterface IngredientMovement {\n  ingredient_id: string;\n  ingredient_name: string;\n  cost_start: number;\n  cost_end: number;\n  start: number;\n  income: number;\n  write_offs: number;\n  end: number;\n}\n\ninterface MovementsResponse {\n  movements: IngredientMovement[];\n  withUsage: IngredientMovement[];\n  summary: {\n    totalItems: number;\n    itemsWithUsage: number;\n    totalUsage: number;\n    totalCost: string;\n    dateFrom: string;\n    dateTo: string;\n  };\n}\n\nexport default function StoreUsage() {\n  const [dateRange, setDateRange] = useState<DateRange>(\"today\");\n\n  const getDateParams = () => {\n    const now = new Date();\n    switch (dateRange) {\n      case \"today\":\n        return { from: format(now, \"yyyy-MM-dd\"), to: format(now, \"yyyy-MM-dd\") };\n      case \"yesterday\":\n        const yesterday = subDays(now, 1);\n        return { from: format(yesterday, \"yyyy-MM-dd\"), to: format(yesterday, \"yyyy-MM-dd\") };\n      case \"week\":\n        return { from: format(subDays(now, 7), \"yyyy-MM-dd\"), to: format(now, \"yyyy-MM-dd\") };\n    }\n  };\n\n  const params = getDateParams();\n\n  const { data, isLoading, refetch } = useQuery<MovementsResponse>({\n    queryKey: [\"/api/posterpos/movements\", params.from, params.to],\n    queryFn: async () => {\n      const res = await fetch(`/api/posterpos/movements?from=${params.from}&to=${params.to}`);\n      if (!res.ok) throw new Error(\"Failed to fetch movements\");\n      return res.json();\n    },\n  });\n\n  const sortedMovements = data?.movements\n    ?.filter(m => m.write_offs > 0)\n    .sort((a, b) => b.write_offs - a.write_offs) || [];\n\n  return (\n    <MobileShell theme=\"store\" className=\"pb-20\">\n      <header className=\"sticky top-0 z-10 bg-background/80 backdrop-blur-md px-6 py-4 border-b\">\n        <h1 className=\"text-xl font-bold tracking-tight text-primary\">Inventory Usage</h1>\n        <p className=\"text-sm text-muted-foreground\">Ingredient consumption from sales</p>\n      </header>\n\n      <main className=\"p-4 space-y-4\">\n        {/* Date Range Selector */}\n        <div className=\"flex gap-2 overflow-x-auto pb-2\">\n          {[\n            { key: \"today\", label: \"Today\" },\n            { key: \"yesterday\", label: \"Yesterday\" },\n            { key: \"week\", label: \"7 Days\" },\n          ].map(({ key, label }) => (\n            <Button\n              key={key}\n              variant={dateRange === key ? \"default\" : \"outline\"}\n              size=\"sm\"\n              className=\"shrink-0\"\n              onClick={() => setDateRange(key as DateRange)}\n              data-testid={`button-date-${key}`}\n            >\n              {label}\n            </Button>\n          ))}\n        </div>\n\n        {/* Summary Card */}\n        <Card className=\"bg-primary text-primary-foreground border-none\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm opacity-80\">\n                  {dateRange === \"today\" ? \"Today's Usage\" : \n                   dateRange === \"yesterday\" ? \"Yesterday's Usage\" : \"Last 7 Days\"}\n                </p>\n                <div className=\"flex items-baseline gap-2 mt-1\">\n                  {isLoading ? (\n                    <Loader2 className=\"h-6 w-6 animate-spin\" />\n                  ) : (\n                    <>\n                      <span className=\"text-3xl font-bold\" data-testid=\"text-items-used\">\n                        {data?.summary.itemsWithUsage || 0}\n                      </span>\n                      <span className=\"text-sm opacity-80\">items used</span>\n                    </>\n                  )}\n                </div>\n              </div>\n              <div className=\"text-right\">\n                <TrendingDown className=\"h-8 w-8 opacity-50\" />\n                {data?.summary.totalCost && (\n                  <p className=\"text-sm opacity-80 mt-1\">\n                    KES {data.summary.totalCost} cost\n                  </p>\n                )}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Usage List */}\n        <div className=\"space-y-3\">\n          <div className=\"flex items-center justify-between px-1\">\n            <h3 className=\"text-sm font-semibold text-muted-foreground uppercase tracking-wider flex items-center gap-2\">\n              <Package className=\"h-4 w-4\" />\n              Ingredient Movements\n            </h3>\n            <Button variant=\"ghost\" size=\"sm\" onClick={() => refetch()} data-testid=\"button-refresh\">\n              Refresh\n            </Button>\n          </div>\n\n          {isLoading ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n            </div>\n          ) : sortedMovements.length === 0 ? (\n            <Card className=\"p-8 text-center\">\n              <Calendar className=\"h-12 w-12 mx-auto text-muted-foreground/50 mb-2\" />\n              <p className=\"text-muted-foreground\">No ingredient usage recorded</p>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                Usage appears when sales are made through PosterPOS\n              </p>\n            </Card>\n          ) : (\n            sortedMovements.map((movement) => (\n              <Card key={movement.ingredient_id} className=\"border-none shadow-sm\" data-testid={`card-movement-${movement.ingredient_id}`}>\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"h-10 w-10 rounded-full bg-red-100 flex items-center justify-center text-red-600\">\n                        <ArrowDown className=\"h-5 w-5\" />\n                      </div>\n                      <div>\n                        <p className=\"font-medium text-sm\">{movement.ingredient_name}</p>\n                        <div className=\"flex gap-3 text-xs text-muted-foreground mt-1\">\n                          <span className=\"flex items-center gap-1\">\n                            Start: {movement.start.toFixed(1)}\n                          </span>\n                          <span className=\"flex items-center gap-1\">\n                            End: {movement.end.toFixed(1)}\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"text-right\">\n                      <p className=\"font-bold text-red-600\">-{movement.write_offs.toFixed(1)}</p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        KES {(movement.write_offs * movement.cost_end).toFixed(2)}\n                      </p>\n                    </div>\n                  </div>\n                  \n                  {/* Stock level indicator */}\n                  <div className=\"mt-3\">\n                    <div className=\"flex justify-between text-xs text-muted-foreground mb-1\">\n                      <span>Remaining Stock</span>\n                      <span>{movement.end.toFixed(1)}</span>\n                    </div>\n                    <div className=\"h-2 bg-muted rounded-full overflow-hidden\">\n                      <div \n                        className={`h-full transition-all ${\n                          movement.end < movement.start * 0.2 ? 'bg-red-500' :\n                          movement.end < movement.start * 0.4 ? 'bg-yellow-500' : 'bg-green-500'\n                        }`}\n                        style={{ width: `${Math.min(100, (movement.end / Math.max(movement.start, 1)) * 100)}%` }}\n                      />\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          )}\n        </div>\n\n        {/* Income section for restocks */}\n        {data?.movements.some(m => m.income > 0) && (\n          <div className=\"space-y-3 mt-6\">\n            <h3 className=\"text-sm font-semibold text-muted-foreground uppercase tracking-wider px-1 flex items-center gap-2\">\n              <ArrowUp className=\"h-4 w-4\" />\n              Restocks / Supplies\n            </h3>\n            \n            {data.movements\n              .filter(m => m.income > 0)\n              .map((movement) => (\n                <Card key={`income-${movement.ingredient_id}`} className=\"border-none shadow-sm\">\n                  <CardContent className=\"p-4 flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"h-10 w-10 rounded-full bg-green-100 flex items-center justify-center text-green-600\">\n                        <ArrowUp className=\"h-5 w-5\" />\n                      </div>\n                      <div>\n                        <p className=\"font-medium text-sm\">{movement.ingredient_name}</p>\n                        <p className=\"text-xs text-muted-foreground\">Restocked</p>\n                      </div>\n                    </div>\n                    <p className=\"font-bold text-green-600\">+{movement.income.toFixed(1)}</p>\n                  </CardContent>\n                </Card>\n              ))}\n          </div>\n        )}\n      </main>\n      <BottomNav role=\"store\" />\n    </MobileShell>\n  );\n}\n","path":null,"size_bytes":9734,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/shop/ClosingStock.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { CheckCircle, ChevronLeft, ChevronRight, Loader2, Moon, Play, AlertCircle } from \"lucide-react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface InventoryItem {\n  id: string;\n  name: string;\n  posterPosId: string;\n  unit: string;\n  currentStock: string;\n}\n\ninterface StockEntry {\n  id: string;\n  itemName: string;\n  quantity: string;\n  unit: string;\n}\n\ninterface StockSession {\n  id: string;\n  status: string;\n  staffName: string;\n  totalItems: number;\n  countedItems: number;\n  completedAt?: string;\n}\n\nexport function ClosingStock() {\n  const [staffName, setStaffName] = useState(\"\");\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [currentQty, setCurrentQty] = useState(\"\");\n  const [session, setSession] = useState<StockSession | null>(null);\n  const [entries, setEntries] = useState<Record<string, string>>({});\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: openingSession } = useQuery({\n    queryKey: [\"/api/shop/stock/session/opening\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/shop/stock/session/opening\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(`${res.status}: ${await res.text()}`);\n      return res.json();\n    },\n  });\n\n  const { data: sessionData, isLoading: loadingSession } = useQuery({\n    queryKey: [\"/api/shop/stock/session/closing\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/shop/stock/session/closing\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(`${res.status}: ${await res.text()}`);\n      return res.json();\n    },\n  });\n\n  const { data: items = [], isLoading: loadingItems } = useQuery<InventoryItem[]>({\n    queryKey: [\"/api/shop/stock/items\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/shop/stock/items\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(`${res.status}: ${await res.text()}`);\n      return res.json();\n    },\n  });\n\n  useEffect(() => {\n    if (sessionData?.session) {\n      setSession(sessionData.session);\n      if (sessionData.entries) {\n        const entryMap: Record<string, string> = {};\n        sessionData.entries.forEach((e: StockEntry) => {\n          entryMap[e.itemName] = e.quantity;\n        });\n        setEntries(entryMap);\n        setCurrentIndex(sessionData.entries.length);\n      }\n    }\n  }, [sessionData]);\n\n  const startSessionMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", \"/api/shop/stock/session\", { sessionType: \"closing\", staffName });\n      return res.json();\n    },\n    onSuccess: (data) => {\n      setSession(data.session);\n      if (data.resumed) {\n        toast({ title: \"Resumed existing session\" });\n        const entryMap: Record<string, string> = {};\n        data.entries?.forEach((e: StockEntry) => {\n          entryMap[e.itemName] = e.quantity;\n        });\n        setEntries(entryMap);\n        setCurrentIndex(data.entries?.length || 0);\n      } else {\n        toast({ title: \"Closing stock started\" });\n      }\n    },\n    onError: () => {\n      toast({ title: \"Failed to start session\", variant: \"destructive\" });\n    },\n  });\n\n  const saveEntryMutation = useMutation({\n    mutationFn: async (item: InventoryItem) => {\n      const res = await apiRequest(\"POST\", \"/api/shop/stock/entry\", {\n        sessionId: session?.id,\n        itemName: item.name,\n        quantity: currentQty,\n        unit: item.unit,\n        inventoryItemId: item.id,\n        posterPosId: item.posterPosId,\n      });\n      return res.json();\n    },\n    onSuccess: (_, item) => {\n      setEntries({ ...entries, [item.name]: currentQty });\n      setCurrentQty(\"\");\n      if (currentIndex < items.length - 1) {\n        setCurrentIndex(currentIndex + 1);\n      }\n    },\n    onError: () => {\n      toast({ title: \"Failed to save entry\", variant: \"destructive\" });\n    },\n  });\n\n  const completeSessionMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"PATCH\", `/api/shop/stock/session/${session?.id}/complete`);\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Closing stock completed! Reconciliation sent to owner.\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/shop/stock/session/closing\"] });\n    },\n    onError: () => {\n      toast({ title: \"Failed to complete session\", variant: \"destructive\" });\n    },\n  });\n\n  const handleNext = () => {\n    if (!currentQty || !items[currentIndex]) return;\n    saveEntryMutation.mutate(items[currentIndex]);\n  };\n\n  const handleSkip = () => {\n    if (currentIndex < items.length - 1) {\n      setCurrentIndex(currentIndex + 1);\n      setCurrentQty(\"\");\n    }\n  };\n\n  const handlePrev = () => {\n    if (currentIndex > 0) {\n      setCurrentIndex(currentIndex - 1);\n      const prevItem = items[currentIndex - 1];\n      setCurrentQty(entries[prevItem.name] || \"\");\n    }\n  };\n\n  const handleComplete = () => {\n    completeSessionMutation.mutate();\n  };\n\n  const progress = items.length > 0 ? (Object.keys(entries).length / items.length) * 100 : 0;\n  const currentItem = items[currentIndex];\n  const isCompleted = session?.status === \"completed\";\n  const openingCompleted = openingSession?.session?.status === \"completed\";\n\n  if (loadingSession || loadingItems) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!openingCompleted) {\n    return (\n      <Card className=\"bg-yellow-50 border-yellow-200\">\n        <CardContent className=\"p-6 text-center\">\n          <AlertCircle className=\"h-12 w-12 text-yellow-600 mx-auto mb-4\" />\n          <h3 className=\"text-lg font-semibold text-yellow-800\">Opening Stock Not Completed</h3>\n          <p className=\"text-sm text-yellow-600 mt-1\">\n            Please complete opening stock first before closing\n          </p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (isCompleted) {\n    return (\n      <Card className=\"bg-green-50 border-green-200\">\n        <CardContent className=\"p-6 text-center\">\n          <CheckCircle className=\"h-12 w-12 text-green-600 mx-auto mb-4\" />\n          <h3 className=\"text-lg font-semibold text-green-800\">Closing Stock Completed</h3>\n          <p className=\"text-sm text-green-600 mt-1\">\n            Reconciliation report sent to owner\n          </p>\n          <p className=\"text-sm text-muted-foreground mt-2\">\n            {Object.keys(entries).length} items counted\n          </p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (!session) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Moon className=\"h-5 w-5\" />\n            Start Closing Stock\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div>\n            <Label htmlFor=\"staffName\">Your Name</Label>\n            <Input\n              id=\"staffName\"\n              value={staffName}\n              onChange={(e) => setStaffName(e.target.value)}\n              placeholder=\"Enter your name\"\n              data-testid=\"input-closing-staff-name\"\n            />\n          </div>\n          <Button\n            className=\"w-full\"\n            onClick={() => startSessionMutation.mutate()}\n            disabled={!staffName || startSessionMutation.isPending}\n            data-testid=\"button-start-closing\"\n          >\n            {startSessionMutation.isPending ? (\n              <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n            ) : (\n              <Play className=\"h-4 w-4 mr-2\" />\n            )}\n            Start Counting\n          </Button>\n          <p className=\"text-xs text-muted-foreground text-center\">\n            After completion, a reconciliation report will be sent to the owner\n          </p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <Card className=\"bg-primary/5 border-primary/20\">\n        <CardContent className=\"p-4\">\n          <div className=\"flex justify-between text-sm mb-2\">\n            <span>Progress</span>\n            <span className=\"font-medium\">{Object.keys(entries).length} / {items.length}</span>\n          </div>\n          <Progress value={progress} className=\"h-2\" />\n        </CardContent>\n      </Card>\n\n      {currentItem && (\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-sm text-muted-foreground\">\n                Item {currentIndex + 1} of {items.length}\n              </span>\n              {entries[currentItem.name] && (\n                <span className=\"text-xs bg-green-100 text-green-700 px-2 py-1 rounded\">\n                  Counted: {entries[currentItem.name]}\n                </span>\n              )}\n            </div>\n            <CardTitle className=\"text-lg\">{currentItem.name}</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"qty\">Quantity ({currentItem.unit})</Label>\n              <Input\n                id=\"qty\"\n                type=\"number\"\n                inputMode=\"decimal\"\n                value={currentQty}\n                onChange={(e) => setCurrentQty(e.target.value)}\n                placeholder=\"Enter quantity\"\n                className=\"text-2xl h-14 text-center\"\n                autoFocus\n                data-testid=\"input-closing-quantity\"\n              />\n            </div>\n\n            <div className=\"grid grid-cols-3 gap-2\">\n              <Button\n                variant=\"outline\"\n                onClick={handlePrev}\n                disabled={currentIndex === 0}\n                data-testid=\"button-closing-prev\"\n              >\n                <ChevronLeft className=\"h-4 w-4\" />\n              </Button>\n              <Button\n                onClick={handleNext}\n                disabled={!currentQty || saveEntryMutation.isPending}\n                data-testid=\"button-closing-next\"\n              >\n                {saveEntryMutation.isPending ? (\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\n                ) : (\n                  <>\n                    Save <ChevronRight className=\"h-4 w-4 ml-1\" />\n                  </>\n                )}\n              </Button>\n              <Button\n                variant=\"ghost\"\n                onClick={handleSkip}\n                disabled={currentIndex === items.length - 1}\n                data-testid=\"button-closing-skip\"\n              >\n                Skip\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {Object.keys(entries).length === items.length && items.length > 0 && (\n        <Button\n          className=\"w-full\"\n          size=\"lg\"\n          onClick={handleComplete}\n          disabled={completeSessionMutation.isPending}\n          data-testid=\"button-complete-closing\"\n        >\n          {completeSessionMutation.isPending ? (\n            <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n          ) : (\n            <CheckCircle className=\"h-4 w-4 mr-2\" />\n          )}\n          Complete & Send Report\n        </Button>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":11660,"size_tokens":null},"client/src/components/ui/sonner.tsx":{"content":"\"use client\"\n\nimport { useTheme } from \"next-themes\"\nimport { Toaster as Sonner } from \"sonner\"\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>\n\nconst Toaster = ({ ...props }: ToasterProps) => {\n  const { theme = \"system\" } = useTheme()\n\n  return (\n    <Sonner\n      theme={theme as ToasterProps[\"theme\"]}\n      className=\"toaster group\"\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton:\n            \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton:\n            \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n      }}\n      {...props}\n    />\n  )\n}\n\nexport { Toaster }\n","path":null,"size_bytes":894,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"px-2 py-1.5 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute right-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5745,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/components/shop/OpeningStock.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { CheckCircle, ChevronLeft, ChevronRight, Loader2, Package, Play, RotateCcw } from \"lucide-react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface InventoryItem {\n  id: string;\n  name: string;\n  posterPosId: string;\n  unit: string;\n  currentStock: string;\n}\n\ninterface StockEntry {\n  id: string;\n  itemName: string;\n  quantity: string;\n  unit: string;\n}\n\ninterface StockSession {\n  id: string;\n  status: string;\n  staffName: string;\n  totalItems: number;\n  countedItems: number;\n  completedAt?: string;\n}\n\nexport function OpeningStock() {\n  const [staffName, setStaffName] = useState(\"\");\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [currentQty, setCurrentQty] = useState(\"\");\n  const [session, setSession] = useState<StockSession | null>(null);\n  const [entries, setEntries] = useState<Record<string, string>>({});\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: sessionData, isLoading: loadingSession } = useQuery({\n    queryKey: [\"/api/shop/stock/session/opening\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/shop/stock/session/opening\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(`${res.status}: ${await res.text()}`);\n      return res.json();\n    },\n  });\n\n  const { data: items = [], isLoading: loadingItems } = useQuery<InventoryItem[]>({\n    queryKey: [\"/api/shop/stock/items\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/shop/stock/items\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(`${res.status}: ${await res.text()}`);\n      return res.json();\n    },\n  });\n\n  useEffect(() => {\n    if (sessionData?.session) {\n      setSession(sessionData.session);\n      if (sessionData.entries) {\n        const entryMap: Record<string, string> = {};\n        sessionData.entries.forEach((e: StockEntry) => {\n          entryMap[e.itemName] = e.quantity;\n        });\n        setEntries(entryMap);\n        setCurrentIndex(sessionData.entries.length);\n      }\n    }\n  }, [sessionData]);\n\n  const startSessionMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", \"/api/shop/stock/session\", { sessionType: \"opening\", staffName });\n      return res.json();\n    },\n    onSuccess: (data) => {\n      setSession(data.session);\n      if (data.resumed) {\n        toast({ title: \"Resumed existing session\" });\n        const entryMap: Record<string, string> = {};\n        data.entries?.forEach((e: StockEntry) => {\n          entryMap[e.itemName] = e.quantity;\n        });\n        setEntries(entryMap);\n        setCurrentIndex(data.entries?.length || 0);\n      } else {\n        toast({ title: \"Opening stock started\" });\n      }\n    },\n    onError: () => {\n      toast({ title: \"Failed to start session\", variant: \"destructive\" });\n    },\n  });\n\n  const saveEntryMutation = useMutation({\n    mutationFn: async (item: InventoryItem) => {\n      const res = await apiRequest(\"POST\", \"/api/shop/stock/entry\", {\n        sessionId: session?.id,\n        itemName: item.name,\n        quantity: currentQty,\n        unit: item.unit,\n        inventoryItemId: item.id,\n        posterPosId: item.posterPosId,\n      });\n      return res.json();\n    },\n    onSuccess: (_, item) => {\n      setEntries({ ...entries, [item.name]: currentQty });\n      setCurrentQty(\"\");\n      if (currentIndex < items.length - 1) {\n        setCurrentIndex(currentIndex + 1);\n      }\n    },\n    onError: () => {\n      toast({ title: \"Failed to save entry\", variant: \"destructive\" });\n    },\n  });\n\n  const completeSessionMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"PATCH\", `/api/shop/stock/session/${session?.id}/complete`);\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Opening stock completed!\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/shop/stock/session/opening\"] });\n    },\n    onError: () => {\n      toast({ title: \"Failed to complete session\", variant: \"destructive\" });\n    },\n  });\n\n  const handleNext = () => {\n    if (!currentQty || !items[currentIndex]) return;\n    saveEntryMutation.mutate(items[currentIndex]);\n  };\n\n  const handleSkip = () => {\n    if (currentIndex < items.length - 1) {\n      setCurrentIndex(currentIndex + 1);\n      setCurrentQty(\"\");\n    }\n  };\n\n  const handlePrev = () => {\n    if (currentIndex > 0) {\n      setCurrentIndex(currentIndex - 1);\n      const prevItem = items[currentIndex - 1];\n      setCurrentQty(entries[prevItem.name] || \"\");\n    }\n  };\n\n  const handleComplete = () => {\n    completeSessionMutation.mutate();\n  };\n\n  const progress = items.length > 0 ? (Object.keys(entries).length / items.length) * 100 : 0;\n  const currentItem = items[currentIndex];\n  const isCompleted = session?.status === \"completed\";\n\n  if (loadingSession || loadingItems) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (isCompleted) {\n    return (\n      <Card className=\"bg-green-50 border-green-200\">\n        <CardContent className=\"p-6 text-center\">\n          <CheckCircle className=\"h-12 w-12 text-green-600 mx-auto mb-4\" />\n          <h3 className=\"text-lg font-semibold text-green-800\">Opening Stock Completed</h3>\n          <p className=\"text-sm text-green-600 mt-1\">\n            Completed at {session?.completedAt ? new Date(session.completedAt).toLocaleTimeString() : \"today\"}\n          </p>\n          <p className=\"text-sm text-muted-foreground mt-2\">\n            {Object.keys(entries).length} items counted\n          </p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (!session) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Package className=\"h-5 w-5\" />\n            Start Opening Stock\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div>\n            <Label htmlFor=\"staffName\">Your Name</Label>\n            <Input\n              id=\"staffName\"\n              value={staffName}\n              onChange={(e) => setStaffName(e.target.value)}\n              placeholder=\"Enter your name\"\n              data-testid=\"input-staff-name\"\n            />\n          </div>\n          <Button\n            className=\"w-full\"\n            onClick={() => startSessionMutation.mutate()}\n            disabled={!staffName || startSessionMutation.isPending}\n            data-testid=\"button-start-opening\"\n          >\n            {startSessionMutation.isPending ? (\n              <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n            ) : (\n              <Play className=\"h-4 w-4 mr-2\" />\n            )}\n            Start Counting\n          </Button>\n          <p className=\"text-xs text-muted-foreground text-center\">\n            You'll go through {items.length} items one by one\n          </p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <Card className=\"bg-primary/5 border-primary/20\">\n        <CardContent className=\"p-4\">\n          <div className=\"flex justify-between text-sm mb-2\">\n            <span>Progress</span>\n            <span className=\"font-medium\">{Object.keys(entries).length} / {items.length}</span>\n          </div>\n          <Progress value={progress} className=\"h-2\" />\n        </CardContent>\n      </Card>\n\n      {currentItem && (\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-sm text-muted-foreground\">\n                Item {currentIndex + 1} of {items.length}\n              </span>\n              {entries[currentItem.name] && (\n                <span className=\"text-xs bg-green-100 text-green-700 px-2 py-1 rounded\">\n                  Counted: {entries[currentItem.name]}\n                </span>\n              )}\n            </div>\n            <CardTitle className=\"text-lg\">{currentItem.name}</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"qty\">Quantity ({currentItem.unit})</Label>\n              <Input\n                id=\"qty\"\n                type=\"number\"\n                inputMode=\"decimal\"\n                value={currentQty}\n                onChange={(e) => setCurrentQty(e.target.value)}\n                placeholder=\"Enter quantity\"\n                className=\"text-2xl h-14 text-center\"\n                autoFocus\n                data-testid=\"input-quantity\"\n              />\n            </div>\n\n            <div className=\"grid grid-cols-3 gap-2\">\n              <Button\n                variant=\"outline\"\n                onClick={handlePrev}\n                disabled={currentIndex === 0}\n                data-testid=\"button-prev\"\n              >\n                <ChevronLeft className=\"h-4 w-4\" />\n              </Button>\n              <Button\n                onClick={handleNext}\n                disabled={!currentQty || saveEntryMutation.isPending}\n                data-testid=\"button-next\"\n              >\n                {saveEntryMutation.isPending ? (\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\n                ) : (\n                  <>\n                    Save <ChevronRight className=\"h-4 w-4 ml-1\" />\n                  </>\n                )}\n              </Button>\n              <Button\n                variant=\"ghost\"\n                onClick={handleSkip}\n                disabled={currentIndex === items.length - 1}\n                data-testid=\"button-skip\"\n              >\n                Skip\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {Object.keys(entries).length === items.length && items.length > 0 && (\n        <Button\n          className=\"w-full\"\n          size=\"lg\"\n          onClick={handleComplete}\n          disabled={completeSessionMutation.isPending}\n          data-testid=\"button-complete-opening\"\n        >\n          {completeSessionMutation.isPending ? (\n            <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n          ) : (\n            <CheckCircle className=\"h-4 w-4 mr-2\" />\n          )}\n          Complete Opening Stock\n        </Button>\n      )}\n\n      {Object.keys(entries).length > 0 && Object.keys(entries).length < items.length && (\n        <p className=\"text-xs text-center text-muted-foreground\">\n          {items.length - Object.keys(entries).length} items remaining\n        </p>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":10980,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // @replit\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \",\n  {\n    variants: {\n      variant: {\n        default:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary:\n          // @replit no hover because we use hover-elevate\n          \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n          // @replit shadow-xs\" - use badge outline variable\n        outline: \"text-foreground border [border-color:var(--badge-outline)]\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1522,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/components/layout/BottomNav.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { cn } from \"@/lib/utils\";\nimport { LayoutGrid, ShoppingCart, Package, Settings, ArrowLeft, TrendingDown, Beaker } from \"lucide-react\";\n\ninterface BottomNavProps {\n  role: \"owner\" | \"store\" | \"shop\";\n}\n\nexport function BottomNav({ role }: BottomNavProps) {\n  const [location] = useLocation();\n\n  const links = {\n    owner: [\n      { href: \"/owner\", icon: LayoutGrid, label: \"Overview\" },\n      { href: \"/owner/analytics\", icon: ShoppingCart, label: \"Analytics\" },\n      { href: \"/owner/usage\", icon: Beaker, label: \"Usage\" },\n      { href: \"/owner/requests\", icon: Settings, label: \"Requests\" },\n    ],\n    store: [\n      { href: \"/store\", icon: Package, label: \"Stock\" },\n      { href: \"/store/usage\", icon: TrendingDown, label: \"Usage\" },\n      { href: \"/store/despatch\", icon: ArrowLeft, label: \"Despatch\" },\n      { href: \"/store/reorder\", icon: LayoutGrid, label: \"Order\" },\n    ],\n    shop: [\n      { href: \"/shop\", icon: Package, label: \"Stock\" },\n    ]\n  };\n\n  return (\n    <nav className=\"fixed bottom-0 left-0 right-0 z-50 border-t bg-background/80 backdrop-blur-lg sm:max-w-md sm:mx-auto sm:left-auto sm:right-auto\">\n      <div className=\"flex h-16 items-center justify-around px-2\">\n        {links[role].map((link) => {\n          const isActive = location === link.href;\n          return (\n            <Link \n              key={link.href} \n              href={link.href}\n              className={cn(\n                \"flex flex-col items-center justify-center gap-1 rounded-lg px-3 py-2 text-xs font-medium transition-colors\",\n                isActive \n                  ? \"text-primary\" \n                  : \"text-muted-foreground hover:text-foreground\"\n              )}\n            >\n              <link.icon className={cn(\"h-5 w-5\", isActive && \"fill-current opacity-20\")} />\n              <span>{link.label}</span>\n            </Link>\n          );\n        })}\n      </div>\n    </nav>\n  );\n}\n","path":null,"size_bytes":1957,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"import * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload\n            .filter((item) => item.type !== \"none\")\n            .map((item, index) => {\n              const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n              const itemConfig = getPayloadConfigFromPayload(config, item, key)\n              const indicatorColor = color || item.payload.fill || item.color\n\n              return (\n                <div\n                  key={item.dataKey}\n                  className={cn(\n                    \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                    indicator === \"dot\" && \"items-center\"\n                  )}\n                >\n                  {formatter && item?.value !== undefined && item.name ? (\n                    formatter(item.value, item.name, item, index, item.payload)\n                  ) : (\n                    <>\n                      {itemConfig?.icon ? (\n                        <itemConfig.icon />\n                      ) : (\n                        !hideIndicator && (\n                          <div\n                            className={cn(\n                              \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                              {\n                                \"h-2.5 w-2.5\": indicator === \"dot\",\n                                \"w-1\": indicator === \"line\",\n                                \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                  indicator === \"dashed\",\n                                \"my-0.5\": nestLabel && indicator === \"dashed\",\n                              }\n                            )}\n                            style={\n                              {\n                                \"--color-bg\": indicatorColor,\n                                \"--color-border\": indicatorColor,\n                              } as React.CSSProperties\n                            }\n                          />\n                        )\n                      )}\n                      <div\n                        className={cn(\n                          \"flex flex-1 justify-between leading-none\",\n                          nestLabel ? \"items-end\" : \"items-center\"\n                        )}\n                      >\n                        <div className=\"grid gap-1.5\">\n                          {nestLabel ? tooltipLabel : null}\n                          <span className=\"text-muted-foreground\">\n                            {itemConfig?.label || item.name}\n                          </span>\n                        </div>\n                        {item.value && (\n                          <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                            {item.value.toLocaleString()}\n                          </span>\n                        )}\n                      </div>\n                    </>\n                  )}\n                </div>\n              )\n            })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload\n          .filter((item) => item.type !== \"none\")\n          .map((item) => {\n            const key = `${nameKey || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n            return (\n              <div\n                key={item.value}\n                className={cn(\n                  \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n                )}\n              >\n                {itemConfig?.icon && !hideIcon ? (\n                  <itemConfig.icon />\n                ) : (\n                  <div\n                    className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                    style={{\n                      backgroundColor: item.color,\n                    }}\n                  />\n                )}\n                {itemConfig?.label}\n              </div>\n            )\n          })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10763,"size_tokens":null},"server/storage.ts":{"content":"import { db } from \"./db\";\nimport { \n  users, \n  inventoryItems, \n  salesRecords, \n  despatchLogs, \n  reorderRequests,\n  telegramChats,\n  shopStockSessions,\n  shopStockEntries,\n  goodsReceipts,\n  goodsReceiptItems,\n  shopExpenses,\n  expenseItems,\n  stockReconciliations,\n  type User, \n  type InsertUser,\n  type InventoryItem,\n  type InsertInventoryItem,\n  type SalesRecord,\n  type InsertSalesRecord,\n  type DespatchLog,\n  type InsertDespatchLog,\n  type ReorderRequest,\n  type InsertReorderRequest,\n  type TelegramChat,\n  type InsertTelegramChat,\n  type ShopStockSession,\n  type InsertShopStockSession,\n  type ShopStockEntry,\n  type InsertShopStockEntry,\n  type GoodsReceipt,\n  type InsertGoodsReceipt,\n  type GoodsReceiptItem,\n  type InsertGoodsReceiptItem,\n  type ShopExpense,\n  type InsertShopExpense,\n  type ExpenseItem,\n  type InsertExpenseItem,\n  type StockReconciliation,\n  type InsertStockReconciliation,\n} from \"@shared/schema\";\nimport { eq, desc, gte, sql, and, between } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // Users\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n\n  // Inventory\n  getAllInventoryItems(): Promise<InventoryItem[]>;\n  getInventoryItem(id: string): Promise<InventoryItem | undefined>;\n  getInventoryItemByPosterPosId(posterPosId: string): Promise<InventoryItem | undefined>;\n  createInventoryItem(item: InsertInventoryItem): Promise<InventoryItem>;\n  updateInventoryItem(id: string, item: Partial<InsertInventoryItem>): Promise<InventoryItem | undefined>;\n  getLowStockItems(): Promise<InventoryItem[]>;\n\n  // Sales Records\n  getAllSalesRecords(limit?: number): Promise<SalesRecord[]>;\n  getSalesRecordsSince(since: Date): Promise<SalesRecord[]>;\n  getSalesRecordByPosterPosId(posterPosId: string): Promise<SalesRecord | undefined>;\n  createSalesRecord(record: InsertSalesRecord): Promise<SalesRecord>;\n  getTodaysSales(): Promise<{ total: number; count: number }>;\n\n  // Despatch Logs\n  getAllDespatchLogs(limit?: number): Promise<DespatchLog[]>;\n  createDespatchLog(log: InsertDespatchLog): Promise<DespatchLog>;\n  createDespatchWithInventoryUpdate(log: InsertDespatchLog): Promise<DespatchLog>;\n\n  // Reorder Requests\n  getAllReorderRequests(): Promise<ReorderRequest[]>;\n  getPendingReorderRequests(): Promise<ReorderRequest[]>;\n  getReorderRequest(id: string): Promise<ReorderRequest | undefined>;\n  createReorderRequest(request: InsertReorderRequest): Promise<ReorderRequest>;\n  updateReorderRequest(id: string, updates: Partial<InsertReorderRequest>): Promise<ReorderRequest | undefined>;\n\n  // Telegram Chats\n  getAllTelegramChats(): Promise<TelegramChat[]>;\n  getTelegramChatByChatId(chatId: string): Promise<TelegramChat | undefined>;\n  createTelegramChat(chat: InsertTelegramChat): Promise<TelegramChat>;\n  updateTelegramChat(id: string, updates: Partial<InsertTelegramChat>): Promise<TelegramChat | undefined>;\n\n  // Shop Stock Sessions\n  createStockSession(session: InsertShopStockSession): Promise<ShopStockSession>;\n  getStockSession(id: string): Promise<ShopStockSession | undefined>;\n  getTodaysStockSession(type: 'opening' | 'closing'): Promise<ShopStockSession | undefined>;\n  getLatestStockSession(type: 'opening' | 'closing'): Promise<ShopStockSession | undefined>;\n  updateStockSession(id: string, updates: Partial<InsertShopStockSession>): Promise<ShopStockSession | undefined>;\n  \n  // Shop Stock Entries\n  createStockEntry(entry: InsertShopStockEntry): Promise<ShopStockEntry>;\n  getStockEntriesBySession(sessionId: string): Promise<ShopStockEntry[]>;\n  updateStockEntry(id: string, updates: Partial<InsertShopStockEntry>): Promise<ShopStockEntry | undefined>;\n\n  // Goods Receipts\n  createGoodsReceipt(receipt: InsertGoodsReceipt): Promise<GoodsReceipt>;\n  getGoodsReceipt(id: string): Promise<GoodsReceipt | undefined>;\n  getPendingGoodsReceipts(): Promise<GoodsReceipt[]>;\n  getAllGoodsReceipts(limit?: number): Promise<GoodsReceipt[]>;\n  updateGoodsReceipt(id: string, updates: Partial<InsertGoodsReceipt>): Promise<GoodsReceipt | undefined>;\n\n  // Goods Receipt Items\n  createGoodsReceiptItem(item: InsertGoodsReceiptItem): Promise<GoodsReceiptItem>;\n  getGoodsReceiptItems(receiptId: string): Promise<GoodsReceiptItem[]>;\n  updateGoodsReceiptItem(id: string, updates: Partial<InsertGoodsReceiptItem>): Promise<GoodsReceiptItem | undefined>;\n\n  // Shop Expenses\n  createExpense(expense: InsertShopExpense): Promise<ShopExpense>;\n  getExpense(id: string): Promise<ShopExpense | undefined>;\n  getAllExpenses(limit?: number): Promise<ShopExpense[]>;\n  getExpensesByType(type: string): Promise<ShopExpense[]>;\n  getTodaysExpenses(): Promise<ShopExpense[]>;\n\n  // Expense Items\n  createExpenseItem(item: InsertExpenseItem): Promise<ExpenseItem>;\n  getExpenseItems(expenseId: string): Promise<ExpenseItem[]>;\n\n  // Stock Reconciliation\n  createReconciliation(recon: InsertStockReconciliation): Promise<StockReconciliation>;\n  getReconciliation(id: string): Promise<StockReconciliation | undefined>;\n  getTodaysReconciliation(): Promise<StockReconciliation | undefined>;\n  updateReconciliation(id: string, updates: Partial<InsertStockReconciliation>): Promise<StockReconciliation | undefined>;\n\n  // Pending Despatch for Shop\n  getPendingDespatchForShop(): Promise<DespatchLog[]>;\n  getDespatchLog(id: string): Promise<DespatchLog | undefined>;\n}\n\nexport class PostgresStorage implements IStorage {\n  // Users\n  async getUser(id: string): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.username, username)).limit(1);\n    return result[0];\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const result = await db.insert(users).values(insertUser).returning();\n    return result[0];\n  }\n\n  // Inventory\n  async getAllInventoryItems(): Promise<InventoryItem[]> {\n    return db.select().from(inventoryItems);\n  }\n\n  async getInventoryItem(id: string): Promise<InventoryItem | undefined> {\n    const result = await db.select().from(inventoryItems).where(eq(inventoryItems.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getInventoryItemByPosterPosId(posterPosId: string): Promise<InventoryItem | undefined> {\n    const result = await db.select().from(inventoryItems).where(eq(inventoryItems.posterPosId, posterPosId)).limit(1);\n    return result[0];\n  }\n\n  async createInventoryItem(item: InsertInventoryItem): Promise<InventoryItem> {\n    const result = await db.insert(inventoryItems).values(item).returning();\n    return result[0];\n  }\n\n  async updateInventoryItem(id: string, item: Partial<InsertInventoryItem>): Promise<InventoryItem | undefined> {\n    const result = await db.update(inventoryItems).set(item).where(eq(inventoryItems.id, id)).returning();\n    return result[0];\n  }\n\n  async getLowStockItems(): Promise<InventoryItem[]> {\n    return db.select().from(inventoryItems).where(\n      sql`CAST(${inventoryItems.currentStock} AS DECIMAL) <= CAST(${inventoryItems.minStock} AS DECIMAL)`\n    );\n  }\n\n  // Sales Records\n  async getAllSalesRecords(limit: number = 100): Promise<SalesRecord[]> {\n    return db.select().from(salesRecords).orderBy(desc(salesRecords.timestamp)).limit(limit);\n  }\n\n  async getSalesRecordsSince(since: Date): Promise<SalesRecord[]> {\n    return db.select().from(salesRecords).where(gte(salesRecords.timestamp, since)).orderBy(desc(salesRecords.timestamp));\n  }\n\n  async getSalesRecordByPosterPosId(posterPosId: string): Promise<SalesRecord | undefined> {\n    const result = await db.select().from(salesRecords).where(eq(salesRecords.posterPosId, posterPosId)).limit(1);\n    return result[0];\n  }\n\n  async createSalesRecord(record: InsertSalesRecord): Promise<SalesRecord> {\n    const result = await db.insert(salesRecords).values(record).returning();\n    return result[0];\n  }\n\n  async getTodaysSales(): Promise<{ total: number; count: number }> {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    \n    const result = await db.select({\n      total: sql<number>`COALESCE(SUM(CAST(${salesRecords.amount} AS DECIMAL)), 0)`,\n      count: sql<number>`COUNT(*)::int`\n    }).from(salesRecords).where(gte(salesRecords.timestamp, today));\n\n    return {\n      total: Number(result[0].total),\n      count: result[0].count\n    };\n  }\n\n  // Despatch Logs\n  async getAllDespatchLogs(limit: number = 50): Promise<DespatchLog[]> {\n    return db.select().from(despatchLogs).orderBy(desc(despatchLogs.createdAt)).limit(limit);\n  }\n\n  async createDespatchLog(log: InsertDespatchLog): Promise<DespatchLog> {\n    const result = await db.insert(despatchLogs).values(log).returning();\n    return result[0];\n  }\n\n  async createDespatchWithInventoryUpdate(log: InsertDespatchLog): Promise<DespatchLog> {\n    // Use a transaction to ensure atomic operations\n    return await db.transaction(async (tx) => {\n      // Create the despatch log\n      const [despatch] = await tx.insert(despatchLogs).values(log).returning();\n      \n      // Update inventory if we have the item ID\n      if (log.inventoryItemId) {\n        const [item] = await tx.select().from(inventoryItems).where(eq(inventoryItems.id, log.inventoryItemId)).limit(1);\n        \n        if (item) {\n          const newStock = Math.max(0, Number(item.currentStock) - Number(log.quantity));\n          await tx.update(inventoryItems).set({\n            currentStock: newStock.toString(),\n          }).where(eq(inventoryItems.id, log.inventoryItemId));\n        }\n      }\n      \n      return despatch;\n    });\n  }\n\n  // Reorder Requests\n  async getAllReorderRequests(): Promise<ReorderRequest[]> {\n    return db.select().from(reorderRequests).orderBy(desc(reorderRequests.createdAt));\n  }\n\n  async getPendingReorderRequests(): Promise<ReorderRequest[]> {\n    return db.select().from(reorderRequests).where(eq(reorderRequests.status, \"pending\")).orderBy(desc(reorderRequests.createdAt));\n  }\n\n  async getReorderRequest(id: string): Promise<ReorderRequest | undefined> {\n    const result = await db.select().from(reorderRequests).where(eq(reorderRequests.id, id)).limit(1);\n    return result[0];\n  }\n\n  async createReorderRequest(request: InsertReorderRequest): Promise<ReorderRequest> {\n    const result = await db.insert(reorderRequests).values(request).returning();\n    return result[0];\n  }\n\n  async updateReorderRequest(id: string, updates: Partial<InsertReorderRequest>): Promise<ReorderRequest | undefined> {\n    const result = await db.update(reorderRequests).set(updates).where(eq(reorderRequests.id, id)).returning();\n    return result[0];\n  }\n\n  // Telegram Chats\n  async getAllTelegramChats(): Promise<TelegramChat[]> {\n    return db.select().from(telegramChats).where(eq(telegramChats.isActive, true));\n  }\n\n  async getTelegramChatByChatId(chatId: string): Promise<TelegramChat | undefined> {\n    const result = await db.select().from(telegramChats).where(eq(telegramChats.chatId, chatId)).limit(1);\n    return result[0];\n  }\n\n  async createTelegramChat(chat: InsertTelegramChat): Promise<TelegramChat> {\n    const result = await db.insert(telegramChats).values(chat).returning();\n    return result[0];\n  }\n\n  async updateTelegramChat(id: string, updates: Partial<InsertTelegramChat>): Promise<TelegramChat | undefined> {\n    const result = await db.update(telegramChats).set(updates).where(eq(telegramChats.id, id)).returning();\n    return result[0];\n  }\n\n  // Shop Stock Sessions\n  async createStockSession(session: InsertShopStockSession): Promise<ShopStockSession> {\n    const result = await db.insert(shopStockSessions).values(session).returning();\n    return result[0];\n  }\n\n  async getStockSession(id: string): Promise<ShopStockSession | undefined> {\n    const result = await db.select().from(shopStockSessions).where(eq(shopStockSessions.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getTodaysStockSession(type: 'opening' | 'closing'): Promise<ShopStockSession | undefined> {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    const tomorrow = new Date(today);\n    tomorrow.setDate(tomorrow.getDate() + 1);\n    \n    const result = await db.select().from(shopStockSessions)\n      .where(and(\n        eq(shopStockSessions.sessionType, type),\n        gte(shopStockSessions.date, today),\n        sql`${shopStockSessions.date} < ${tomorrow}`\n      ))\n      .orderBy(desc(shopStockSessions.startedAt))\n      .limit(1);\n    return result[0];\n  }\n\n  async getLatestStockSession(type: 'opening' | 'closing'): Promise<ShopStockSession | undefined> {\n    const result = await db.select().from(shopStockSessions)\n      .where(eq(shopStockSessions.sessionType, type))\n      .orderBy(desc(shopStockSessions.startedAt))\n      .limit(1);\n    return result[0];\n  }\n\n  async updateStockSession(id: string, updates: Partial<InsertShopStockSession>): Promise<ShopStockSession | undefined> {\n    const result = await db.update(shopStockSessions).set(updates).where(eq(shopStockSessions.id, id)).returning();\n    return result[0];\n  }\n\n  // Shop Stock Entries\n  async createStockEntry(entry: InsertShopStockEntry): Promise<ShopStockEntry> {\n    const result = await db.insert(shopStockEntries).values(entry).returning();\n    return result[0];\n  }\n\n  async getStockEntriesBySession(sessionId: string): Promise<ShopStockEntry[]> {\n    return db.select().from(shopStockEntries).where(eq(shopStockEntries.sessionId, sessionId));\n  }\n\n  async updateStockEntry(id: string, updates: Partial<InsertShopStockEntry>): Promise<ShopStockEntry | undefined> {\n    const result = await db.update(shopStockEntries).set(updates).where(eq(shopStockEntries.id, id)).returning();\n    return result[0];\n  }\n\n  // Goods Receipts\n  async createGoodsReceipt(receipt: InsertGoodsReceipt): Promise<GoodsReceipt> {\n    const result = await db.insert(goodsReceipts).values(receipt).returning();\n    return result[0];\n  }\n\n  async getGoodsReceipt(id: string): Promise<GoodsReceipt | undefined> {\n    const result = await db.select().from(goodsReceipts).where(eq(goodsReceipts.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getPendingGoodsReceipts(): Promise<GoodsReceipt[]> {\n    return db.select().from(goodsReceipts)\n      .where(eq(goodsReceipts.status, 'pending'))\n      .orderBy(desc(goodsReceipts.receivedAt));\n  }\n\n  async getAllGoodsReceipts(limit: number = 50): Promise<GoodsReceipt[]> {\n    return db.select().from(goodsReceipts).orderBy(desc(goodsReceipts.receivedAt)).limit(limit);\n  }\n\n  async updateGoodsReceipt(id: string, updates: Partial<InsertGoodsReceipt>): Promise<GoodsReceipt | undefined> {\n    const result = await db.update(goodsReceipts).set(updates).where(eq(goodsReceipts.id, id)).returning();\n    return result[0];\n  }\n\n  // Goods Receipt Items\n  async createGoodsReceiptItem(item: InsertGoodsReceiptItem): Promise<GoodsReceiptItem> {\n    const result = await db.insert(goodsReceiptItems).values(item).returning();\n    return result[0];\n  }\n\n  async getGoodsReceiptItems(receiptId: string): Promise<GoodsReceiptItem[]> {\n    return db.select().from(goodsReceiptItems).where(eq(goodsReceiptItems.receiptId, receiptId));\n  }\n\n  async updateGoodsReceiptItem(id: string, updates: Partial<InsertGoodsReceiptItem>): Promise<GoodsReceiptItem | undefined> {\n    const result = await db.update(goodsReceiptItems).set(updates).where(eq(goodsReceiptItems.id, id)).returning();\n    return result[0];\n  }\n\n  // Shop Expenses\n  async createExpense(expense: InsertShopExpense): Promise<ShopExpense> {\n    const result = await db.insert(shopExpenses).values(expense).returning();\n    return result[0];\n  }\n\n  async getExpense(id: string): Promise<ShopExpense | undefined> {\n    const result = await db.select().from(shopExpenses).where(eq(shopExpenses.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getAllExpenses(limit: number = 50): Promise<ShopExpense[]> {\n    return db.select().from(shopExpenses).orderBy(desc(shopExpenses.createdAt)).limit(limit);\n  }\n\n  async getExpensesByType(type: string): Promise<ShopExpense[]> {\n    return db.select().from(shopExpenses)\n      .where(eq(shopExpenses.expenseType, type))\n      .orderBy(desc(shopExpenses.createdAt));\n  }\n\n  async getTodaysExpenses(): Promise<ShopExpense[]> {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    return db.select().from(shopExpenses)\n      .where(gte(shopExpenses.createdAt, today))\n      .orderBy(desc(shopExpenses.createdAt));\n  }\n\n  // Expense Items\n  async createExpenseItem(item: InsertExpenseItem): Promise<ExpenseItem> {\n    const result = await db.insert(expenseItems).values(item).returning();\n    return result[0];\n  }\n\n  async getExpenseItems(expenseId: string): Promise<ExpenseItem[]> {\n    return db.select().from(expenseItems).where(eq(expenseItems.expenseId, expenseId));\n  }\n\n  // Stock Reconciliation\n  async createReconciliation(recon: InsertStockReconciliation): Promise<StockReconciliation> {\n    const result = await db.insert(stockReconciliations).values(recon).returning();\n    return result[0];\n  }\n\n  async getReconciliation(id: string): Promise<StockReconciliation | undefined> {\n    const result = await db.select().from(stockReconciliations).where(eq(stockReconciliations.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getTodaysReconciliation(): Promise<StockReconciliation | undefined> {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    const tomorrow = new Date(today);\n    tomorrow.setDate(tomorrow.getDate() + 1);\n    \n    const result = await db.select().from(stockReconciliations)\n      .where(and(\n        gte(stockReconciliations.date, today),\n        sql`${stockReconciliations.date} < ${tomorrow}`\n      ))\n      .limit(1);\n    return result[0];\n  }\n\n  async updateReconciliation(id: string, updates: Partial<InsertStockReconciliation>): Promise<StockReconciliation | undefined> {\n    const result = await db.update(stockReconciliations).set(updates).where(eq(stockReconciliations.id, id)).returning();\n    return result[0];\n  }\n\n  // Pending Despatch for Shop (items sent from Store to Shop)\n  async getPendingDespatchForShop(): Promise<DespatchLog[]> {\n    return db.select().from(despatchLogs)\n      .where(eq(despatchLogs.destination, 'shop'))\n      .orderBy(desc(despatchLogs.createdAt));\n  }\n\n  async getDespatchLog(id: string): Promise<DespatchLog | undefined> {\n    const result = await db.select().from(despatchLogs).where(eq(despatchLogs.id, id)).limit(1);\n    return result[0];\n  }\n}\n\nexport const storage = new PostgresStorage();\n","path":null,"size_bytes":18620,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationLink,\n  PaginationItem,\n  PaginationPrevious,\n  PaginationNext,\n  PaginationEllipsis,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/pages/Home.tsx":{"content":"import { Link } from \"wouter\";\nimport { MobileShell } from \"@/components/layout/MobileShell\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\n\nexport default function Home() {\n  const apps = [\n    {\n      id: \"owner\",\n      name: \"Poster Owner\",\n      description: \"Sales analytics & management\",\n      initial: \"OW\",\n      color: \"bg-blue-500\",\n      route: \"/owner\",\n      notifications: 3,\n    },\n    {\n      id: \"store\",\n      name: \"Poster Store\",\n      description: \"Inventory & Dispatch\",\n      initial: \"ST\",\n      color: \"bg-emerald-500\",\n      route: \"/store\",\n      notifications: 12,\n    },\n    {\n      id: \"shop\",\n      name: \"Poster Shop\",\n      description: \"POS & Orders\",\n      initial: \"SH\",\n      color: \"bg-orange-500\",\n      route: \"/shop\",\n      notifications: 0,\n    },\n    {\n      id: \"settings\",\n      name: \"Settings\",\n      description: \"Configure PosterPOS & Telegram\",\n      initial: \"\",\n      color: \"bg-gray-600\",\n      route: \"/settings\",\n      notifications: 0,\n    },\n  ];\n\n  return (\n    <MobileShell className=\"bg-[#1c2631] text-white\">\n      <header className=\"flex items-center justify-between bg-[#242f3d] px-4 py-3 shadow-sm\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"flex flex-col\">\n            <span className=\"text-lg font-semibold\">PosterPOS Manager</span>\n          </div>\n        </div>\n        <div className=\"h-8 w-8 rounded-full bg-blue-500/20 p-1.5 text-blue-500\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><circle cx=\"11\" cy=\"11\" r=\"8\"/><path d=\"m21 21-4.3-4.3\"/></svg>\n        </div>\n      </header>\n\n      <div className=\"flex flex-col\">\n        {apps.map((app) => (\n          <Link key={app.id} href={app.route} className=\"flex items-center gap-3 border-b border-white/5 bg-[#1c2631] px-4 py-3 hover:bg-[#242f3d] transition-colors\">\n            <Avatar className=\"h-12 w-12 border-2 border-[#1c2631]\">\n              <AvatarFallback className={`${app.color} text-white font-bold`}>{app.initial}</AvatarFallback>\n            </Avatar>\n            <div className=\"flex flex-1 flex-col gap-0.5 overflow-hidden\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"font-semibold text-white\">{app.name}</span>\n                <span className=\"text-xs text-gray-400\">12:30 PM</span>\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <span className=\"truncate text-sm text-gray-400\">{app.description}</span>\n                {app.notifications > 0 && (\n                  <Badge className=\"h-5 min-w-[1.25rem] rounded-full bg-blue-500 px-1 text-xs hover:bg-blue-600 border-none\">\n                    {app.notifications}\n                  </Badge>\n                )}\n              </div>\n            </div>\n          </Link>\n        ))}\n        \n        {[1, 2, 3].map((i) => (\n          <div key={i} className=\"flex items-center gap-3 border-b border-white/5 px-4 py-3 opacity-50\">\n            <Avatar className=\"h-12 w-12 bg-gray-700\">\n              <AvatarFallback className=\"bg-gray-700 text-gray-400\">U{i}</AvatarFallback>\n            </Avatar>\n            <div className=\"flex flex-1 flex-col gap-0.5\">\n              <div className=\"h-4 w-24 rounded bg-gray-700/50\" />\n              <div className=\"h-3 w-48 rounded bg-gray-700/30\" />\n            </div>\n          </div>\n        ))}\n      </div>\n    </MobileShell>\n  );\n}\n","path":null,"size_bytes":3599,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-300 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5124,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1037,"size_tokens":null},"client/src/index.css":{"content":"@import \"tailwindcss\";\n@import \"tw-animate-css\";\n\n@theme inline {\n  --color-background: hsl(var(--background));\n  --color-foreground: hsl(var(--foreground));\n  --color-card: hsl(var(--card));\n  --color-card-foreground: hsl(var(--card-foreground));\n  --color-popover: hsl(var(--popover));\n  --color-popover-foreground: hsl(var(--popover-foreground));\n  --color-primary: hsl(var(--primary));\n  --color-primary-foreground: hsl(var(--primary-foreground));\n  --color-secondary: hsl(var(--secondary));\n  --color-secondary-foreground: hsl(var(--secondary-foreground));\n  --color-muted: hsl(var(--muted));\n  --color-muted-foreground: hsl(var(--muted-foreground));\n  --color-accent: hsl(var(--accent));\n  --color-accent-foreground: hsl(var(--accent-foreground));\n  --color-destructive: hsl(var(--destructive));\n  --color-destructive-foreground: hsl(var(--destructive-foreground));\n  --color-border: hsl(var(--border));\n  --color-input: hsl(var(--input));\n  --color-ring: hsl(var(--ring));\n  --color-chart-1: hsl(var(--chart-1));\n  --color-chart-2: hsl(var(--chart-2));\n  --color-chart-3: hsl(var(--chart-3));\n  --color-chart-4: hsl(var(--chart-4));\n  --color-chart-5: hsl(var(--chart-5));\n  --radius-sm: calc(var(--radius) - 4px);\n  --radius-md: calc(var(--radius) - 2px);\n  --radius-lg: var(--radius);\n  --radius-xl: calc(var(--radius) + 4px);\n  --font-sans: 'Inter', sans-serif;\n  --font-mono: 'JetBrains Mono', monospace;\n}\n\n:root {\n  /* Base - Neutral Telegram-like base */\n  --background: 210 20% 98%;\n  --foreground: 222 47% 11%;\n  --card: 0 0% 100%;\n  --card-foreground: 222 47% 11%;\n  --popover: 0 0% 100%;\n  --popover-foreground: 222 47% 11%;\n  \n  /* Default Primary (Owner Blue) */\n  --primary: 221 83% 53%;\n  --primary-foreground: 210 40% 98%;\n  \n  --secondary: 210 40% 96.1%;\n  --secondary-foreground: 222 47% 11.2%;\n  --muted: 210 40% 96.1%;\n  --muted-foreground: 215.4 16.3% 46.9%;\n  --accent: 210 40% 96.1%;\n  --accent-foreground: 222 47% 11.2%;\n  --destructive: 0 84.2% 60.2%;\n  --destructive-foreground: 210 40% 98%;\n  --border: 214.3 31.8% 91.4%;\n  --input: 214.3 31.8% 91.4%;\n  --ring: 221 83% 53%;\n  --radius: 0.75rem;\n  \n  /* Charts */\n  --chart-1: 12 76% 61%;\n  --chart-2: 173 58% 39%;\n  --chart-3: 197 37% 24%;\n  --chart-4: 43 74% 66%;\n  --chart-5: 27 87% 67%;\n}\n\n/* Theme Variations for specific routes/wrappers */\n.theme-store {\n  --primary: 142 71% 45%; /* Green for Store/Inventory */\n  --primary-foreground: 0 0% 100%;\n  --ring: 142 71% 45%;\n}\n\n.theme-shop {\n  --primary: 24 95% 53%; /* Orange for Shop/POS */\n  --primary-foreground: 0 0% 100%;\n  --ring: 24 95% 53%;\n}\n\n.dark {\n  --background: 222.2 84% 4.9%;\n  --foreground: 210 40% 98%;\n  --card: 222.2 84% 4.9%;\n  --card-foreground: 210 40% 98%;\n  --popover: 222.2 84% 4.9%;\n  --popover-foreground: 210 40% 98%;\n  --primary: 217.2 91.2% 59.8%;\n  --primary-foreground: 222.2 47.4% 11.2%;\n  --secondary: 217.2 32.6% 17.5%;\n  --secondary-foreground: 210 40% 98%;\n  --muted: 217.2 32.6% 17.5%;\n  --muted-foreground: 215 20.2% 65.1%;\n  --accent: 217.2 32.6% 17.5%;\n  --accent-foreground: 210 40% 98%;\n  --destructive: 0 62.8% 30.6%;\n  --destructive-foreground: 210 40% 98%;\n  --border: 217.2 32.6% 17.5%;\n  --input: 217.2 32.6% 17.5%;\n  --ring: 224.3 76.3% 48%;\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/* Custom Utilities */\n.glass-panel {\n  @apply bg-white/90 backdrop-blur-lg border border-white/20 shadow-sm;\n}\n","path":null,"size_bytes":3474,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/pages/owner/Dashboard.tsx":{"content":"import { MobileShell } from \"@/components/layout/MobileShell\";\nimport { BottomNav } from \"@/components/layout/BottomNav\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { TrendingUp, Users, DollarSign, Loader2, Package, Receipt } from \"lucide-react\";\nimport { Area, AreaChart, CartesianGrid, XAxis, ResponsiveContainer, Tooltip } from \"recharts\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\n\nexport default function OwnerDashboard() {\n  const { data: todaysSales, isLoading: loadingSales } = useQuery<{ total: number; count: number }>({\n    queryKey: [\"/api/sales/today\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/sales/today\");\n      if (!res.ok) throw new Error(\"Failed to fetch sales\");\n      return res.json();\n    },\n  });\n\n  const { data: weeklyData = [] } = useQuery<{ name: string; sales: number }[]>({\n    queryKey: [\"/api/analytics/weekly\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/analytics/weekly\");\n      if (!res.ok) throw new Error(\"Failed to fetch analytics\");\n      return res.json();\n    },\n  });\n\n  const { data: lowStock = [] } = useQuery<any[]>({\n    queryKey: [\"/api/inventory/low-stock\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/inventory/low-stock\");\n      if (!res.ok) throw new Error(\"Failed to fetch low stock\");\n      return res.json();\n    },\n  });\n\n  const { data: pendingRequests = [] } = useQuery<any[]>({\n    queryKey: [\"/api/requests\", \"pending\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/requests?status=pending\");\n      if (!res.ok) throw new Error(\"Failed to fetch requests\");\n      return res.json();\n    },\n  });\n\n  return (\n    <MobileShell theme=\"owner\" className=\"pb-20\">\n      <header className=\"sticky top-0 z-10 flex items-center justify-between bg-background/80 backdrop-blur-md px-6 py-4 border-b\">\n        <div>\n          <h1 className=\"text-2xl font-bold tracking-tight text-primary\">Owner</h1>\n          <p className=\"text-sm text-muted-foreground\">Good afternoon, Boss</p>\n        </div>\n        <Link href=\"/settings\" className=\"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold\">\n          JD\n        </Link>\n      </header>\n\n      <main className=\"p-4 space-y-6\">\n        {/* Key Metrics */}\n        <div className=\"grid grid-cols-2 gap-4\">\n          <Card className=\"bg-primary text-primary-foreground border-none shadow-lg\">\n            <CardContent className=\"p-4\">\n              <p className=\"text-primary-foreground/80 text-xs font-medium uppercase tracking-wider\">Today's Sales</p>\n              <div className=\"mt-2 flex items-baseline gap-1\">\n                {loadingSales ? (\n                  <Loader2 className=\"h-6 w-6 animate-spin\" />\n                ) : (\n                  <>\n                    <span className=\"text-2xl font-bold\">${todaysSales?.total?.toFixed(2) || \"0.00\"}</span>\n                    <span className=\"text-xs opacity-80\">{todaysSales?.count || 0} txns</span>\n                  </>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"p-4\">\n              <p className=\"text-muted-foreground text-xs font-medium uppercase tracking-wider\">Pending Actions</p>\n              <div className=\"mt-2 flex items-baseline gap-2\">\n                <span className=\"text-2xl font-bold text-foreground\">{pendingRequests.length}</span>\n                <span className=\"text-xs text-muted-foreground\">requests</span>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Low Stock Alert */}\n        {lowStock.length > 0 && (\n          <Card className=\"border-orange-200 bg-orange-50\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2 text-orange-700 mb-2\">\n                <Package className=\"h-4 w-4\" />\n                <span className=\"font-medium text-sm\">{lowStock.length} items need restock</span>\n              </div>\n              <div className=\"text-xs text-orange-600\">\n                {lowStock.slice(0, 3).map(item => item.name).join(\", \")}\n                {lowStock.length > 3 && ` +${lowStock.length - 3} more`}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Chart */}\n        <Card className=\"border-none shadow-sm overflow-hidden\">\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-base font-medium flex items-center gap-2\">\n              <TrendingUp className=\"h-4 w-4 text-primary\" />\n              Revenue Trend\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"p-0 h-[200px]\">\n            {weeklyData.length > 0 ? (\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <AreaChart data={weeklyData}>\n                  <defs>\n                    <linearGradient id=\"colorSales\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                      <stop offset=\"5%\" stopColor=\"hsl(var(--primary))\" stopOpacity={0.3}/>\n                      <stop offset=\"95%\" stopColor=\"hsl(var(--primary))\" stopOpacity={0}/>\n                    </linearGradient>\n                  </defs>\n                  <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"hsl(var(--border))\" />\n                  <XAxis \n                    dataKey=\"name\" \n                    axisLine={false} \n                    tickLine={false} \n                    tick={{fill: 'hsl(var(--muted-foreground))', fontSize: 10}} \n                  />\n                  <Tooltip \n                    contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 12px rgba(0,0,0,0.1)' }}\n                  />\n                  <Area \n                    type=\"monotone\" \n                    dataKey=\"sales\" \n                    stroke=\"hsl(var(--primary))\" \n                    fillOpacity={1} \n                    fill=\"url(#colorSales)\" \n                    strokeWidth={2}\n                  />\n                </AreaChart>\n              </ResponsiveContainer>\n            ) : (\n              <div className=\"h-full flex items-center justify-center text-muted-foreground\">\n                <p className=\"text-sm\">No sales data yet</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Quick Actions */}\n        <div className=\"space-y-4\">\n          <h3 className=\"text-sm font-semibold text-muted-foreground uppercase tracking-wider px-1\">Quick Actions</h3>\n          <div className=\"grid grid-cols-3 gap-3\">\n            <Link href=\"/owner/sales\">\n              <Button variant=\"outline\" className=\"h-auto py-4 w-full flex flex-col gap-2 hover:border-primary/50 hover:bg-primary/5\" data-testid=\"link-sales\">\n                <Receipt className=\"h-6 w-6 text-primary\" />\n                <span className=\"text-xs\">Sales</span>\n              </Button>\n            </Link>\n            <Link href=\"/owner/requests\">\n              <Button variant=\"outline\" className=\"h-auto py-4 w-full flex flex-col gap-2 hover:border-primary/50 hover:bg-primary/5\" data-testid=\"link-requests\">\n                <Users className=\"h-6 w-6 text-primary\" />\n                <span className=\"text-xs\">Requests</span>\n              </Button>\n            </Link>\n            <Link href=\"/owner/analytics\">\n              <Button variant=\"outline\" className=\"h-auto py-4 w-full flex flex-col gap-2 hover:border-primary/50 hover:bg-primary/5\" data-testid=\"link-analytics\">\n                <DollarSign className=\"h-6 w-6 text-primary\" />\n                <span className=\"text-xs\">Analytics</span>\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </main>\n      <BottomNav role=\"owner\" />\n    </MobileShell>\n  );\n}\n","path":null,"size_bytes":7860,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"import * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1237,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-xl border bg-card text-card-foreground shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"font-semibold leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","path":null,"size_bytes":1828,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"import * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3007,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport tailwindcss from \"@tailwindcss/vite\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\nimport { metaImagesPlugin } from \"./vite-plugin-meta-images\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    tailwindcss(),\n    metaImagesPlugin(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  css: {\n    postcss: {\n      plugins: [],\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    host: \"0.0.0.0\",\n    allowedHosts: true,\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1330,"size_tokens":null},"client/src/components/ui/spinner.tsx":{"content":"import { Loader2Icon } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Spinner({ className, ...props }: React.ComponentProps<\"svg\">) {\n  return (\n    <Loader2Icon\n      role=\"status\"\n      aria-label=\"Loading\"\n      className={cn(\"size-4 animate-spin\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Spinner }\n","path":null,"size_bytes":331,"size_tokens":null},"server/transactionSync.ts":{"content":"import { getPosterPOSClient, isPosterPOSInitialized, PosterPOSTransaction } from './posterpos';\nimport { getTelegramBot, isTelegramBotInitialized } from './telegram';\nimport { storage } from './storage';\nimport { log } from './index';\n\nconst SYNC_INTERVAL_MS = 10 * 60 * 1000;\n\nlet lastSyncTimestamp: number | null = null;\nlet syncIntervalId: NodeJS.Timeout | null = null;\n\nfunction parseCloseDate(dateValue: string): Date {\n  if (!dateValue) return new Date();\n  \n  const timestamp = parseInt(dateValue);\n  if (!isNaN(timestamp) && timestamp > 0) {\n    return timestamp > 1e12 ? new Date(timestamp) : new Date(timestamp * 1000);\n  }\n  \n  const date = new Date(dateValue.replace(' ', 'T'));\n  if (!isNaN(date.getTime())) {\n    return date;\n  }\n  \n  return new Date();\n}\n\nexport async function syncNewTransactions(): Promise<number> {\n  if (!isPosterPOSInitialized()) {\n    log('PosterPOS not initialized, skipping sync', 'transaction-sync');\n    return 0;\n  }\n\n  try {\n    const client = getPosterPOSClient();\n    let transactions: PosterPOSTransaction[];\n    \n    if (lastSyncTimestamp) {\n      transactions = await client.getTransactionsSince(lastSyncTimestamp);\n      log(`Fetching transactions since ${new Date(lastSyncTimestamp * 1000).toISOString()}`, 'transaction-sync');\n    } else {\n      transactions = await client.getTodaysTransactions();\n      log('Initial sync: fetching today\\'s transactions', 'transaction-sync');\n    }\n    \n    log(`Found ${transactions.length} transactions`, 'transaction-sync');\n    \n    if (transactions.length === 0) {\n      return 0;\n    }\n\n    let notifiedCount = 0;\n    let maxCloseTimestamp = lastSyncTimestamp || 0;\n    \n    for (const transaction of transactions) {\n      const closeDate = parseCloseDate(transaction.date_close);\n      const closeTimestamp = Math.floor(closeDate.getTime() / 1000);\n      if (closeTimestamp > maxCloseTimestamp) {\n        maxCloseTimestamp = closeTimestamp;\n      }\n      \n      const products = transaction.products || [];\n      if (products.length === 0) continue;\n      \n      const firstProductId = `${transaction.transaction_id}-${products[0].product_id}`;\n      const existing = await storage.getSalesRecordByPosterPosId(firstProductId);\n      \n      if (existing) {\n        continue;\n      }\n      \n      const total = parseFloat(transaction.payed_sum || transaction.sum || '0');\n      \n      await sendTransactionNotification(transaction, total, products);\n      notifiedCount++;\n      \n      await storeTransactionProducts(transaction, products);\n    }\n    \n    lastSyncTimestamp = maxCloseTimestamp;\n    log(`Notified ${notifiedCount} new transactions, updated lastSync to ${new Date(maxCloseTimestamp * 1000).toISOString()}`, 'transaction-sync');\n    \n    return notifiedCount;\n  } catch (error) {\n    log(`Transaction sync error: ${error}`, 'transaction-sync');\n    return 0;\n  }\n}\n\nasync function sendTransactionNotification(\n  transaction: PosterPOSTransaction, \n  total: number, \n  products: any[]\n): Promise<void> {\n  if (!isTelegramBotInitialized()) {\n    return;\n  }\n  \n  try {\n    const bot = getTelegramBot();\n    const message = formatReceiptMessage(transaction, total, products);\n    await bot.sendNotification(message, 'sales');\n  } catch (error) {\n    log(`Failed to send transaction notification: ${error}`, 'transaction-sync');\n  }\n}\n\nfunction formatReceiptMessage(\n  transaction: PosterPOSTransaction, \n  total: number, \n  products: any[]\n): string {\n  const closeDate = parseCloseDate(transaction.date_close);\n  const time = closeDate.toLocaleTimeString('en-US', { \n    hour: '2-digit', \n    minute: '2-digit',\n    hour12: true\n  });\n  \n  const date = closeDate.toLocaleDateString('en-US', {\n    day: 'numeric',\n    month: 'short'\n  });\n  \n  const displayTotal = total / 100;\n  \n  let message = ` *Receipt #${transaction.transaction_id}*\\n`;\n  message += ` ${date} at ${time}\\n\\n`;\n  \n  if (products.length > 0) {\n    message += `*Items:*\\n`;\n    products.forEach((product, index) => {\n      const qty = parseFloat(product.num || '1');\n      const price = (product.payed_sum || product.product_price || 0) / 100;\n      message += ` x${qty} - KES ${price.toFixed(2)}\\n`;\n    });\n    message += `\\n`;\n  }\n  \n  message += ` *Total: KES ${displayTotal.toFixed(2)}*\\n`;\n  \n  const payType = transaction.pay_type === '0' ? 'Cash' : \n                  transaction.pay_type === '1' ? 'Card' : \n                  transaction.pay_type === '2' ? 'Mixed' : 'Other';\n  message += ` ${payType}`;\n  \n  if (transaction.table_name) {\n    message += ` |  ${transaction.table_name}`;\n  }\n  \n  return message;\n}\n\nasync function storeTransactionProducts(\n  transaction: PosterPOSTransaction, \n  products: any[]\n): Promise<void> {\n  try {\n    const closeDate = parseCloseDate(transaction.date_close);\n    \n    for (const product of products) {\n      const posterPosId = `${transaction.transaction_id}-${product.product_id}`;\n      \n      const existing = await storage.getSalesRecordByPosterPosId(posterPosId);\n      if (existing) continue;\n      \n      const amountInCents = product.payed_sum || product.product_price || 0;\n      const amountInKES = (amountInCents / 100).toFixed(2);\n      \n      await storage.createSalesRecord({\n        posterPosId,\n        itemName: `Product #${product.product_id}`,\n        quantity: product.num || '1',\n        amount: amountInKES,\n        timestamp: closeDate,\n        syncedAt: new Date(),\n      });\n    }\n  } catch (error) {\n    log(`Failed to store transaction products: ${error}`, 'transaction-sync');\n  }\n}\n\nexport function startTransactionSync(): void {\n  if (syncIntervalId) {\n    log('Transaction sync already running', 'transaction-sync');\n    return;\n  }\n  \n  log(`Starting transaction sync with ${SYNC_INTERVAL_MS / 1000 / 60}-minute interval`, 'transaction-sync');\n  \n  syncNewTransactions().then(count => {\n    log(`Initial sync completed: ${count} new transactions`, 'transaction-sync');\n  });\n  \n  syncIntervalId = setInterval(async () => {\n    const count = await syncNewTransactions();\n    if (count > 0) {\n      log(`Periodic sync: ${count} new transactions notified`, 'transaction-sync');\n    }\n  }, SYNC_INTERVAL_MS);\n}\n\nexport function stopTransactionSync(): void {\n  if (syncIntervalId) {\n    clearInterval(syncIntervalId);\n    syncIntervalId = null;\n    log('Transaction sync stopped', 'transaction-sync');\n  }\n}\n\nexport function getLastSyncTimestamp(): number | null {\n  return lastSyncTimestamp;\n}\n\nexport function setLastSyncTimestamp(timestamp: number): void {\n  lastSyncTimestamp = timestamp;\n}\n","path":null,"size_bytes":6570,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1419,"size_tokens":null},"client/src/pages/shop/Stock.tsx":{"content":"import { useState } from \"react\";\nimport { MobileShell } from \"@/components/layout/MobileShell\";\nimport { BottomNav } from \"@/components/layout/BottomNav\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { OpeningStock } from \"@/components/shop/OpeningStock\";\nimport { ClosingStock } from \"@/components/shop/ClosingStock\";\nimport { GoodsReceived } from \"@/components/shop/GoodsReceived\";\nimport { Expenses } from \"@/components/shop/Expenses\";\n\nexport default function ShopStock() {\n  const [activeTab, setActiveTab] = useState(\"opening\");\n\n  return (\n    <MobileShell theme=\"shop\" className=\"pb-20\">\n      <header className=\"sticky top-0 z-10 bg-background/80 backdrop-blur-md px-6 py-4 border-b\">\n        <h1 className=\"text-xl font-bold tracking-tight text-primary\">Shop Stock</h1>\n        <p className=\"text-sm text-muted-foreground\">Daily stock management</p>\n      </header>\n\n      <main className=\"flex-1 overflow-hidden\">\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"h-full flex flex-col\">\n          <TabsList className=\"grid grid-cols-4 mx-4 mt-2\">\n            <TabsTrigger value=\"opening\" className=\"text-xs\" data-testid=\"tab-opening\">Opening</TabsTrigger>\n            <TabsTrigger value=\"received\" className=\"text-xs\" data-testid=\"tab-received\">Received</TabsTrigger>\n            <TabsTrigger value=\"closing\" className=\"text-xs\" data-testid=\"tab-closing\">Closing</TabsTrigger>\n            <TabsTrigger value=\"expenses\" className=\"text-xs\" data-testid=\"tab-expenses\">Expenses</TabsTrigger>\n          </TabsList>\n\n          <div className=\"flex-1 overflow-auto p-4\">\n            <TabsContent value=\"opening\" className=\"mt-0 h-full\">\n              <OpeningStock />\n            </TabsContent>\n            \n            <TabsContent value=\"received\" className=\"mt-0 h-full\">\n              <GoodsReceived />\n            </TabsContent>\n            \n            <TabsContent value=\"closing\" className=\"mt-0 h-full\">\n              <ClosingStock />\n            </TabsContent>\n            \n            <TabsContent value=\"expenses\" className=\"mt-0 h-full\">\n              <Expenses />\n            </TabsContent>\n          </div>\n        </Tabs>\n      </main>\n      \n      <BottomNav role=\"shop\" />\n    </MobileShell>\n  );\n}\n","path":null,"size_bytes":2288,"size_tokens":null},"client/src/components/shop/Expenses.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { DollarSign, Loader2, Plus, Receipt, ShoppingCart, Users, Car, Building, Wallet, X } from \"lucide-react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface ExpenseItem {\n  itemName: string;\n  quantity: number;\n  unit: string;\n  costPerUnit?: number;\n}\n\ninterface Expense {\n  id: string;\n  expenseType: string;\n  category?: string;\n  description: string;\n  amount: string;\n  paidBy: string;\n  paidTo?: string;\n  createdAt: string;\n  items?: ExpenseItem[];\n}\n\nconst PETTY_CASH_CATEGORIES = [\n  { value: \"staff\", label: \"Staff\", icon: Users },\n  { value: \"transport\", label: \"Transport\", icon: Car },\n  { value: \"directors\", label: \"Directors\", icon: Building },\n  { value: \"mall_bills\", label: \"Mall Bills\", icon: Receipt },\n  { value: \"other\", label: \"Other\", icon: Wallet },\n];\n\nexport function Expenses() {\n  const [expenseType, setExpenseType] = useState<\"supermarket\" | \"petty_cash\">(\"supermarket\");\n  const [isAdding, setIsAdding] = useState(false);\n  \n  const [description, setDescription] = useState(\"\");\n  const [amount, setAmount] = useState(\"\");\n  const [paidBy, setPaidBy] = useState(\"\");\n  const [paidTo, setPaidTo] = useState(\"\");\n  const [category, setCategory] = useState(\"\");\n  const [receiptNumber, setReceiptNumber] = useState(\"\");\n  const [notes, setNotes] = useState(\"\");\n  const [expenseItems, setExpenseItems] = useState<ExpenseItem[]>([]);\n\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: todayData, isLoading } = useQuery({\n    queryKey: [\"/api/shop/expenses/today\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/shop/expenses/today\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(`${res.status}: ${await res.text()}`);\n      return res.json();\n    },\n  });\n\n  const { data: allExpenses = [] } = useQuery<Expense[]>({\n    queryKey: [\"/api/shop/expenses\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/shop/expenses\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(`${res.status}: ${await res.text()}`);\n      return res.json();\n    },\n  });\n\n  const createExpenseMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", \"/api/shop/expenses\", {\n        expenseType,\n        category: expenseType === \"petty_cash\" ? category : undefined,\n        description,\n        amount,\n        paidBy,\n        paidTo: expenseType === \"petty_cash\" ? paidTo : undefined,\n        receiptNumber,\n        notes,\n        items: expenseType === \"supermarket\" ? expenseItems : undefined,\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Expense recorded\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/shop/expenses\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/shop/expenses/today\"] });\n      resetForm();\n    },\n    onError: () => {\n      toast({ title: \"Failed to create expense\", variant: \"destructive\" });\n    },\n  });\n\n  const resetForm = () => {\n    setDescription(\"\");\n    setAmount(\"\");\n    setPaidBy(\"\");\n    setPaidTo(\"\");\n    setCategory(\"\");\n    setReceiptNumber(\"\");\n    setNotes(\"\");\n    setExpenseItems([]);\n    setIsAdding(false);\n  };\n\n  const addExpenseItem = () => {\n    setExpenseItems([...expenseItems, { itemName: \"\", quantity: 1, unit: \"units\" }]);\n  };\n\n  const removeExpenseItem = (index: number) => {\n    setExpenseItems(expenseItems.filter((_, i) => i !== index));\n  };\n\n  const updateExpenseItem = (index: number, field: keyof ExpenseItem, value: string | number) => {\n    const updated = [...expenseItems];\n    updated[index] = { ...updated[index], [field]: value };\n    setExpenseItems(updated);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (isAdding) {\n    return (\n      <div className=\"space-y-4\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">\n              {expenseType === \"supermarket\" ? \"Supermarket Purchase\" : \"Petty Cash\"}\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <Tabs value={expenseType} onValueChange={(v) => setExpenseType(v as \"supermarket\" | \"petty_cash\")}>\n              <TabsList className=\"grid grid-cols-2\">\n                <TabsTrigger value=\"supermarket\">\n                  <ShoppingCart className=\"h-4 w-4 mr-1\" /> Supermarket\n                </TabsTrigger>\n                <TabsTrigger value=\"petty_cash\">\n                  <Wallet className=\"h-4 w-4 mr-1\" /> Petty Cash\n                </TabsTrigger>\n              </TabsList>\n            </Tabs>\n\n            {expenseType === \"petty_cash\" && (\n              <div>\n                <Label>Category</Label>\n                <Select value={category} onValueChange={setCategory}>\n                  <SelectTrigger data-testid=\"select-category\">\n                    <SelectValue placeholder=\"Select category\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {PETTY_CASH_CATEGORIES.map((cat) => (\n                      <SelectItem key={cat.value} value={cat.value}>\n                        <div className=\"flex items-center gap-2\">\n                          <cat.icon className=\"h-4 w-4\" />\n                          {cat.label}\n                        </div>\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n\n            <div>\n              <Label htmlFor=\"description\">Description</Label>\n              <Input\n                id=\"description\"\n                value={description}\n                onChange={(e) => setDescription(e.target.value)}\n                placeholder={expenseType === \"supermarket\" ? \"e.g., Fruit supplies\" : \"e.g., Staff lunch allowance\"}\n                data-testid=\"input-description\"\n              />\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-2\">\n              <div>\n                <Label htmlFor=\"amount\">Amount (KES)</Label>\n                <Input\n                  id=\"amount\"\n                  type=\"number\"\n                  value={amount}\n                  onChange={(e) => setAmount(e.target.value)}\n                  placeholder=\"0\"\n                  data-testid=\"input-amount\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"paidBy\">Paid By</Label>\n                <Input\n                  id=\"paidBy\"\n                  value={paidBy}\n                  onChange={(e) => setPaidBy(e.target.value)}\n                  placeholder=\"Your name\"\n                  data-testid=\"input-paid-by\"\n                />\n              </div>\n            </div>\n\n            {expenseType === \"petty_cash\" && (\n              <div>\n                <Label htmlFor=\"paidTo\">Paid To</Label>\n                <Input\n                  id=\"paidTo\"\n                  value={paidTo}\n                  onChange={(e) => setPaidTo(e.target.value)}\n                  placeholder=\"Recipient name\"\n                  data-testid=\"input-paid-to\"\n                />\n              </div>\n            )}\n\n            {expenseType === \"supermarket\" && (\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center justify-between\">\n                  <Label>Items (link to stock)</Label>\n                  <Button size=\"sm\" variant=\"outline\" onClick={addExpenseItem}>\n                    <Plus className=\"h-3 w-3 mr-1\" /> Add Item\n                  </Button>\n                </div>\n\n                {expenseItems.map((item, index) => (\n                  <Card key={index} className=\"p-3\">\n                    <div className=\"space-y-2\">\n                      <div className=\"flex gap-2\">\n                        <Input\n                          placeholder=\"Item name\"\n                          value={item.itemName}\n                          onChange={(e) => updateExpenseItem(index, \"itemName\", e.target.value)}\n                          data-testid={`input-expense-item-${index}`}\n                        />\n                        <Button size=\"icon\" variant=\"ghost\" onClick={() => removeExpenseItem(index)}>\n                          <X className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                      <div className=\"grid grid-cols-2 gap-2\">\n                        <div>\n                          <Label className=\"text-xs\">Quantity</Label>\n                          <Input\n                            type=\"number\"\n                            value={item.quantity}\n                            onChange={(e) => updateExpenseItem(index, \"quantity\", Number(e.target.value))}\n                          />\n                        </div>\n                        <div>\n                          <Label className=\"text-xs\">Cost/Unit</Label>\n                          <Input\n                            type=\"number\"\n                            value={item.costPerUnit || \"\"}\n                            onChange={(e) => updateExpenseItem(index, \"costPerUnit\", Number(e.target.value))}\n                            placeholder=\"0\"\n                          />\n                        </div>\n                      </div>\n                    </div>\n                  </Card>\n                ))}\n              </div>\n            )}\n\n            <div>\n              <Label htmlFor=\"receiptNumber\">Receipt Number (optional)</Label>\n              <Input\n                id=\"receiptNumber\"\n                value={receiptNumber}\n                onChange={(e) => setReceiptNumber(e.target.value)}\n                placeholder=\"e.g., RCP-001\"\n                data-testid=\"input-receipt\"\n              />\n            </div>\n\n            <div className=\"flex gap-2\">\n              <Button variant=\"outline\" className=\"flex-1\" onClick={resetForm}>\n                Cancel\n              </Button>\n              <Button\n                className=\"flex-1\"\n                onClick={() => createExpenseMutation.mutate()}\n                disabled={!description || !amount || !paidBy || createExpenseMutation.isPending}\n                data-testid=\"button-save-expense\"\n              >\n                {createExpenseMutation.isPending ? (\n                  <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                ) : (\n                  <DollarSign className=\"h-4 w-4 mr-2\" />\n                )}\n                Save Expense\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <Card className=\"bg-primary text-primary-foreground border-none\">\n        <CardContent className=\"p-4\">\n          <p className=\"text-sm opacity-80\">Today's Expenses</p>\n          <p className=\"text-3xl font-bold\">KES {todayData?.total?.toLocaleString() || 0}</p>\n          {todayData?.byCategory && Object.keys(todayData.byCategory).length > 0 && (\n            <div className=\"flex flex-wrap gap-2 mt-2\">\n              {Object.entries(todayData.byCategory).map(([cat, amt]) => (\n                <span key={cat} className=\"text-xs bg-white/20 px-2 py-1 rounded\">\n                  {cat}: KES {Number(amt).toLocaleString()}\n                </span>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <Button\n        className=\"w-full\"\n        onClick={() => setIsAdding(true)}\n        data-testid=\"button-add-expense\"\n      >\n        <Plus className=\"h-4 w-4 mr-2\" />\n        Record Expense\n      </Button>\n\n      {allExpenses.length > 0 && (\n        <div className=\"space-y-3\">\n          <h3 className=\"text-sm font-semibold text-muted-foreground uppercase\">Recent</h3>\n          {allExpenses.slice(0, 10).map((expense) => {\n            const CategoryIcon = PETTY_CASH_CATEGORIES.find(c => c.value === expense.category)?.icon || Receipt;\n            return (\n              <Card key={expense.id} data-testid={`card-expense-${expense.id}`}>\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className={`h-10 w-10 rounded-full flex items-center justify-center ${\n                        expense.expenseType === \"supermarket\" ? \"bg-green-100 text-green-600\" : \"bg-blue-100 text-blue-600\"\n                      }`}>\n                        {expense.expenseType === \"supermarket\" ? (\n                          <ShoppingCart className=\"h-5 w-5\" />\n                        ) : (\n                          <CategoryIcon className=\"h-5 w-5\" />\n                        )}\n                      </div>\n                      <div>\n                        <p className=\"font-medium text-sm\">{expense.description}</p>\n                        <p className=\"text-xs text-muted-foreground\">\n                          {expense.paidBy}  {new Date(expense.createdAt).toLocaleDateString()}\n                        </p>\n                      </div>\n                    </div>\n                    <p className=\"font-bold text-red-600\">\n                      -KES {Number(expense.amount).toLocaleString()}\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      )}\n\n      {allExpenses.length === 0 && (\n        <Card className=\"p-8 text-center\">\n          <DollarSign className=\"h-12 w-12 mx-auto text-muted-foreground/50 mb-2\" />\n          <p className=\"text-muted-foreground\">No expenses recorded yet</p>\n        </Card>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":14240,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/pages/store/Despatch.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { MobileShell } from \"@/components/layout/MobileShell\";\nimport { BottomNav } from \"@/components/layout/BottomNav\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { ArrowUpRight, Truck, Loader2, Plus, X, Search, Package } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport type { DespatchLog, InventoryItem } from \"@shared/schema\";\n\ninterface DespatchItem {\n  inventoryItemId: string;\n  itemName: string;\n  quantity: string;\n  unit: string;\n}\n\nexport default function StoreDespatch() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [showSearch, setShowSearch] = useState(false);\n  const [items, setItems] = useState<DespatchItem[]>([]);\n  const [destination, setDestination] = useState(\"shop\");\n  const [createdBy, setCreatedBy] = useState(\"\");\n\n  const { data: inventory = [] } = useQuery<InventoryItem[]>({\n    queryKey: [\"/api/inventory\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/inventory\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch inventory\");\n      return res.json();\n    },\n  });\n\n  const { data: logs = [], isLoading: logsLoading } = useQuery<DespatchLog[]>({\n    queryKey: [\"/api/despatch\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/despatch\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch despatch logs\");\n      return res.json();\n    },\n  });\n\n  const filteredInventory = useMemo(() => {\n    if (!searchQuery.trim()) return inventory;\n    const query = searchQuery.toLowerCase();\n    return inventory.filter(item => \n      item.name.toLowerCase().includes(query)\n    );\n  }, [inventory, searchQuery]);\n\n  const createDespatch = useMutation({\n    mutationFn: async (data: { items: DespatchItem[]; destination: string; createdBy: string }) => {\n      const res = await fetch(\"/api/despatch/batch\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify(data),\n      });\n      if (!res.ok) throw new Error(\"Failed to log despatch\");\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Despatch Recorded\",\n        description: `${items.length} item(s) sent to ${destination}`,\n        className: \"bg-emerald-600 text-white border-none\"\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/despatch\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/inventory\"] });\n      setItems([]);\n      setCreatedBy(\"\");\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSelectItem = (item: InventoryItem) => {\n    const existing = items.find(i => i.inventoryItemId === item.id);\n    if (existing) {\n      toast({ title: \"Item already added\", variant: \"destructive\" });\n      return;\n    }\n    setItems([...items, {\n      inventoryItemId: item.id,\n      itemName: item.name,\n      quantity: \"\",\n      unit: item.unit,\n    }]);\n    setSearchQuery(\"\");\n    setShowSearch(false);\n  };\n\n  const updateItemQuantity = (index: number, quantity: string) => {\n    const updated = [...items];\n    updated[index].quantity = quantity;\n    setItems(updated);\n  };\n\n  const removeItem = (index: number) => {\n    setItems(items.filter((_, i) => i !== index));\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (items.length === 0) {\n      toast({ title: \"No items added\", description: \"Please add at least one item.\", variant: \"destructive\" });\n      return;\n    }\n    const invalidItems = items.filter(i => !i.quantity || Number(i.quantity) <= 0);\n    if (invalidItems.length > 0) {\n      toast({ title: \"Missing quantities\", description: \"Please enter quantity for all items.\", variant: \"destructive\" });\n      return;\n    }\n    if (!createdBy.trim()) {\n      toast({ title: \"Missing name\", description: \"Please enter your name.\", variant: \"destructive\" });\n      return;\n    }\n    createDespatch.mutate({ items, destination, createdBy });\n  };\n\n  const formatTime = (date: Date | string) => {\n    return new Date(date).toLocaleTimeString('en-US', { \n      hour: '2-digit', \n      minute: '2-digit' \n    });\n  };\n\n  return (\n    <MobileShell theme=\"store\" className=\"pb-20\">\n      <header className=\"sticky top-0 z-10 bg-background/80 backdrop-blur-md px-6 py-4 border-b\">\n        <h1 className=\"text-xl font-bold tracking-tight text-primary\">Despatch</h1>\n      </header>\n\n      <main className=\"p-4 space-y-6\">\n        <Card className=\"border-none shadow-md\">\n          <CardContent className=\"p-5 space-y-4\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <div className=\"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center text-primary\">\n                <Truck className=\"h-4 w-4\" />\n              </div>\n              <h2 className=\"font-semibold\">Log Outgoing Stock</h2>\n            </div>\n            \n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label>Search & Add Items</Label>\n                <div className=\"relative\">\n                  <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    placeholder=\"Type to search items...\"\n                    value={searchQuery}\n                    onChange={(e) => {\n                      setSearchQuery(e.target.value);\n                      setShowSearch(true);\n                    }}\n                    onFocus={() => setShowSearch(true)}\n                    className=\"pl-10\"\n                    data-testid=\"input-search-items\"\n                  />\n                </div>\n                \n                {showSearch && searchQuery && (\n                  <div className=\"border rounded-lg max-h-48 overflow-y-auto bg-white shadow-lg\">\n                    {filteredInventory.length === 0 ? (\n                      <p className=\"p-3 text-sm text-muted-foreground\">No items found</p>\n                    ) : (\n                      filteredInventory.slice(0, 10).map((item) => (\n                        <button\n                          key={item.id}\n                          type=\"button\"\n                          onClick={() => handleSelectItem(item)}\n                          className=\"w-full text-left p-3 hover:bg-muted/50 border-b last:border-b-0 flex items-center justify-between\"\n                          data-testid={`item-option-${item.id}`}\n                        >\n                          <span className=\"font-medium\">{item.name}</span>\n                          <span className=\"text-sm text-muted-foreground\">\n                            {item.currentStock} {item.unit}\n                          </span>\n                        </button>\n                      ))\n                    )}\n                  </div>\n                )}\n              </div>\n\n              {items.length > 0 && (\n                <div className=\"space-y-2\">\n                  <Label>Items to Despatch ({items.length})</Label>\n                  <div className=\"space-y-2\">\n                    {items.map((item, index) => (\n                      <div\n                        key={item.inventoryItemId}\n                        className=\"flex items-center gap-2 p-3 bg-muted/30 rounded-lg\"\n                        data-testid={`despatch-item-${item.inventoryItemId}`}\n                      >\n                        <Package className=\"h-4 w-4 text-muted-foreground shrink-0\" />\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"font-medium text-sm truncate\">{item.itemName}</p>\n                        </div>\n                        <Input\n                          type=\"number\"\n                          placeholder=\"Qty\"\n                          value={item.quantity}\n                          onChange={(e) => updateItemQuantity(index, e.target.value)}\n                          className=\"w-20 h-8 text-center\"\n                          data-testid={`input-qty-${index}`}\n                        />\n                        <span className=\"text-xs text-muted-foreground w-8\">{item.unit}</span>\n                        <Button\n                          type=\"button\"\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"h-8 w-8 shrink-0\"\n                          onClick={() => removeItem(index)}\n                          data-testid={`button-remove-${index}`}\n                        >\n                          <X className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {items.length === 0 && !showSearch && (\n                <div className=\"text-center py-6 text-muted-foreground\">\n                  <Package className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n                  <p className=\"text-sm\">Search and add items above</p>\n                </div>\n              )}\n\n              <div className=\"grid grid-cols-2 gap-3\">\n                <div className=\"space-y-1\">\n                  <Label htmlFor=\"dest\">Destination</Label>\n                  <Select value={destination} onValueChange={setDestination}>\n                    <SelectTrigger data-testid=\"select-destination\">\n                      <SelectValue placeholder=\"Select...\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"shop\">Shop Floor</SelectItem>\n                      <SelectItem value=\"waste\">Waste/Spoilage</SelectItem>\n                      <SelectItem value=\"return\">Return to Vendor</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-1\">\n                  <Label htmlFor=\"createdBy\">Your Name</Label>\n                  <Input\n                    id=\"createdBy\"\n                    placeholder=\"Staff name\"\n                    value={createdBy}\n                    onChange={(e) => setCreatedBy(e.target.value)}\n                    data-testid=\"input-created-by\"\n                  />\n                </div>\n              </div>\n\n              <Button \n                type=\"submit\" \n                className=\"w-full bg-primary hover:bg-primary/90 text-white mt-2\"\n                disabled={createDespatch.isPending || items.length === 0}\n                data-testid=\"button-confirm-despatch\"\n              >\n                {createDespatch.isPending ? (\n                  <><Loader2 className=\"mr-2 h-4 w-4 animate-spin\" /> Processing...</>\n                ) : (\n                  <>Confirm Despatch ({items.length} item{items.length !== 1 ? 's' : ''})</>\n                )}\n              </Button>\n            </form>\n          </CardContent>\n        </Card>\n\n        <div className=\"space-y-3\">\n          <h3 className=\"text-sm font-semibold text-muted-foreground uppercase tracking-wider px-1\">Recent Movements</h3>\n          \n          {logsLoading ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n            </div>\n          ) : logs.length === 0 ? (\n            <p className=\"text-sm text-muted-foreground text-center py-8\">No despatch logs yet</p>\n          ) : (\n            logs.slice(0, 10).map((log) => (\n              <div key={log.id} className=\"flex items-center justify-between p-3 bg-white rounded-lg border border-border/50 shadow-sm\" data-testid={`log-${log.id}`}>\n                 <div className=\"flex items-center gap-3\">\n                   <div className=\"bg-orange-100 p-2 rounded-full text-orange-600\">\n                     <ArrowUpRight className=\"h-4 w-4\" />\n                   </div>\n                   <div>\n                     <p className=\"font-medium text-sm\">{log.itemName}</p>\n                     <p className=\"text-xs text-muted-foreground\">To: {log.destination}</p>\n                   </div>\n                 </div>\n                 <div className=\"text-right\">\n                   <p className=\"font-bold text-sm\">-{log.quantity}</p>\n                   <p className=\"text-xs text-muted-foreground\">{formatTime(log.createdAt)}</p>\n                 </div>\n              </div>\n            ))\n          )}\n        </div>\n      </main>\n      <BottomNav role=\"store\" />\n    </MobileShell>\n  );\n}\n","path":null,"size_bytes":12986,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":649,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, timestamp, decimal, boolean } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n});\n\nexport const inventoryItems = pgTable(\"inventory_items\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  posterPosId: varchar(\"poster_pos_id\").unique(),\n  name: text(\"name\").notNull(),\n  currentStock: decimal(\"current_stock\", { precision: 10, scale: 2 }).notNull().default(\"0\"),\n  minStock: decimal(\"min_stock\", { precision: 10, scale: 2 }).notNull().default(\"0\"),\n  unit: text(\"unit\").notNull().default(\"units\"),\n  lastSyncedAt: timestamp(\"last_synced_at\"),\n});\n\nexport const salesRecords = pgTable(\"sales_records\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  posterPosId: varchar(\"poster_pos_id\").unique(),\n  itemName: text(\"item_name\").notNull(),\n  quantity: decimal(\"quantity\", { precision: 10, scale: 2 }).notNull(),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  timestamp: timestamp(\"timestamp\").notNull().defaultNow(),\n  syncedAt: timestamp(\"synced_at\").notNull().defaultNow(),\n});\n\nexport const despatchLogs = pgTable(\"despatch_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  inventoryItemId: varchar(\"inventory_item_id\").references(() => inventoryItems.id),\n  itemName: text(\"item_name\").notNull(),\n  quantity: decimal(\"quantity\", { precision: 10, scale: 2 }).notNull(),\n  destination: text(\"destination\").notNull(),\n  createdBy: text(\"created_by\").notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const reorderRequests = pgTable(\"reorder_requests\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  itemName: text(\"item_name\").notNull(),\n  quantity: decimal(\"quantity\", { precision: 10, scale: 2 }).notNull(),\n  unit: text(\"unit\").notNull(),\n  estimatedCost: decimal(\"estimated_cost\", { precision: 10, scale: 2 }),\n  vendor: text(\"vendor\"),\n  notes: text(\"notes\"),\n  requester: text(\"requester\").notNull(),\n  status: text(\"status\").notNull().default(\"pending\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  approvedAt: timestamp(\"approved_at\"),\n  approvedBy: text(\"approved_by\"),\n});\n\nexport const telegramChats = pgTable(\"telegram_chats\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  chatId: text(\"chat_id\").notNull().unique(),\n  chatType: text(\"chat_type\").notNull(),\n  role: text(\"role\").notNull(),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  registeredAt: timestamp(\"registered_at\").notNull().defaultNow(),\n});\n\nexport const posterPosConfig = pgTable(\"poster_pos_config\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  apiEndpoint: text(\"api_endpoint\").notNull(),\n  apiToken: text(\"api_token\").notNull(),\n  lastSyncedAt: timestamp(\"last_synced_at\"),\n});\n\n// Shop Stock Sessions (Opening/Closing stock counts)\nexport const shopStockSessions = pgTable(\"shop_stock_sessions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  sessionType: text(\"session_type\").notNull(), // 'opening' or 'closing'\n  status: text(\"status\").notNull().default(\"in_progress\"), // 'in_progress', 'completed'\n  staffName: text(\"staff_name\").notNull(),\n  startedAt: timestamp(\"started_at\").notNull().defaultNow(),\n  completedAt: timestamp(\"completed_at\"),\n  date: timestamp(\"date\").notNull().defaultNow(), // The business date for this session\n  totalItems: integer(\"total_items\").default(0),\n  countedItems: integer(\"counted_items\").default(0),\n});\n\n// Individual item counts within a stock session\nexport const shopStockEntries = pgTable(\"shop_stock_entries\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  sessionId: varchar(\"session_id\").references(() => shopStockSessions.id).notNull(),\n  inventoryItemId: varchar(\"inventory_item_id\").references(() => inventoryItems.id),\n  itemName: text(\"item_name\").notNull(),\n  posterPosId: varchar(\"poster_pos_id\"),\n  quantity: decimal(\"quantity\", { precision: 10, scale: 2 }).notNull(),\n  unit: text(\"unit\").notNull().default(\"units\"),\n  notes: text(\"notes\"),\n  countedAt: timestamp(\"counted_at\").notNull().defaultNow(),\n});\n\n// Goods Received from Store\nexport const goodsReceipts = pgTable(\"goods_receipts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  despatchLogId: varchar(\"despatch_log_id\").references(() => despatchLogs.id),\n  receivedBy: text(\"received_by\").notNull(),\n  receivedAt: timestamp(\"received_at\").notNull().defaultNow(),\n  status: text(\"status\").notNull().default(\"pending\"), // 'pending', 'received', 'partial'\n  notes: text(\"notes\"),\n  excelFilePath: text(\"excel_file_path\"),\n});\n\n// Individual items in a goods receipt\nexport const goodsReceiptItems = pgTable(\"goods_receipt_items\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  receiptId: varchar(\"receipt_id\").references(() => goodsReceipts.id).notNull(),\n  inventoryItemId: varchar(\"inventory_item_id\").references(() => inventoryItems.id),\n  itemName: text(\"item_name\").notNull(),\n  posterPosId: varchar(\"poster_pos_id\"),\n  expectedQuantity: decimal(\"expected_quantity\", { precision: 10, scale: 2 }).notNull(),\n  receivedQuantity: decimal(\"received_quantity\", { precision: 10, scale: 2 }),\n  unit: text(\"unit\").notNull().default(\"units\"),\n  costPerUnit: decimal(\"cost_per_unit\", { precision: 10, scale: 2 }),\n  notes: text(\"notes\"),\n});\n\n// Shop Expenses (Supermarket purchases and Petty Cash)\nexport const shopExpenses = pgTable(\"shop_expenses\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  expenseType: text(\"expense_type\").notNull(), // 'supermarket' or 'petty_cash'\n  category: text(\"category\"), // For petty cash: 'staff', 'transport', 'directors', 'mall_bills', 'other'\n  description: text(\"description\").notNull(),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  paidBy: text(\"paid_by\").notNull(),\n  paidTo: text(\"paid_to\"),\n  receiptNumber: text(\"receipt_number\"),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Items linked to expenses (for supermarket purchases)\nexport const expenseItems = pgTable(\"expense_items\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  expenseId: varchar(\"expense_id\").references(() => shopExpenses.id).notNull(),\n  inventoryItemId: varchar(\"inventory_item_id\").references(() => inventoryItems.id),\n  itemName: text(\"item_name\").notNull(),\n  quantity: decimal(\"quantity\", { precision: 10, scale: 2 }).notNull(),\n  unit: text(\"unit\").notNull().default(\"units\"),\n  costPerUnit: decimal(\"cost_per_unit\", { precision: 10, scale: 2 }),\n});\n\n// Stock Reconciliation Reports\nexport const stockReconciliations = pgTable(\"stock_reconciliations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  date: timestamp(\"date\").notNull(),\n  openingSessionId: varchar(\"opening_session_id\").references(() => shopStockSessions.id),\n  closingSessionId: varchar(\"closing_session_id\").references(() => shopStockSessions.id),\n  status: text(\"status\").notNull().default(\"pending\"), // 'pending', 'completed', 'sent'\n  overItems: integer(\"over_items\").default(0),\n  underItems: integer(\"under_items\").default(0),\n  matchedItems: integer(\"matched_items\").default(0),\n  sentToOwnerAt: timestamp(\"sent_to_owner_at\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Insert Schemas\nexport const insertUserSchema = createInsertSchema(users).omit({ id: true });\nexport const insertInventoryItemSchema = createInsertSchema(inventoryItems).omit({ id: true });\nexport const insertSalesRecordSchema = createInsertSchema(salesRecords).omit({ id: true });\nexport const insertDespatchLogSchema = createInsertSchema(despatchLogs).omit({ id: true });\nexport const insertReorderRequestSchema = createInsertSchema(reorderRequests).omit({ id: true });\nexport const insertTelegramChatSchema = createInsertSchema(telegramChats).omit({ id: true });\nexport const insertPosterPosConfigSchema = createInsertSchema(posterPosConfig).omit({ id: true });\nexport const insertShopStockSessionSchema = createInsertSchema(shopStockSessions).omit({ id: true });\nexport const insertShopStockEntrySchema = createInsertSchema(shopStockEntries).omit({ id: true });\nexport const insertGoodsReceiptSchema = createInsertSchema(goodsReceipts).omit({ id: true });\nexport const insertGoodsReceiptItemSchema = createInsertSchema(goodsReceiptItems).omit({ id: true });\nexport const insertShopExpenseSchema = createInsertSchema(shopExpenses).omit({ id: true });\nexport const insertExpenseItemSchema = createInsertSchema(expenseItems).omit({ id: true });\nexport const insertStockReconciliationSchema = createInsertSchema(stockReconciliations).omit({ id: true });\n\n// Types\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\nexport type InsertInventoryItem = z.infer<typeof insertInventoryItemSchema>;\nexport type InventoryItem = typeof inventoryItems.$inferSelect;\nexport type InsertSalesRecord = z.infer<typeof insertSalesRecordSchema>;\nexport type SalesRecord = typeof salesRecords.$inferSelect;\nexport type InsertDespatchLog = z.infer<typeof insertDespatchLogSchema>;\nexport type DespatchLog = typeof despatchLogs.$inferSelect;\nexport type InsertReorderRequest = z.infer<typeof insertReorderRequestSchema>;\nexport type ReorderRequest = typeof reorderRequests.$inferSelect;\nexport type InsertTelegramChat = z.infer<typeof insertTelegramChatSchema>;\nexport type TelegramChat = typeof telegramChats.$inferSelect;\nexport type InsertPosterPosConfig = z.infer<typeof insertPosterPosConfigSchema>;\nexport type PosterPosConfig = typeof posterPosConfig.$inferSelect;\nexport type InsertShopStockSession = z.infer<typeof insertShopStockSessionSchema>;\nexport type ShopStockSession = typeof shopStockSessions.$inferSelect;\nexport type InsertShopStockEntry = z.infer<typeof insertShopStockEntrySchema>;\nexport type ShopStockEntry = typeof shopStockEntries.$inferSelect;\nexport type InsertGoodsReceipt = z.infer<typeof insertGoodsReceiptSchema>;\nexport type GoodsReceipt = typeof goodsReceipts.$inferSelect;\nexport type InsertGoodsReceiptItem = z.infer<typeof insertGoodsReceiptItemSchema>;\nexport type GoodsReceiptItem = typeof goodsReceiptItems.$inferSelect;\nexport type InsertShopExpense = z.infer<typeof insertShopExpenseSchema>;\nexport type ShopExpense = typeof shopExpenses.$inferSelect;\nexport type InsertExpenseItem = z.infer<typeof insertExpenseItemSchema>;\nexport type ExpenseItem = typeof expenseItems.$inferSelect;\nexport type InsertStockReconciliation = z.infer<typeof insertStockReconciliationSchema>;\nexport type StockReconciliation = typeof stockReconciliations.$inferSelect;\n","path":null,"size_bytes":11002,"size_tokens":null},"client/src/pages/owner/Usage.tsx":{"content":"import { useState } from \"react\";\nimport { MobileShell } from \"@/components/layout/MobileShell\";\nimport { BottomNav } from \"@/components/layout/BottomNav\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Calendar, Package, Loader2, RefreshCw, ChevronDown, ChevronUp } from \"lucide-react\";\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { subDays, startOfDay, endOfDay } from \"date-fns\";\n\ntype DateRange = \"today\" | \"yesterday\" | \"week\" | \"month\";\n\ninterface ProductUsage {\n  name: string;\n  count: number;\n}\n\ninterface UsageItem {\n  id: string;\n  name: string;\n  quantity: number;\n  unit: string;\n  products: ProductUsage[];\n}\n\ninterface UsageResponse {\n  usage: UsageItem[];\n  summary: {\n    totalIngredients: number;\n    totalTransactions: number;\n    totalProductsSold: number;\n    from: string;\n    to: string;\n  };\n}\n\nexport default function OwnerUsage() {\n  const [dateRange, setDateRange] = useState<DateRange>(\"today\");\n  const [isSyncing, setIsSyncing] = useState(false);\n  const [expandedItems, setExpandedItems] = useState<Set<string>>(new Set());\n  const queryClient = useQueryClient();\n\n  const handleSync = async () => {\n    setIsSyncing(true);\n    try {\n      await queryClient.invalidateQueries({ queryKey: [\"/api/realtime-usage\"] });\n    } finally {\n      setIsSyncing(false);\n    }\n  };\n\n  const toggleExpand = (id: string) => {\n    const newExpanded = new Set(expandedItems);\n    if (newExpanded.has(id)) {\n      newExpanded.delete(id);\n    } else {\n      newExpanded.add(id);\n    }\n    setExpandedItems(newExpanded);\n  };\n\n  const formatLocalDate = (date: Date) => {\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    return `${year}${month}${day}`;\n  };\n\n  const getDateParams = () => {\n    const now = new Date();\n    switch (dateRange) {\n      case \"today\":\n        return { from: formatLocalDate(now), to: formatLocalDate(now) };\n      case \"yesterday\":\n        const yesterday = subDays(now, 1);\n        return { from: formatLocalDate(yesterday), to: formatLocalDate(yesterday) };\n      case \"week\":\n        return { from: formatLocalDate(subDays(now, 7)), to: formatLocalDate(now) };\n      case \"month\":\n        return { from: formatLocalDate(subDays(now, 30)), to: formatLocalDate(now) };\n    }\n  };\n\n  const params = getDateParams();\n  \n  const { data, isLoading, isFetching } = useQuery<UsageResponse>({\n    queryKey: [\"/api/realtime-usage\", params.from, params.to],\n    queryFn: async () => {\n      const res = await fetch(`/api/realtime-usage?from=${params.from}&to=${params.to}`);\n      if (!res.ok) throw new Error(\"Failed to fetch usage\");\n      return res.json();\n    },\n  });\n\n  const getDateLabel = () => {\n    switch (dateRange) {\n      case \"today\": return \"Today's Usage\";\n      case \"yesterday\": return \"Yesterday's Usage\";\n      case \"week\": return \"Last 7 Days\";\n      case \"month\": return \"Last 30 Days\";\n    }\n  };\n\n  const formatQuantity = (quantity: number, unit: string) => {\n    if (unit === 'kg' || unit === 'l') {\n      return `${quantity.toFixed(3)} ${unit}`;\n    }\n    return `${quantity.toFixed(2)} ${unit || 'units'}`;\n  };\n\n  return (\n    <MobileShell theme=\"owner\" className=\"pb-20\">\n      <header className=\"sticky top-0 z-10 bg-background/80 backdrop-blur-md px-6 py-4 border-b\">\n        <div className=\"flex items-center justify-between\">\n          <h1 className=\"text-xl font-bold tracking-tight text-primary\" data-testid=\"text-page-title\">\n            Ingredient Usage\n          </h1>\n          <Button \n            variant=\"ghost\" \n            size=\"icon\" \n            onClick={handleSync}\n            disabled={isSyncing || isLoading || isFetching}\n            data-testid=\"button-sync\"\n          >\n            <RefreshCw className={`h-5 w-5 ${(isSyncing || isFetching) ? 'animate-spin' : ''}`} />\n          </Button>\n        </div>\n      </header>\n\n      <main className=\"p-4 space-y-4\">\n        <div className=\"flex gap-2 overflow-x-auto pb-2 -mx-1 px-1\">\n          {[\n            { key: \"today\", label: \"Today\" },\n            { key: \"yesterday\", label: \"Yesterday\" },\n            { key: \"week\", label: \"7 Days\" },\n            { key: \"month\", label: \"30 Days\" },\n          ].map(({ key, label }) => (\n            <Button\n              key={key}\n              variant={dateRange === key ? \"default\" : \"outline\"}\n              size=\"sm\"\n              className=\"shrink-0\"\n              onClick={() => setDateRange(key as DateRange)}\n              data-testid={`button-range-${key}`}\n            >\n              {label}\n            </Button>\n          ))}\n        </div>\n\n        <Card className=\"bg-primary text-primary-foreground border-none\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm opacity-80\">{getDateLabel()}</p>\n                <div className=\"flex items-baseline gap-2 mt-1\">\n                  {isLoading ? (\n                    <Loader2 className=\"h-6 w-6 animate-spin\" />\n                  ) : (\n                    <span className=\"text-3xl font-bold\" data-testid=\"text-total-ingredients\">\n                      {data?.summary?.totalIngredients ?? 0}\n                    </span>\n                  )}\n                  <span className=\"text-sm opacity-80\">ingredients used</span>\n                </div>\n              </div>\n              <div className=\"text-right\">\n                <p className=\"text-2xl font-bold\" data-testid=\"text-total-products\">\n                  {data?.summary?.totalProductsSold ?? 0}\n                </p>\n                <p className=\"text-sm opacity-80\">\n                  products sold\n                </p>\n              </div>\n            </div>\n            <div className=\"mt-3 pt-3 border-t border-primary-foreground/20\">\n              <p className=\"text-sm opacity-80\" data-testid=\"text-transaction-count\">\n                From {data?.summary?.totalTransactions ?? 0} transactions\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n\n        <div className=\"space-y-3\">\n          <h3 className=\"text-sm font-semibold text-muted-foreground uppercase tracking-wider px-1 flex items-center gap-2\">\n            <Package className=\"h-4 w-4\" />\n            Ingredients Consumed\n          </h3>\n\n          {isLoading ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n            </div>\n          ) : !data?.usage?.length ? (\n            <Card className=\"p-8 text-center\">\n              <Calendar className=\"h-12 w-12 mx-auto text-muted-foreground/50 mb-2\" />\n              <p className=\"text-muted-foreground\">No ingredient usage in this period</p>\n            </Card>\n          ) : (\n            data.usage.map((item) => (\n              <Card \n                key={item.id} \n                className=\"border-none shadow-sm overflow-hidden\" \n                data-testid={`card-usage-${item.id}`}\n              >\n                <CardContent \n                  className=\"p-4 cursor-pointer\"\n                  onClick={() => toggleExpand(item.id)}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"h-10 w-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-600\">\n                        <Package className=\"h-5 w-5\" />\n                      </div>\n                      <div>\n                        <p className=\"font-medium text-sm\" data-testid={`text-ingredient-name-${item.id}`}>\n                          {item.name}\n                        </p>\n                        <p className=\"text-xs text-muted-foreground\">\n                          Used in {item.products.length} product{item.products.length !== 1 ? 's' : ''}\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"text-right\">\n                        <p className=\"font-bold\" data-testid={`text-ingredient-qty-${item.id}`}>\n                          {formatQuantity(item.quantity, item.unit)}\n                        </p>\n                      </div>\n                      {item.products.length > 0 && (\n                        expandedItems.has(item.id) ? \n                          <ChevronUp className=\"h-4 w-4 text-muted-foreground\" /> : \n                          <ChevronDown className=\"h-4 w-4 text-muted-foreground\" />\n                      )}\n                    </div>\n                  </div>\n                  \n                  {expandedItems.has(item.id) && item.products.length > 0 && (\n                    <div className=\"mt-3 pt-3 border-t space-y-2\">\n                      <p className=\"text-xs font-medium text-muted-foreground uppercase\">Used in:</p>\n                      {item.products.map((product, idx) => (\n                        <div key={idx} className=\"flex justify-between text-sm pl-2\">\n                          <span className=\"text-muted-foreground\">{product.name}</span>\n                          <span className=\"font-medium\">x{product.count}</span>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            ))\n          )}\n        </div>\n      </main>\n      <BottomNav role=\"owner\" />\n    </MobileShell>\n  );\n}\n","path":null,"size_bytes":9664,"size_tokens":null}},"version":2}